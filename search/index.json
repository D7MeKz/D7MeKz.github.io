[{"content":"TodoPoint í”„ë¡œì íŠ¸ì— ëŒ€í•œ ì†Œê°œ Todopointë€ ë¬¸ì ê·¸ëŒ€ë¡œ í•  ì¼ì„ ì™„ìˆ˜í•˜ë©´ í¬ì¸íŠ¸ë¥¼ ì§€ê¸‰í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì…ë‹ˆë‹¤. ê³„íšì„ ì œëŒ€ë¡œ ì™„ìˆ˜í•˜ì§€ ëª»í•œ ì‚¬ëŒë“¤ì—ê²Œ ê°•ì œì„±ì„ ë¶€ì—¬í•˜ê³ ì ê¸°íší•œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.\ní”„ë¡œì íŠ¸ ê¸°íšì˜ ì°½ì˜ì„±ì˜ ë³„ê°œë¡œ ê°œì¸ì˜ MSAì— ëŒ€í•œ í•™ìŠµê³¼ ê¸°ìˆ  ì—­ëŸ‰ì„ í–¥ìƒí•˜ê¸° ìœ„í•´ ì‹œì‘í•œ í”„ë¡œì íŠ¸ì˜€ìŠµë‹ˆë‹¤. ì‹¤ì œë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‘ë™ì‹œí‚¤ê¸° ìœ„í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ í™ˆ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ê¸°ë„ í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ 3ê°œì›”ì´ë€ ê¸´ ì‹œê°„ ë™ì•ˆ ì˜ˆìƒì¹˜ ëª»í•œ ì‚½ì§ˆë¡œ ì œëŒ€ë¡œ ë§ˆë¬´ë¦¬í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\nì§€ê¸ˆë¶€í„° í”„ë¡œì íŠ¸ ì‹¤íŒ¨ì˜ ì›ì¸ì„ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.\nì˜ëª»ëœ ì–¸ì–´ ì„ íƒ ì €ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì œì‘í•˜ë©´ì„œ Goë¼ëŠ” ì–¸ì–´ì™€ Gin ì›¹ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ê·¸ë•Œ ë‹¹ì‹œ Go ì–¸ì–´ë¥¼ í•œë²ˆë„ ëª»í•´ë´¤ìŠµë‹ˆë‹¤. ë‹¨ìˆœí•˜ê²Œ í•´ë³´ê³  ì‹¶ì€ ì–¸ì–´ë¼ì„œ ì„ íƒí–ˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì„ íƒìœ¼ë¡œ ì¸í•´ ì˜ˆìƒì¹˜ ëª»í•œ ì‹œê°„ì„ ì“°ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nìƒˆë¡œìš´ ê¸°ìˆ ì„ ì‚¬ìš©í• ë•ŒëŠ” ê³ ë¯¼í•´ë³´ì ì•ì„œ ë§í–ˆë“¯ì´ ê·¸ë•Œ ë‹¹ì‹œ Goì–¸ì–´ëŠ” ì²˜ìŒì´ì—ˆìŠµë‹ˆë‹¤. ì¤€ë¹„ë‹¨ê³„ë¡œ ê°„ë‹¨í•˜ê²Œ Go ì–¸ì–´ ë¬¸ë²•ë§Œ ìµíˆê³  ë°”ë¡œ Ginì„ ì“°ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nGoëŠ” ë…íŠ¹í•œ ë¬¸ë²• ì²´ê³„ë¥¼ ê°€ì§€ê³  ìˆì–´ ë‹¤ë¥¸ ì–¸ì–´ì— ë¹„í•´ ì‘ìš©í•˜ê¸° ì–´ë ¤ì› ìŠµë‹ˆë‹¤. íŠ¹íˆ êµ¬ì¡°ë¥¼ ì§œëŠ”ë° ì–´ë ¤ì›€ì„ ê²ªì—ˆìŠµë‹ˆë‹¤. ê°ì²´ì§€í–¥ ì–¸ì–´ì§€ë§Œ í”íˆ ì•Œê³  ìˆëŠ” í´ë˜ìŠ¤ ê¸°ë°˜ ê°ì²´ì§€í–¥ íŒ¨í„´ê³¼ëŠ” ë‹¤ë¥´ë‹¤ëŠ” ì ì´ ì–´ë ¤ì› ìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 //go:generate mockery --name Store --case underscore type Store interface { Create(ctx *gin.Context, info *data.UserInfo) error FindOne(ctx *gin.Context, uid int) (*data.Me, error) Update(ctx *gin.Context, uid int, me data.Me) error } type UserService struct { store Store } func NewUserService(store Store) *UserService { return \u0026amp;UserService{ store: store, } } func (s *UserService) Update(ctx *gin.Context, uid int, me data.Me) (*httputils.BaseResponse, *httputils.NetError) { err := s.store.Update(ctx, uid, me) if err != nil { return nil, httputils.NewNetError(codes.UpdateFailed, err) } return httputils.NewSuccessBaseResponse(nil), nil } ê²°êµ­ ê¹ƒí—ˆë¸Œì— ë² ìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì°¾ì•„ë‹¤ë‹ˆë©´ì„œ ëŒ€ëµ í•œë‹¬ ë™ì•ˆ ì½”ë“œë¥¼ 2ë²ˆ ìƒˆë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ì£¼ë¡œ Error êµ¬ì¡°ì²´, íŒ¨í‚¤ì§€ êµ¬ì¡° ë“± ë¶€ì¡±í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ë¶€ë¶„ì„ ì „ë¶€ ë‹¤ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.\nê°ê°ì˜ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒì€ ì–´ë µì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê³µí†µ ëª¨ë“ˆì´ë¼ëŠ” ê²ƒì„ ë§Œë“¤ë ¤ê³  í–ˆì„ë•Œ ëª¨ë“  ê²ƒì´ ê¼¬ì´ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ê³µí†µ ëª¨ë“ˆì—ëŠ” í•„ìš”í•œ ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ë‚˜ ì „ì²´ì ìœ¼ë¡œ í†µì¼ëœ í˜•ì‹ì˜ êµ¬ì¡°ì²´(http responseê°’, ì˜¤ë¥˜ ë©”ì„¸ì§€ íƒ€ì… ë“±)ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. GoëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì €ì¥ì†Œë¡œ githubë¥¼ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ê³µí†µ ëª¨ë“ˆì„ githubì— ì—…ë¡œë“œí•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí• ë•Œë§ˆë‹¤ ì œì‘í•œ ê³µí†µ ëª¨ë“ˆì„ ë‹¤ìš´ë¡œë“œ ë°›ê³  ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”? ê°œë°œ ì´ˆê¸° ë‹¨ê³„ë¼ ê³µí†µ ëª¨ë“ˆ ìˆ˜ì •ì´ ì¦ìŠµë‹ˆë‹¤. ì¦‰, ìˆ˜ì •ì‚¬í•­ì„ ë°˜ì˜í• ë•Œ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.\nì´ë•Œ ë‹¹ì‹œ \u0026ldquo;ê³µí†µ ëª¨ë“ˆì´ í•„ìš”í•œê°€?\u0026ldquo;ì— ëŒ€í•´ ë§ì´ ìƒê°í–ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì €ëŠ” ê°œì¸ì ìœ¼ë¡œ í•„ìš”í•˜ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤. ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ë‹¤ë¥´ê² ì§€ë§Œ ê³µí†µì ì¸ ë¶€ë¶„ì´ ë§ì„ìˆ˜ë¡ ëª¨ë“ˆí™”í•˜ì—¬ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì ì´ë¼ê³  ìƒê°í–ˆê¸° ë•Œë¬¸ì´ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŒ€ì‹ ì–´ëŠì •ë„ êµ¬ì¡°ê°€ ì™„ì„±ëœ ìƒíƒœì—ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤ê³  ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.\nì™¸ë¶€ ë‹¤ìš´ë¡œë“œ ì™¸ì— ë‹¤ë¥¸ ë°©ë²•ì´ ìˆì—ˆìŠµë‹ˆë‹¤. GoëŠ” Workspaceë¼ëŠ” ê°œë…ì´ ìˆìœ¼ë©° go.work íŒŒì¼ì„ í†µí•´ ëª…ì‹œì ìœ¼ë¡œ ëª¨ë“ˆì„ í¬í•¨ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 go 1.22.1 use ( . ./../../modules/v2/common ../../modules/v2/database/d7mysql ../../modules/v2/database/d7redis ) WorkspaceëŠ” ë¡œì»¬ ì‚¬ìš©ì— ì í•©í•˜ë‹¤ëŠ” ì˜ê²¬ì´ ìˆìŠµë‹ˆë‹¤.1\në§Œë“  Go ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì»¨í…Œì´ë„ˆë¡œ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” Dockerfileë¡œ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.\nìš°ì„  go ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë¹Œë“œí•˜ê¸° ìœ„í•´ì„œëŠ” ê³µí†µ ëª¨ë“ˆì„ ëª¨ë‘ ë³µì‚¬í•˜ê³  go work use ë¥¼ ìˆ˜í–‰í•œ í›„ $GOPATH/srcì— ëª¨ë“ˆì„ ì €ì¥í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê°œë°œ í™˜ê²½ê³¼ ë„ì»¤ ë‚´ë¶€ í™˜ê²½ì´ ë‹¬ë¼ì„œ ë„ì»¤ ë‚´ë¶€ì— go work useë¥¼ í•  ìˆ˜ ìˆë„ë¡ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì œì‘í•œ í›„ Dockerfileë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # Stage 1: Build modules FROM golang:1.22 as modules-build COPY modules/v2/common /modules/common COPY modules/v2/database/d7redis /modules/database/d7redis COPY modules/v2/database/d7mysql /modules/database/d7mysql WORKDIR /app COPY scripts/init_workspace.sh /app/init_workspace.sh COPY auth-service/v2/workspace.packages.json /app/workspace.packages.json RUN apt-get update \u0026amp;\u0026amp; apt-get install -y jq RUN chmod +x init_workspace.sh \u0026amp;\u0026amp; ./init_workspace.sh RUN cat go.work COPY auth-service/v2 /app COPY auth-service/v2/go.mod /app/go.mod COPY auth-service/v2/go.sum /app/go.sum RUN go mod download RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o /bin/main main.go # stage 2 FROM scratch COPY --from=modules-build /bin/main /bin/main EXPOSE 3001 CMD [\u0026#34;/bin/main\u0026#34;] ê²°êµ­ í•´ê²°í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ê²½ë¡œ ë¬¸ì œ, ëª¨ë“ˆì´ ì œëŒ€ë¡œ ì„¤ì •ë˜ì§€ ì•ŠëŠ” ë¬¸ì œ ë“± ì›ì¸ì€ ë‹¤ì–‘í–ˆìŠµë‹ˆë‹¤.\ní•´ê²°ì±…ì„ ëª¨ìƒ‰í•˜ë‹¤ê°€ ëŠë‚€ê±´ \u0026ldquo;ë‚´ê°€ Goë¥¼ ì ì ˆí•˜ê²Œ ì‚¬ìš©í•œ ê²ƒì´ ë§ë‚˜?\u0026rdquo; ì˜€ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ MSAë¥¼ ì±„íƒí•œ ê²ƒì´ ë¬¸ì œì˜€ë‹¤ëŠ” ê²°ë¡ ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.\në§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í•˜ì§€ ë§ì•˜ì–´ì•¼ í–ˆë‹¤. ê²°êµ­ ëª¨ë“  ì›ì¸ì€ ì•„ë¬´ ìƒê° ì—†ì´ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ë„ì…í–ˆê¸° ë•Œë¬¸ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. ê·¸ë•Œ ë‹¹ì‹œ MSAë¼ê³  ë¶ˆë¦¬ëŠ” ìš©ì–´ê°€ íŠ¸ë Œë“œì²˜ëŸ¼ ë– ì˜¬ëê³ , ê·œëª¨ê°€ ìˆëŠ” ê¸°ì—…ì´ í•´ë‹¹ ëŠ¥ë ¥ì„ ìš”êµ¬í•˜ë©´ì„œ ëŠ¥ë ¥ì´ í•„ìˆ˜ë¼ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.\nì™œ ê·œëª¨ê°€ ìˆëŠ” ê¸°ì—…ì´ MSAë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€? ì— ëŒ€í•œ ì—­ì§ˆë¬¸ì„ ìƒê°í•˜ì§€ ëª»í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nê¸°ì—…ì´ MSAë¥¼ ì±„íƒí•œ ì´ìœ ëŠ” ì„œë¹„ìŠ¤ ê°„ ê²°í•©ë„ë¥¼ ë‚®ì¶° ìš”êµ¬ì‚¬í•­ì— ëŒ€í•œ ë¹ ë¥¸ ëŒ€ì²˜í•˜ê¸° ìœ„í•´ì„œ ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. ì œ í”„ë¡œì íŠ¸ëŠ” MSAë¡œ í• ë§Œí¼ í° ì„œë¹„ìŠ¤ê°€ ì•„ë‹ˆì˜€ê³  ì´ë¥¼ êµ¬í˜„í•  ëŠ¥ë ¥ì„ ê°€ì§€ê³  ìˆì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì¦‰ ì˜¤ë²„ ì—”ì§€ë‹ˆì–´ë§ì„ í•œ ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.\nì‹¤íŒ¨ ì´í›„ì˜ ìƒˆë¡œìš´ ì‹œì‘ ì´ í”„ë¡œì íŠ¸ë¥¼ ìˆ˜í–‰í•˜ë©´ì„œ ë§ì€ ì‹œê°„ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ë…¸ë ¥ ëì— ì™„ì„±ëœ ê²ƒì´ í•˜ë‚˜ ì—†ìœ¼ë‹ˆ í•œí¸ìœ¼ë¡œëŠ” ì•„ì‰½ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì´ í”„ë¡œì íŠ¸ê°€ ì €ì—ê²ŒëŠ” ìƒˆë¡œìš´ ì‹œì‘ì„ ì•Œë ¸ë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\n\u0026ldquo;ê¸°ì´ˆë¶€í„° ê³µë¶€í•  ì˜ˆì •ì´ë¼ë©´ ê¸°ë³¸ì ì¸ êµ¬ì„±ë¶€í„° ê³µë¶€í•´ë³´ì.\u0026rdquo; ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. ì´í›„ë¡œ ì €ëŠ” ê¸°ì´ˆë¶€í„° ê³µë¶€í•  ìˆ˜ ìˆë„ë¡ ì‘ì€ í”„ë¡œì íŠ¸ë¥¼ ê¸°íší•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nhttps://www.reddit.com/r/golang/comments/19517hq/what_are_you_using_go_workspaces_for_if_at_all/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-10-09T00:00:00Z","permalink":"https://s0okju.github.io/p/todopoint-final-review/","title":"ì™œ TodoPoint í”„ë¡œì íŠ¸ë¥¼ ì‹¤íŒ¨í–ˆëŠ”ê°€?"},{"content":"DevStackì˜ í•œê³„ DevStackìœ¼ë¡œ Openstackì„ ë°°í¬í•˜ë©´ì„œ í° ë¬¸ì œì ì„ ëŠë¼ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nNova Instanceì— ì§ì ‘ ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ì–´ë µë‹¤. ë¦¬ì†ŒìŠ¤ë¥¼ ì¶”ê°€ ë° ì‚­ì œí•˜ëŠ” ê²ƒì´ ì–´ë µë‹¤. ìœ„ì˜ ë¬¸ì œì ì€ ë„¤íŠ¸ì›Œí¬ë¡œ ì¸í•´ ë°œìƒí•œ ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¡œ ì œê°€ Nova Instanceë¥¼ ìƒì„±í•´ Floating ipë¥¼ í• ë‹¹í•œë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤. External Networkì˜ IP ë²”ìœ„ê°€ ì™¸ë¶€ì™€ ì—°ê²°ì´ ë¶ˆê°€ëŠ¥í•´ ì§ì ‘ì ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ¼ sshë¡œ ì„œë²„ì— ì§ì ‘ ì ‘ì†í•´ì„œ ê´€ë¦¬í•˜ëŠ” ë°©ì•ˆë„ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¼ Openstackì„ ì™œ ì“´ê±°ì§€? í‚¤ëŠ” ì–´ë–»ê²Œ ê´€ë¦¬í•˜ì§€? ë“± ë‹¤ì–‘í•œ ê¼¬ë¦¬ ì§ˆë¬¸ì´ ë”°ë¼ì˜¤ê²Œ ë©ë‹ˆë‹¤.\nKolla Ansible ë°©ì•ˆì„ ëª¨ìƒ‰í•˜ëŠ” ì¤‘ Openstackì€ DevStack ì´ì™¸ì—ë„ ë‹¤ì–‘í•œ ë°°í¬ ë°©ì•ˆì´ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nKolla Ansibleì´ë€ Ansible í”Œë ˆì´ë¶ì„ í†µí•´ OpenStackì˜ ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ ì»¨í…Œì´ë„ˆë¡œ ë°°í¬í•˜ê³  ìœ ì§€ ë³´ìˆ˜í•˜ë©° ìš´ì˜í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” í”„ë¡œì íŠ¸ì´ë‹¤. ì´ë¥¼ í†µí•´ ë³µì¡í•œ ì„¤ì¹˜ ê³¼ì •ê³¼ ìˆ˜ë™ ì„¤ì •ì„ ìµœì†Œí™”í•˜ê³ , ì¬í˜„ ê°€ëŠ¥í•œ í™˜ê²½ì„ ì œê³µí•˜ì—¬ íš¨ìœ¨ì ì´ë©° ì•ˆì •ì ì¸ í´ë¼ìš°ë“œ ì¸í”„ë¼ ìš´ì˜ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.1\nì¦‰ ìš°ë¦¬ê°€ ì„¤ì •í•œ ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ë¥¼ ì»¨í…Œì´ë„ˆ í˜•íƒœë¡œ êµ¬ì¶•ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\nì„¤ì¹˜ ì„¤ì¹˜ëŠ” íŒŒë€ëŒë‹˜ì˜ ë¸”ë¡œê·¸ - Kolla-ansibleë¡œ Openstack All-in-one ì„¤ì¹˜í•˜ê¸°(Installing Openstack All-in-one with Kolla-ansible)ë¥¼ ì ê·¹ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤.\nì„¤ì¹˜ ëª©ë¡ Kolla-ansibleì˜ ì¥ì ì€ ì›í•˜ëŠ” ë¦¬ì†ŒìŠ¤ ì„ íƒê³¼ ì„¤ì •ì´ ì‰½ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ì €ëŠ” ê¸°ë³¸ì ì¸ ë¦¬ì†ŒìŠ¤ë¥¼ ì„ íƒí•˜ì—¬ ì„¤ì¹˜í–ˆìŠµë‹ˆë‹¤.\nì„¤ì¹˜í•  ë¦¬ì†ŒìŠ¤\nKeystone Glance Nova Neutron Cinder Swift Horizon all-in-one or node? ì˜¤í”ˆìŠ¤íƒì€ í¬ê²Œ 3ê°€ì§€ ë…¸ë“œê°€ ìˆìŠµë‹ˆë‹¤.\nController node : ì „ì²´ ì˜¤í”ˆìŠ¤íƒ ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬ ê´€ë¦¬ ë° ë…¸ë“œ ê°„ ì—°ê²°ì„ ì˜í•´ì„œëŠ” ìµœì†Œí•œ 2ê°œ ì´ìƒì˜ ì¸í„°ë„· ì¸í„°í˜ì´ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. Compute node : Nova ê¸°ë°˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‘ë™í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” í•˜ì´í¼ë°”ì´ì €ë¥¼ ì‹¤í–‰í•˜ëŠ” ë…¸ë“œì…ë‹ˆë‹¤. Network node : ë‹¤ì–‘í•œ ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©°, ì´ë¥¼ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤. ì—¬ëŸ¬ ê°€ì´ë“œë¥¼ ë³´ë©´ ë…¸ë“œë“¤ì€ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì„œë²„ ë‚´ ê°€ìƒë¨¸ì‹ ì„ êµ¬ì¶•í•˜ì—¬ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë³µì¡í•œ ê´€ê³„ë¡œ ì„œë¹„ìŠ¤ ê¸°ëŠ¥ì„ í•˜ë‚˜ì˜ í˜¸ìŠ¤íŠ¸ì— ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ” all-in-one2ì„ ì„ íƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nOpenstack ë„¤íŠ¸ì›Œí¬ ê°€ì¥ ì–´ë µê³  ì•ìœ¼ë¡œ ê³„ì† ê³µë¶€í•´ì•¼ í•˜ëŠ” ë¶„ì•¼ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì™„ì „íˆ ì´í•´í•œ ê²ƒì€ ì•„ë‹ˆì§€ë§Œ ì•Œê³  ìˆëŠ” ê·¸ëŒ€ë¡œ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.\nì˜¤í”ˆ ìŠ¤íƒì—ì„œ ë„¤íŠ¸ì›Œí¬ëŠ” Management, Tunnel, External ë„¤íŠ¸ì›Œí¬ê°€ ìˆìŠµë‹ˆë‹¤.\nManagement Network : ê´€ë¦¬ìš© ë„¤íŠ¸ì›Œí¬ë¡œ ê° ì»´í¬ë„ŒíŠ¸ì™€ ê´€ë ¨ëœ APIë¥¼ í˜¸ì¶œí•˜ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤. Tunnel Network : vm instance ê°„ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì¶•í•˜ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤. External Network : vm instanceê°€ ì¸í„°ë„·ê³¼ í†µì‹ í•˜ê¸° ìœ„í•œ ë„¤íŠ¸ì›Œí¬ì…ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ëŠ” í¬ê²Œ ë‘ ê°€ì§€ ì˜µì…˜ì´ ìˆìŠµë‹ˆë‹¤.\nProvider Network : ê°€ìƒ ë„¤íŠ¸ì›Œí¬ë¥¼ ë¬¼ë¦¬ì  ë„¤íŠ¸ì›Œí¬ë¡œ ì—°ê²°í•©ë‹ˆë‹¤. ì¦‰ ë¬¼ë¦¬ì ì¸ ë„¤íŠ¸ì›Œí¬ê°€ vm ì¸ìŠ¤í„´ìŠ¤ê°€ í™œìš©í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ê°€ ë©ë‹ˆë‹¤. Self-Service Network : ì˜¤í”ˆìŠ¤íƒì„ ì‚¬ìš©í•˜ëŠ” ì‚¬ìš©ìê°€ ì§ì ‘ ìì‹ ë§Œì˜ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ì…ë‹ˆë‹¤. Provider ë„¤íŠ¸ì›Œí¬ëŠ” ë¶€í•˜ë¶„ì‚° ì„œë¹„ìŠ¤ í˜¹ì€ ë°©í™”ë²½ ì„œë¹„ìŠ¤ ë“± ê³ ê¸‰ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nì œê°€ ì‚¬ìš©í•˜ëŠ” ì˜µì…˜ì€ ë¹„êµì  ê°„ë‹¨í•œ Provider Network ì…ë‹ˆë‹¤.\ní…ŒìŠ¤íŠ¸ìš© Openstack ì„œë²„ì˜ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ ë¬¸ì œ kolla-ansibleì—ì„œ ì œê³µí•´ì£¼ëŠ” globals.yml ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤. í™˜ê²½ íŒŒì¼ì„ ë³´ë©´ Internal, External Networkë¡œ êµ¬ë¶„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\nnetwork_interfaceëŠ” Internal networkì— í•´ë‹¹ë˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§€ì •í•˜ëŠ” ê²ƒìœ¼ë¡œ ì €ëŠ” ì™¸ë¶€ ì¸í„°ë„·ê³¼ ì—°ê²°ë˜ì§€ ì•ŠëŠ” enp2s0 ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ë°˜ë©´ neutron_external_interfaceëŠ” providerë¡œ ì œê³µí•  ì¸í„°í˜ì´ìŠ¤ë¡œ ì¸í„°ë„·ê³¼ ì—°ê²°í•  ìˆ˜ ìˆëŠ” enp3s0 ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 ############################## # Neutron - Networking Options ############################## # ... # followed for other types of interfaces. network_interface: \u0026#34;enp2s0\u0026#34; --- # ... neutron_external_interface: \u0026#34;enp3s0\u0026#34; ê·¸ë¦¼ì„ ê·¸ë ¤ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\n(ì•„ë˜ì˜ ê·¸ë¦¼ì€ 172.17.0.250/24ì´ ì•„ë‹ˆë¼ 172.16.0.250/24 ì…ë‹ˆë‹¤. )\ní•˜ì§€ë§Œ ì´ë²ˆ ì˜¤í”ˆìŠ¤íƒ ì„œë²„ëŠ” ì–´ë””ê¹Œì§€ë‚˜ ê°œì¸ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤. ì¦‰ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë¥¼ ì“°ëŠ” ê²ƒë„ ì € í˜¼ìì´ê³ , ê´€ë¦¬í•˜ëŠ” ê²ƒë„ ì € í˜¼ìì¸ ê²ƒì…ë‹ˆë‹¤. ê´€ë¦¬ë¥¼ ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ì ‘ì†(Internal Network)ë„, ì˜¤í”ˆìŠ¤íƒ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ì ‘ì†(External Network)ë„ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.\nê·¸ëŸ¬ë‚˜ ì €ëŠ” í´ë¼ìš°ë“œ ë¦¬ì†ŒìŠ¤ì˜ APIë¥¼ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ ì„œë¡œ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ì„ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\nì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ë¼ìš°íŒ… í…Œì´ë¸”ì„ ì„¤ì •í•´ì•¼ í•  ê²ƒì…ë‹ˆë‹¤. ë¼ìš°í„°ì— ì§ì ‘ ì„¤ì •í•˜ëŠ” ë°©ë²•ê³¼ ìš´ì˜ì²´ì œì—ì„œ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì´ ìˆëŠ”ë°, ë¬¼ë¦¬ì ìœ¼ë¡œ ë¼ìš°í„°ê°€ í•˜ë‚˜ë§Œ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ìš´ì˜ì²´ì œì—ì„œ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.\nì €ëŠ” ip forwardë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.\nIP-Forwardë€ ì»¤ë„ ê¸°ë°˜ ë¼ìš°íŒ… í¬ì›Œë”©ìœ¼ë¡œ í•˜ë‚˜ì˜ ì¸í„°í˜ì´ìŠ¤ë¡œ ë“¤ì–´ì˜¨ íŒ¨í‚·ì„ ë‹¤ë¥¸ ì„œë¸Œë„·ì„ ê°€ì§„ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¡œ íŒ¨í‚·ì„ í¬ì›Œë”©ì‹œí‚¤ëŠ” ê²ƒì´ë‹¤.\n1 2 3 # Kernel parameter update $ sudo sysctl -w net.ipv4.conf.all.forwarding=1 $ sudo sysctl net.ipv4.conf.all.forwarding net.ipv4.conf.all.forwarding = 1 br-ex ì†¡ì‹ ë˜ì–´ enp2s0 ì¸í„°í˜ì´ìŠ¤ì— ìˆ˜ì‹ ë˜ëŠ” ê²ƒì„ í—ˆë½í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.\nbr-exì€ OpenVSwitch(OVS) ì ìš©ì‹œ ë¬¼ë¦¬ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì™€ ì§ì ‘ ì—°ê²°ë˜ëŠ” ê°€ìƒ ìŠ¤ìœ„ì¹˜ì…ë‹ˆë‹¤. ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ê°€ìƒ ë¨¸ì‹ ì„ ì ‘ê·¼í• ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.\n1 2 sudo iptables -I FORWARD -i br-ex -o enp2s0 -j ACCEPT sudo iptables -nL FORWARD í´ë¼ì´ì–¸íŠ¸ë„ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.\n192.168.50.27ë¥¼ í†µí•´ 172.16.0.0/24(enp2s0)ì— ì ‘ê·¼í•œë‹¤ëŠ” routing ruleë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.\n1 sudo route -n add 172.16.0.0/24 192.168.50.27 ì—¬ê¸°ì„œ ì™œ 192.168.50.27ë¥¼ í†µí•´ 172.16.0.0/24 ë„¤íŠ¸ì›Œí¬ì— ì ‘ê·¼í•œë‹¤ê³  ì„¤ì •í•œ ê²ƒì¼ê¹Œìš”?\nì˜¤í”ˆ ìŠ¤íƒ ì„œë²„ì—ì„œ ip_forwardë¥¼ ì‹œì¼°ìŠµë‹ˆë‹¤. ì¦‰ ì„œë²„ê°€ ë¼ìš°í„°ì˜ ì—­í• ì„ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ë˜ì„œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¼ìš°íŒ… ë£°ì„ ì„¤ì •í•  ë•Œì—ëŠ” 172.16.0.250/24ì— í¬ì›Œë”©ì„ ì‹œí‚¨ ì„œë²„ì˜ ip ì£¼ì†Œë¡œ ì„¤ì •í•´ì•¼ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\nì •ë¦¬ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ Openstack ì„œë²„ë¥¼ êµ¬ì¶•í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. êµ¬ì¶• ì‹œ ìš”êµ¬ì‚¬í•­ì€ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©´ì„œ ë¦¬ì†ŒìŠ¤ APIì— ì ‘ê·¼ ê°€ëŠ¥í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤. ì„œë¡œ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ì„ ê°€ì ¸ ë¦¬ì†ŒìŠ¤ APIì— ì ‘ê·¼í•˜ì§€ ëª»í–ˆìœ¼ë‚˜ ì„œë²„ì— ip forwardë¥¼ ìˆ˜í–‰í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.\në¬¸ì œë¥¼ í•´ê²°í•´ ë³´ë‹ˆ Neutronì— ëŒ€í•´ ëª¨ë¥´ê³  ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ í¬ìŠ¤íŒ…ì€ Neutron í†±ì•„ë³´ê¸°ë¡œ ëŒì•„ì˜¤ê² ìŠµë‹ˆë‹¤.\nReference https://velog.io/@lijahong/0%EB%B6%80%ED%84%B0-%EC%8B%9C%EC%9E%91%ED%95%98%EB%8A%94-Linux-%EA%B3%B5%EB%B6%80-%EB%B0%A9%ED%99%94%EB%B2%BD-%EC%BB%B4%ED%93%A8%ED%84%B0 https://velog.io/@larshavin/Kolla-Ansible%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-OpenStack-%EC%84%A4%EC%B9%98-1 https://blog.naver.com/love_tolty/220237750951 https://tech.osci.kr/openstack_cinder/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://blog.naver.com/love_tolty/220237750951\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-10-01T00:00:00Z","permalink":"https://s0okju.github.io/p/server-setup-4/","title":"ì„œë²„ êµ¬ì¶•ê¸° - 4. Kolla-ansible ì„¤ì¹˜ ì‹œ ë§ˆì£¼í•œ ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ"},{"content":"JVMì˜ ë©”ëª¨ë¦¬ ì‚¬ìš© í˜•íƒœ JVMì—ëŠ” 3ê°€ì§€ ë©”ëª¨ë¦¬ ì‚¬ìš© í˜•íƒœê°€ ìˆìŠµë‹ˆë‹¤.\nused: JVMì´ ì‚¬ìš© ì¤‘ì¸ ë©”ëª¨ë¦¬ ì–‘ committed: JVMì´ ì‹œìŠ¤í…œì—ê²Œ ìš”ì²­í•œ ë©”ëª¨ë¦¬ ì–‘ max : ì‹¤í–‰ ì¤‘ì¸ í™˜ê²½ì—ì„œ ìµœëŒ€ë¡œ í• ë‹¹í•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ì–‘ ë©”ëª¨ë¦¬ ìš©ëŸ‰ì€ used \u0026lt;= committed \u0026lt;= maxë¥¼ ë”°ë¥´ëŠ”ë°, used ë©”ëª¨ë¦¬ ì–‘ì´ committed, max ë©”ëª¨ë¦¬ë³´ë‹¤ í¬ê²Œ ëœë‹¤ë©´ OOM(Out Of Memory)ì´ ë°œìƒ1í•˜ê²Œ ë©ë‹ˆë‹¤.\nê·¸ë¼íŒŒë‚˜ë¥¼ í™•ì¸í•´ë³´ë©´ 3ê°€ì§€ì˜ ë©”ëª¨ë¦¬ í˜•íƒœë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nCommitted Memoryì˜ ì—­í•  YGwanë‹˜ì˜ ë¸”ë¡œê·¸: JVM Memoryì˜ 3ê°€ì§€ ë©”íŠ¸ë¦­ ì§€í‘œ - Committed Memoryë€?ë¥¼ ì½ì–´ë³´ëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\në©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³  í•´ì œí•˜ëŠ”ë° í•„ìš”í•œ ì˜¤ë²„í—¤ë“œë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤ëŠ” íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.\nJVMì´ ì‹œìŠ¤í…œì„ í†µí•´ ë¯¸ë¦¬ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ì—¬ ì‚¬ìš© ì‹œ ê°€ì§€ê³  ìˆëŠ” ì—¬ìœ  ë©”ëª¨ë¦¬ ê³µê°„ì„ í™œìš©í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë©”ëª¨ë¦¬ë¥¼ ì¦‰ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ëŠ”ë° ë°œìƒí•˜ëŠ” ì˜¤ë²„í—¤ë“œë¥¼ ì¤„ì¼ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.\nAdvanced echo server jvm ë©”íŠ¸ë¦­ íŠ¹ì§• ì´ì „ ê¸€ì—ì„œ ìŠ¤í”„ë§ë¶€íŠ¸ ì»¨í…Œì´ë„ˆì˜ ë©”ëª¨ë¦¬ê°€ ì§€ì†ì ìœ¼ë¡œ ì¦ê°€í•œë‹¤ê³  ì–¸ê¸‰í–ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì €ëŠ” jvmì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì–´ ê´€ë ¨ ì§€í‘œë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.\nì²˜ìŒì— ëˆˆì—¬ê²¨ ë´¤ë˜ ê²ƒì€ JVMì˜ committed ë©”ëª¨ë¦¬ ì–‘ì´ ì ì§„ì ìœ¼ë¡œ ì¦ê°€í•˜ê³  ìˆë‹¤ëŠ” ì ì´ì—ˆìŠµë‹ˆë‹¤.\nğŸ˜‚ ì‚¬ì§„ì—ì„œëŠ” ì˜ ë³´ì´ì§€ ì•Šì§€ë§Œ ìì„¸íˆ ë³´ë©´ 1MBì”© ìƒìŠ¹í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nìì„¸íˆ ì•Œì•„ë³´ê¸° ì „ì— heapê³¼ non-heap ë©”ëª¨ë¦¬ì— ëŒ€í•´ ì•Œì•„ë´…ì‹œë‹¤.\nJava Heap : Instanceì™€ ê°ì²´ê°€ ì €ì¥ë˜ëŠ” ê³µê°„ìœ¼ë¡œ ëª¨ë“  Threadì— ì˜í•´ ê³µìœ ë˜ëŠ” ì˜ì—­2 Native Area(non-heap) : OSë ˆë²¨ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì˜ì—­ìœ¼ë¡œ JVM í¬ê¸°ì— ê°•ì œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í”„ë¡œì„¸ìŠ¤ê°€ ì´ìš©í•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ìì›ì„ ìµœëŒ€í•œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ëŒì•„ì™€ ì œê°€ ìš´ì˜í•˜ê³  ìˆëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í™•ì¸í•´ ë³¼ê¹Œìš”.\nì •ë§ ê°„ë‹¨í•œ EchoControllerì™€ í”„ë¡œë©”í…Œìš°ìŠ¤ metric ìˆ˜ì§‘ì„ ìœ„í•œ MetricControllerê°€ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 @RestController public class EchoController { @GetMapping(\u0026#34;/echo\u0026#34;) public String echo() { return \u0026#34;Hello, World!\u0026#34;; } } ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¹„êµì  ë‹¨ìˆœí•˜ê¸° ë•Œë¬¸ì— Heap ì˜ì—­ì˜ ë¬¸ì œëŠ” ì•„ë‹ˆë¼ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.\nê·¸ë˜ë„ JVM Heapë¥¼ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤. í™ ë©”ëª¨ë¦¬ì˜ ì‚¬ìš©ëŸ‰ì€ ë§¤ìš° ì ê²Œ ì‚¬ìš©ë˜ì—ˆê³ , ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.\nnon-heap ì˜ì—­ì„ ë´ë´…ì‹œë‹¤.\në³€í™”í­ì´ ì ì–´ì„œ ì°¨ì´ë¥¼ ëª¨ë¥´ê² ì§€ë§Œ ë©”ëª¨ë¦¬ê°€ ì‚¬ìš©ëŸ‰ì´ ì¡°ê¸ˆì”© ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nìš°ì„  í”„ë¡œíŒŒì¼ë§ì€ ë¬´ì—‡ì„ ì˜ë¯¸í• ê¹Œìš”. hudi.blog: ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ì§í›„ ë°œìƒí•˜ëŠ” Latencyì˜ ì›ì¸ê³¼ ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ JVM Warm-upë¥¼ ì°¸ê³ í•˜ê² ìŠµë‹ˆë‹¤.\nJIT ì»´íŒŒì¼ëŸ¬ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œÂ ìì£¼ ì‹¤í–‰ëœë‹¤ê³  íŒë‹¨ë˜ëŠ” íŠ¹ì • ë¶€ë¶„ë§Œì„ ê¸°ê³„ì–´ë¡œ ì»´íŒŒì¼í•œë‹¤. ì´ ë¶€ë¶„ì„Â í•«ìŠ¤íŒŸ(Hotspot) ì´ë¼ê³  ë¶€ë¥¸ë‹¤. JIT ì»´íŒŒì¼ëŸ¬ëŠ” ì‹¤í–‰ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë™ì‘ì„ ë¶„ì„í•˜ê³  ì½”ë“œ ì‹¤í–‰ íšŸìˆ˜, ë£¨í”„ ë°˜ë³µ íšŸìˆ˜, ë©”ì†Œë“œ í˜¸ì¶œ ë“±ì˜ ì •ë³´ë¥¼ ì¸¡ì •í•˜ê³  ê¸°ë¡í•œë‹¤. ì´ë¥¼Â í”„ë¡œíŒŒì¼ë§ì´ë¼ê³  í•œë‹¤.\nJIT ì»´íŒŒì¼ëŸ¬ëŠ” í”„ë¡œíŒŒì¼ë§ ê²°ê³¼ë¥¼ í† ëŒ€ë¡œ í•«ìŠ¤íŒŸì„ ì‹ë³„í•œë‹¤. í•«ìŠ¤íŒŸì´ ì‹ë³„ë˜ì—ˆë‹¤ë©´, JIT ì»´íŒŒì¼ëŸ¬ëŠ”Â ë©”ì†Œë“œ ë‹¨ìœ„ë¡œ ë°”ì´íŠ¸ ì½”ë“œë¥¼ ê¸°ê³„ì–´ë¡œ ë²ˆì—­í•œë‹¤. JIT ì»´íŒŒì¼ëŸ¬ëŠ” ì´ë ‡ê²Œ ë²ˆì—­ëœ ê¸°ê³„ì–´ë¥¼Â ì½”ë“œ ìºì‹œ(Code Cache) ë¼ëŠ” ìºì‹œê³µê°„ì— ì €ì¥í•œë‹¤.\nì¶œì²˜ - https://hudi.blog/jvm-warm-up/\nJITëŠ” ì „ì²´ ì½”ë“œë¥¼ ì»´íŒŒì¼ í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ìì£¼ ì‹¤í–‰ë˜ëŠ” ë¶€ë¶„ì—ë§Œ ì»´íŒŒì¼í•˜ë©° ì´ì— ëŒ€í•œ ë°ì´í„°ë¥¼ Code Cacheì— ì €ì¥í•˜ê²Œ ë©ë‹ˆë‹¤.\nNon Heapê³¼ ê´€ë ¨ëœ ì§€í‘œë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤.\nì•„ë˜ì˜ ì„¸ ê°€ì§€ ì§€í‘œê°€ ë¯¸ì„¸í•˜ê²Œ ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nMetaspace : JVMì´ ë¡œë“œí•œ ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥ CodeHeap : JIT ì»´íŒŒì¼ëŸ¬ ê´€ë ¨ ì§€í‘œ profiled nmethods non-profiled nmethods í•˜ì§€ë§Œ ì¥ê¸°ì ì¸ ê´€ì ì—ì„œ ë°”ë¼ë´¤ì„ë•Œ ë©”ëª¨ë¦¬ ë‚­ë¹„ì¼ ìˆ˜ ìˆê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.\níŠ¹íˆ MetaspaceëŠ” JVM í¬ê¸°ì— ê°•ì œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í”„ë¡œì„¸ìŠ¤ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ìì›ì„ ìµœëŒ€í•œ í™œìš©í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ Metaspace ë©”ëª¨ë¦¬ë¥¼ ì œí•œí•˜ì—¬ ìš´ì˜í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.\nì´ëŸ¬í•œ ì„±ëŠ¥ ì œí•œì€ Metaspaceì—ë§Œ ì ìš©ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ì˜ì—­ì—ì„œì˜ ë©”ëª¨ë¦¬ ì‚¬ì´ì¦ˆ ì œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.\nì•ˆì „í•˜ê²Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìš´ì˜í•˜ê¸° ìœ„í•´ì„œëŠ” ê° ë©”ëª¨ë¦¬ ì˜ì—­ì— ë§ëŠ” ìš”êµ¬ì‚¬í•­ì„ ê³ ë ¤í•˜ì—¬ ê²°ì •í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•©ë‹ˆë‹¤.\nJava ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ í¬ê²Œ ìœ„ì˜ Heapê³¼ Off-Heap ë‘ ê³µê°„ì„ í™œìš©í•˜ì—¬ ë™ì‘í•˜ëŠ”ë°, ë”°ë¼ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•  ë•Œ ë©”ëª¨ë¦¬ ëª‡ GBë¥¼ í• ë‹¹í•´ì•¼ í•˜ëŠ”ì§€ ê²°ì •í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¨ìˆœíˆ Xmx(Heap ë©”ëª¨ë¦¬ ìµœëŒ€ì¹˜ë¥¼ ê²°ì •í•˜ëŠ” Java ì˜µì…˜) ê°’ë§Œ ìƒê°í•˜ë©´ OOMEì— ë¹ ì§€ê¸° ì‰½ë‹¤. ì‹¤ì œë¡œëŠ” Xmxì— MaxMetaspaceê°’ì„ ë”í•˜ê³ , ì¶”ê°€ë¡œ í”„ë¡œê·¸ë¨ì—ì„œ NIOë¥¼ ì‚¬ìš©í•´ Native Memoryë¥¼ ì§ì ‘ í• ë‹¹ë°›ëŠ” ë¡œì§ì„ ê³ ë ¤í•´ì„œ Heap + Native Memory ì‚¬ìš©ì´ëŸ‰ìœ¼ë¡œ í• ë‹¹ì„ í•´ì•¼ ë¹„êµì  ì •í™•í•˜ë‹¤. íŠ¹íˆ ì»¨í…Œì´ë„ˆì˜ ê²½ìš° ê³„ì‚°ì„ ì¢€ ë” ì •í™•í•˜ê²Œ í•´ì•¼ ì‹œìŠ¤í…œì—ì„œ OOM killedë˜ëŠ” ìƒí™©ì„ ë©´í•  ìˆ˜ ìˆë‹¤.\nì¶œì²˜ - https://www.samsungsds.com/kr/insights/1232761_4627.html\nì •ë¦¬ ì‹¤ì œë¡œ ë°°í¬í•´ë³´ë©´ì„œ ì»¨í…Œì´ë„ˆì˜ ì§€ì†ì ì¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•˜ëŠ” ê²ƒì— ì˜ë¬¸ì ì„ ê°€ì§€ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ìë°” ì»¨í…Œì´ë„ˆì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ì€ JVMì´ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ì—†ëŠ” ë¶€ë¶„ì´ ë§ì•„ ì¶”ì í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤3.\nê·¸ë˜ì„œ ìì„¸íˆ í™•ì¸í•  ìˆ˜ ìˆëŠ” JVM ìœ„ì£¼ë¡œ í™•ì¸í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. non-heap ì˜ì—­ì´ ë¯¸ì„¸í•˜ê²Œ ìƒìŠ¹í•˜ê³  ìˆì—ˆê³ , ì´ëŠ” ì •ìƒì ì¸ ì§€í‘œë¼ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¥ê¸°ì ìœ¼ë¡œëŠ” ë©”ëª¨ë¦¬ ë‚­ë¹„ê°€ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë©”ëª¨ë¦¬ ì‚¬ì´ì¦ˆë¥¼ ì œí•œí•˜ì—¬ ìš´ì˜í•´ì•¼ í•©ë‹ˆë‹¤.\nReference https://swmobenz.tistory.com/37 https://hudi.blog/jvm-warm-up/ https://velog.io/@dongvelop/Spring-Boot-%EC%84%9C%EB%B2%84-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%EB%8C%80%EC%8B%9C%EB%B3%B4%EB%93%9C%EB%B3%84-%EC%84%A4%EB%AA%85-%EB%B0%8F-%EC%9C%A0%EC%9D%98%EC%82%AC%ED%95%AD#codeheap-non-profiled-nmethods-non-heap https://www.samsungsds.com/kr/insights/1232761_4627.html https://obv-cloud.com/41 https://swmobenz.tistory.com/37\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://12bme.tistory.com/382\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://stackoverflow.com/questions/53451103/java-using-much-more-memory-than-heap-size-or-size-correctly-docker-memory-limi\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-09-29T00:00:00Z","permalink":"https://s0okju.github.io/p/opsathlan-2-2/","title":"OpsAthlan 2 - 2. Advanced echo server ë©”íŠ¸ë¦­ ë¶„ì„"},{"content":"ì‹œë‚˜ë¦¬ì˜¤ ì´ì „ê¸€ ì„ ë³´ë‹ˆ ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆì— ë¬¸ì œê°€ ìƒê¸´ ê²ƒ ê°™ë‹¤. spring boot ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ì§€í‘œë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆë„ë¡ í™˜ê²½ì„ êµ¬ì¶•í•´ë³´ì.\ní™˜ê²½ Ubuntu 22.04 Openstack 2024.1 ì „ì²´ êµ¬ìƒë„ ì•„ë˜ì™€ ê°™ì´ êµ¬ìƒë©ë‹ˆë‹¤. cAdvisorë¥¼ ì„¤ì •í•œ ì´ìœ ëŠ” ì»¨í…Œì´ë„ˆ ê´€ë ¨ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ê¸° ìœ„í•´ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. docker-composeë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆë¥¼ ë°°í¬í–ˆìŠµë‹ˆë‹¤.\nì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆë“¤ì˜ ë¦¬ì†ŒìŠ¤ ì§€í‘œë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ cAdvisorë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.1\nì ˆì°¨ Terraform, Ansibleë¥¼ í™œìš©í•œ í™˜ê²½ êµ¬ì„± í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ í™œìš©í•œ ì§€í‘œ ìˆ˜ì§‘ ê·¸ë¼íŒŒë‚˜ ì‹œê°í™” í™˜ê²½ êµ¬ì„± í´ë¼ìš°ë“œ ë¦¬ì†ŒìŠ¤ì˜ êµ¬ì„± ìì²´ëŠ” ì´ì „ê³¼ ë³€í™”í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\ndocker compose ë‹¤ë§Œ í™˜ê²½ êµ¬ì„±ì€ ë³€í–ˆìŠµë‹ˆë‹¤. ê°œë³„ ì»¨í…Œì´ë„ˆë¡œ ë°°í¬í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ docker-composeë¥¼ í†µí•´ ê´€ë ¨ ì»¨í…Œì´ë„ˆë¥¼ ë°°í¬í–ˆìŠµë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” ì»¨í…Œì´ë„ˆì˜ ê°œìˆ˜ê°€ ë§ì•„ì§ì— ë”°ë¼ ì»¨í…Œì´ë„ˆë¥¼ í° ë¬¶ìŒìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œì…ë‹ˆë‹¤.\nì´ 4ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ë°°í¬í•˜ê²Œ ë©ë‹ˆë‹¤\nPrometheus Grafana Springboot application cAdvisor 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 # docker-compose.yml version: \u0026#34;3.7\u0026#34; services: # Prometheus service prometheus: image: prom/prometheus:latest container_name: prometheus volumes: - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml ports: - \u0026#34;9090:9090\u0026#34; # Expose Prometheus web UI networks: - monitoring # Grafana service grafana: image: grafana/grafana:latest container_name: grafana ports: - \u0026#34;3000:3000\u0026#34; # Expose Grafana web UI networks: - monitoring depends_on: - prometheus # Spring Boot app service advanced-echo: image: opsathlan-advanced-echo:latest container_name: opsathlan-advanced-echo ports: - \u0026#34;8080:8080\u0026#34; networks: - monitoring # cadvsior config cadvisor: container_name: cadvisor image: gcr.io/cadvisor/cadvisor:latest ports: - \u0026#34;8081:8080\u0026#34; volumes: - \u0026#34;/:/rootfs:ro\u0026#34; - \u0026#34;/var/run:/var/run:ro\u0026#34; - \u0026#34;/sys:/sys:ro\u0026#34; - \u0026#34;/var/lib/docker/:/var/lib/docker:ro\u0026#34; # docker container log networks: - monitoring networks: monitoring: driver: bridge í”„ë¡œë©”í…Œìš°ìŠ¤ í”„ë¡œë©”í…Œìš°ìŠ¤ê°€ ìˆ˜ì§‘í•œ ë©”íŠ¸ë¦­ ì§€í‘œëŠ” springboot container ê´€ë ¨ ì§€í‘œì™€ ì»¨í…Œì´ë„ˆ ê´€ë ¨ ì§€í‘œì…ë‹ˆë‹¤. ê·¸ë˜ì„œ scrape_configs targetì— ê´€ë ¨ ì»¨í…Œì´ë„ˆ URLë¥¼ ê¸°ì…í•˜ê²Œ ë©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 # prometheus.yml global: scrape_interval: 10s # How often to scrape targets scrape_configs: - job_name: \u0026#34;opsathlan-advanced-echo\u0026#34; static_configs: - targets: [\u0026#34;opsathlan-advanced-echo:8080\u0026#34;, \u0026#34;cadvisor:8080\u0026#34;] labels: group: \u0026#34;test\u0026#34; docker composeë¥¼ ì‹¤í–‰í•˜ëŠ” Ansible playbook novaì—ì„œ docker-composeë¥¼ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” ê´€ë ¨ ë°”ì´ë„ˆë¦¬ë¥¼ ì„¤ì¹˜í•˜ê³ , í•„ìš”í•œ í™˜ê²½ íŒŒì¼ì„ ì¸ìŠ¤í„´ìŠ¤ì— ë³µì‚¬í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤. docker-compose ë¼ëŠ” ansible roleë¥¼ ë§Œë“¤ì–´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³ , docker composeë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” í…ŒìŠ¤í¬ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.\nê°œì¸ì ìœ¼ë¡œ ì‘ì—…í•œ ë„ì»¤ ì„¤ì¹˜ ansible-role ë¥¼ í™•ì¸í•´ë³´ë©´ docker ì„¤ì¹˜í• ë•Œ docker-compose pluginë¥¼ ì„¤ì¹˜í•˜ê²Œ ë©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë³„ë„ì˜ ì„¤ì¹˜ ì—†ì´ docker compose ëª…ë ¹ì–´ ë§Œìœ¼ë¡œë„ docker-compose íŒŒì¼ì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 - name: Update apt cache apt: update_cache: yes - name: Install Docker Engine, CLI, containerd, and plugins apt: name: - docker-ce - docker-ce-cli - containerd.io - docker-buildx-plugin - docker-compose-plugin state: present í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” config íŒŒì¼ì„ nova ì¸ìŠ¤í„´ìŠ¤ì— ì§ì ‘ ì €ì¥í•´ì•¼ í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤. docker-compose.yml ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ë³´ë©´ local volumeì´ ./prometheus/prometheus.yml ë¡œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. íŒŒì¼ ê²½ë¡œëŠ” nova ì¸ìŠ¤í„´ìŠ¤ì˜ íŒŒì¼ ê²½ë¡œë¡œ í•´ë‹¹ íŒŒì¼ ê²½ë¡œì— ë§ê²Œ ì„¤ì • íŒŒì¼(prometheus.yml)ë¥¼ ì €ì¥í•´ì•¼ í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 # docker-compose.yml services: # Prometheus service prometheus: image: prom/prometheus:latest container_name: prometheus volumes: - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml ports: - \u0026#34;9090:9090\u0026#34; # Expose Prometheus web UI networks: - monitoring prometheusì˜ í´ë”ë¥¼ ë§Œë“  í›„ì— ë³µì‚¬í•˜ëŠ” ì‘ì—…ì„ í•˜ë©´ íŒŒì¼ì´ ì €ì¥ë©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 - name: Create Prometheus configuration directory file: path: \u0026#34;/home/ubuntu/prometheus\u0026#34; state: directory owner: \u0026#34;ubuntu\u0026#34; group: \u0026#34;ubuntu\u0026#34; mode: \u0026#34;0755\u0026#34; - name: Copy Prometheus config file copy: src: ./prometheus.yml dest: /home/ubuntu/prometheus/prometheus.yml owner: \u0026#34;ubuntu\u0026#34; group: \u0026#34;ubuntu\u0026#34; mode: \u0026#34;0644\u0026#34; docker compose ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•˜ë©´ docker-compose íŒŒì¼ì— ì •ì˜ëœ ì»¨í…Œì´ë„ˆë“¤ì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 - name: Copy docker-compose.yml to the target machine copy: src: ./docker-compose.yml dest: /home/ubuntu/docker-compose.yml # Destination on the target machine owner: \u0026#34;ubuntu\u0026#34; group: \u0026#34;ubuntu\u0026#34; mode: \u0026#34;0644\u0026#34; - name: Run docker-compose up to start containers command: docker compose up -d args: chdir: /home/ubuntu/ become: true í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ í™œìš©í•œ ì§€í‘œ ìˆ˜ì§‘ ë©”íŠ¸ë¦­ ìˆ˜ì§‘, ì‹œê°í™”, ì•Œë¦¼, ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ ê¸°ëŠ¥ì„ ëª¨ë‘ ì œê³µí•˜ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. Pull ë°©ì‹ìœ¼ë¡œ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ê³  ì‹œê³„ì—´ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ëŠ” íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.\npull ë°©ì‹ì€ í”„ë¡œë©”í…Œìš°ìŠ¤ê°€ í•„ìš”í•œ ë©”íŠ¸ë¦­ ì§€í‘œë¥¼ ëŒ€ìƒ ì„œë²„ë¡œë¶€í„° ê°€ì ¸ì˜¨ë‹¤ëŠ” ê²ƒê³¼ ê°™ì€ ë§ì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ëŒ€ìƒì´ ë˜ëŠ” ì„œë²„ëŠ” í”„ë¡œë©”í…Œìš°ìŠ¤ê°€ ë©”íŠ¸ë¦­ì„ ë°›ì•„ê°ˆ ìˆ˜ ìˆë„ë¡ endpointë¥¼ ì—´ì–´ë‘¬ì•¼ í•©ë‹ˆë‹¤.\në³´í†µì˜ ë°©ì‹ì´ë¼ë©´ spring boot actuatorë¥¼ í™œìš©í•˜ì—¬ /actuator/metrics ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì—¬ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 # application.properties management.endpoints.web.exposure.include=prometheus,metrics management.endpoint.prometheus.enabled=true management.prometheus.metrics.export.enabled=true ìœ„ì™€ ê°™ì€ ë°©ì‹ì„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ EOF ì˜¤ë¥˜ê°€ ë°œìƒí•´ í”„ë¡œë©”í…Œìš°ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì§€í‘œë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ headerë¥¼ TEXT_PLAINìœ¼ë¡œ ì§€ì •í•´ì£¼ëŠ” controllerë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 import io.micrometer.prometheusmetrics.PrometheusMeterRegistry; @RestController @RequiredArgsConstructor public class MetricsController { private final PrometheusMeterRegistry prometheusMeterRegistry; @GetMapping(\u0026#34;/metrics\u0026#34;) public ResponseEntity\u0026lt;String\u0026gt; metrics() { String scrape = prometheusMeterRegistry.scrape(); HttpHeaders headers = new HttpHeaders(); headers.setContentType(MediaType.TEXT_PLAIN); return new ResponseEntity\u0026lt;\u0026gt;(scrape, headers, HttpStatus.OK); } } springboot actuator ìŠ¤í”„ë§ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë‹ˆí„°ë§ê³¼ ê´€ë¦¬ì— í•„ìš”í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.\n9090 í¬íŠ¸ì— ì ‘ì†í•´ í”„ë¡œë©”í…Œìš°ìŠ¤ web uië¥¼ ë³´ë©´ ìŠ¤í”„ë§ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ cAdvisor ì§€í‘œê°€ ì •ìƒì ìœ¼ë¡œ í†µì‹ ë¨ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê·¸ë¼íŒŒë‚˜ë¥¼ í†µí•œ ì‹œê°í™” cAdvisor ì§€í‘œ ì‹œê°í™” ê·¸ë¼íŒŒë‚˜ì—ì„œ containerì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ í™•ì¸í•´ë´…ë‹ˆë‹¤. ë©”ëª¨ë¦¬ ë‹¨ìœ„ë¡œ í™•ì¸í•˜ê¸° ìœ„í•´ 1024ë¥¼ ë‘ë²ˆ ë‚˜ëˆ´ìŠµë‹ˆë‹¤.\nê´€ë ¨ ì§€í‘œëŠ” cadvisor Githubë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ëë‹ˆë‹¤.\n1 container_memory_usage_bytes{name=\u0026#34;instance_name\u0026#34;}/1024/1024 ì•„ë˜ì˜ ê·¸ë˜í”„ë¥¼ ë³´ë©´ ê³„ì† ìƒìŠ¹í•˜ê³  ìˆëŠ” ê·¸ë˜í”„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ ê´€ë ¨ ì§€í‘œ ì‹œê°í™” ì €ëŠ” GrafanaLabsì—ì„œ ì œê³µí•´ì£¼ëŠ” JVM ëŒ€ì‹œë³´ë“œë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. dashboard ipë¥¼ ì„¤ì •í•˜ë©´ ë‹¤ì–‘í•œ ê·¸ë˜í”„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì•„ë˜ì˜ ì‚¬ì§„ì€ ì¼ë¶€ë§Œ ë‚˜íƒ€ë‚¸ ê²ƒì´ë©° ì´ê²ƒ ì´ì™¸ì—ë„ ë‹¤ì–‘í•œ ì§€í‘œê°€ ìˆìŠµë‹ˆë‹¤.\në‹¤ìŒê¸€ ì§€ê¸ˆê¹Œì§€ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒí¸ì—ëŠ” ì‹œê°í™”í•œ í‘œë¥¼ ë¶„ì„í•´ë³´ëŠ” ì‹œê°„ì„ ê°€ì§€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\nhttps://themapisto.tistory.com/44\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-09-26T00:00:00Z","permalink":"https://s0okju.github.io/p/opsathlan-2-1/","title":"OpsAthlan 2 - 1. Advanced echo server êµ¬ì¶•"},{"content":"ì‹œë‚˜ë¦¬ì˜¤ Hello Worldë¥¼ ë°˜í™˜í•´ì£¼ëŠ” springboot ë„ì»¤ ì„œë¹„ìŠ¤ê°€ ìˆë‹¤. ë°°í¬í•´ë³´ì!\ní™˜ê²½ ubuntu 22.04 openstack 2024.01 ìˆœì„œ Terraformì„ í™œìš©í•œ ì¸í”„ë¼ êµ¬ì„± Ansibleë¥¼ í™œìš©í•œ í™˜ê²½ êµ¬ì„± ë° ë¹Œë“œ cAdvisorë¥¼ í™œìš©í•œ ëª¨ë‹ˆí„°ë§ cAdvisorë¥¼ ì„ íƒí•œ ì´ìœ  cAdvsiorëŠ” ì»¨í…Œì´ë„ˆì˜ Metrixë¥¼ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ê¸°ë³¸ì ì¸ ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ ì •ë³´ë¥¼ ìš°ì„  í™•ì¸í•˜ê¸° ìœ„í•´ ì„ íƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nì „ì²´ êµ¬ì„±ë„ Terraformì„ í™œìš©í•œ ë¦¬ì†ŒìŠ¤ ë°°í¬ ë°°í¬í•´ì•¼ í•  ê²ƒì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\nNova Instance Network Subnet Router Floating ip Security Security Group ssh, spring web port(8080), cAdvisor(8081)ë¥¼ ìœ„í•œ rule ìƒì„± ssh í†µì‹ ì„ ìœ„í•œ keypair Terraform code terraformì€ ì ˆì°¨ ì§€í–¥ì ì´ê¸° ë•Œë¬¸ì— ë¦¬ì†ŒìŠ¤ ì‘ì„± ìˆœì„œê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.ê·¸ë˜ì„œ ê°„ë‹¨í•œ nova ì¸ìŠ¤í„´ìŠ¤ ë°°í¬ì˜ ê²½ìš° ì•„ë˜ì™€ ê°™ì€ ìˆœì„œë¥¼ ë”°ëìŠµë‹ˆë‹¤.\në„¤íŠ¸ì›Œí¬ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± floating ip í• ë‹¹ ì „ì²´ ì½”ë“œëŠ” ê¹ƒí—ˆë¸Œë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ëë‹ˆë‹¤.\në„¤íŠ¸ì›Œí¬ë¥¼ ìƒì„±í•œ ì´í›„ subnetë¥¼ ìƒì„±í•œë‹¤. ì™¸ë¶€ì™€ í†µì‹ í•˜ê¸° ìœ„í•´ì„œëŠ” external_networkì™€ ì„œë¸Œë„·ê³¼ì˜ ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ routerë¥¼ ìƒì„±í•œ í›„ router_interfaceë¥¼ í†µí•´ external_networkì™€ ì„œë¸Œë„·ì´ ì—°ê²°í•˜ê²Œ ë©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # Network ìƒì„± resource \u0026#34;openstack_networking_network_v2\u0026#34; \u0026#34;opsathlan_network\u0026#34; { name = \u0026#34;opsathlan-${var.scenario_id}-network\u0026#34; admin_state_up = true port_security_enabled = var.port_security_enabled } # Subnet ìƒì„± resource \u0026#34;openstack_networking_subnet_v2\u0026#34; \u0026#34;opsathlan_subnet\u0026#34; { name = \u0026#34;opsathlan-${var.scenario_id}-subnet\u0026#34; network_id = openstack_networking_network_v2.opsathlan_network.id cidr = var.subnet_cidr ip_version = 4 dns_nameservers = [\u0026#34;8.8.8.8\u0026#34;, \u0026#34;8.8.4.4\u0026#34;] } # Router ìƒì„± resource \u0026#34;openstack_networking_router_v2\u0026#34; \u0026#34;opsathlan_router\u0026#34; { name = \u0026#34;opsathlan-${var.scenario_id}-router\u0026#34; admin_state_up = true external_network_id = data.openstack_networking_network_v2.ext_network.id } # Router Interface ìƒì„± resource \u0026#34;openstack_networking_router_interface_v2\u0026#34; \u0026#34;router_interface\u0026#34; { router_id = openstack_networking_router_v2.opsathlan_router.id subnet_id = openstack_networking_subnet_v2.opsathlan_subnet.id } ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” keypairë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\n1 2 3 4 5 # Keypair ìƒì„± resource \u0026#34;openstack_compute_keypair_v2\u0026#34; \u0026#34;opsathlan_keypair\u0026#34; { name = \u0026#34;opsathlan-${var.scenario_id}-keypair\u0026#34; public_key = file(var.pubkey_file_path) } Nova ì¸ìŠ¤í„´ìŠ¤ì˜ ì ‘ê·¼ ì œì–´ë¥¼ ê´€ë¦¬í•˜ëŠ” Security groupë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. security group ruleì€ variables.tf ì—ì„œ ë¦¬ìŠ¤íŠ¸ë¡œ ë°›ì€ í›„ì— ì ìš©í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # Security Group ìƒì„± resource \u0026#34;openstack_networking_secgroup_v2\u0026#34; \u0026#34;opsathlan_secgroup\u0026#34; { name = \u0026#34;opsathlan-${var.scenario_id}-secgroup\u0026#34; description = \u0026#34;OpsAthaln Security Group\u0026#34; delete_default_rules = false } # Security Group Rule ìƒì„± resource \u0026#34;openstack_networking_secgroup_rule_v2\u0026#34; \u0026#34;secgroup_rules\u0026#34; { count = length(var.allowed_ports) direction = \u0026#34;ingress\u0026#34; ethertype = \u0026#34;IPv4\u0026#34; protocol = lookup(var.allowed_ports[count.index], \u0026#34;protocol\u0026#34;, \u0026#34;tcp\u0026#34;) port_range_min = lookup(var.allowed_ports[count.index], \u0026#34;port_range_min\u0026#34;) port_range_max = lookup(var.allowed_ports[count.index], \u0026#34;port_range_max\u0026#34;) remote_ip_prefix = lookup(var.allowed_ports[count.index], \u0026#34;remote_ip_prefix\u0026#34;, \u0026#34;0.0.0.0/0\u0026#34;) security_group_id = openstack_networking_secgroup_v2.opsathlan_secgroup.id } variables.tf ì—ì„œëŠ” ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í¬íŠ¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.\nssh spring boot application(8080) cAdvisor(8081) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // variables.tf variable \u0026#34;allowed_ports\u0026#34; { description = \u0026#34;List of maps defining allowed ports for the security group. Each map should include protocol, port_range_min, port_range_max, and optionally remote_ip_prefix.\u0026#34; type = list(object({ protocol = string port_range_min = number port_range_max = number remote_ip_prefix = optional(string, \u0026#34;0.0.0.0/0\u0026#34;) })) default = [ { protocol = \u0026#34;tcp\u0026#34; port_range_min = 22 port_range_max = 22 }, { protocol = \u0026#34;tcp\u0026#34; port_range_min = 8080 port_range_max = 8080 }, { protocol = \u0026#34;tcp\u0026#34; port_range_min = 8081 port_range_max = 8081 } ] } Floating ip í• ë‹¹ ë° ì„¤ì • floating ipë¥¼ ìƒì„±í•œ í›„ì— nova instanceì— ë¶™í™ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # 5. Floating IP ìƒì„± ë° ì—°ê²° resource \u0026#34;openstack_networking_floatingip_v2\u0026#34; \u0026#34;floating_ip\u0026#34; { pool = data.openstack_networking_network_v2.ext_network.name } # 4. Nova Instance ìƒì„± resource \u0026#34;openstack_compute_instance_v2\u0026#34; \u0026#34;nova_instance\u0026#34; { name = \u0026#34;opsathlan-${var.scenario_id}-instance\u0026#34; image_name = var.image_name flavor_name = var.flavor_name key_pair = openstack_compute_keypair_v2.opsathlan_keypair.name security_groups = [openstack_networking_secgroup_v2.opsathlan_secgroup.name] network { uuid = openstack_networking_network_v2.opsathlan_network.id } depends_on = [openstack_networking_subnet_v2.opsathlan_subnet] } resource \u0026#34;openstack_compute_floatingip_associate_v2\u0026#34; \u0026#34;floating_ip_association\u0026#34; { floating_ip = openstack_networking_floatingip_v2.floating_ip.address instance_id = openstack_compute_instance_v2.nova_instance.id } Ansibleë¥¼ í™œìš©í•œ í™˜ê²½ êµ¬ì„± ë° ì»¨í…Œì´ë„ˆ ì‹¤í–‰ Ansibleë¥¼ í™œìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆëŠ” í™˜ê²½ì„ êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ì´ 4ê°œì˜ roleë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.\njava ì„¤ì¹˜ docker ì„¤ì¹˜ springboot ì´ë¯¸ì§€ ë¹Œë“œ ë° ìˆ˜í–‰ cAdvisor ì‹¤í–‰ ğŸ¤” ì—¬ë‹´\nJenkinsì™€ ê°™ì´ ìë™í™” ë„êµ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ ì´ˆë°˜ì—ëŠ” ë¶ˆí•„ìš”í•˜ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤. ë°°í¬í•˜ê³ ì í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê·œëª¨ëŠ” í˜„ì €í•˜ê²Œ ì‘ì•˜ê³ , ë‚œì´ë„ê°€ ìˆì–´ ì˜ëª»í•˜ë©´ ì˜ˆìƒë³´ë‹¤ ì‹œê°„ì„ ë§ì´ í• ì• í•  ìˆ˜ ìˆë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.\nspring boot application ë°°í¬ application ì†Œê°œ ë°°í¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê°„ë‹¨í•˜ê²Œ hello worldë§Œ ë°˜í™˜í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 @RestController public class EchoController { @GetMapping(\u0026#34;/echo\u0026#34;) public String echo() { return \u0026#34;Hello, World!\u0026#34;; } } ë¹Œë“œ ë° ì‹¤í–‰ Ansibleë¥¼ í™œìš©í•˜ì—¬ spring boot application ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ë•Œ ì»¨í…Œì´ë„ˆëŠ” 8080 ì™¸ë¶€ í¬íŠ¸ë¡œ ì—´ì–´ë‘¡ë‹ˆë‹¤.\nìˆœì„œ\nRepository clone Spring boot application build Container Image build Docker ì‹¤í–‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 --- - name: Clone Spring Boot application repository git: repo: \u0026#34;https://github.com/S0okJu/OpsAthlan.git\u0026#34; dest: /home/ubuntu/app/spring-boot-app version: sc/1 - name: Build Spring Boot application using Gradle command: ./gradlew clean build args: chdir: /home/ubuntu/app/spring-boot-app/scenario_01/spring_echo register: gradle_build failed_when: gradle_build.rc != 0 - name: Check if JAR file exists stat: path: /home/ubuntu/app/spring-boot-app/scenario_01/spring_echo/build/libs/ register: jar_dir - name: Fail if JAR file does not exist fail: msg: \u0026#34;JAR file was not built successfully.\u0026#34; when: jar_dir.stat.exists == False or jar_dir.stat.isdir == False - name: Copy Dockerfile for Spring Boot copy: src: Dockerfile dest: /home/ubuntu/app/spring-boot-app/scenario_01/spring_echo/Dockerfile - name: Build Docker image for Spring Boot application docker_image: name: echo-springboot-app tag: latest source: build build: path: /home/ubuntu/app/spring-boot-app/scenario_01/spring_echo - name: Run Spring Boot container docker_container: name: sc1-springboot-app image: echo-springboot-app:latest state: started ports: - \u0026#34;8080:8080\u0026#34; ìì„¸í•œ ì½”ë“œëŠ” github ì°¸ê³  ë°”ëë‹ˆë‹¤.\ncAdvisor cAdvisorëŠ” ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë°›ê³  ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤. ì»¨í…Œì´ë„ˆëŠ” 8081ë¡œ ì™¸ë¶€í¬íŠ¸ë¥¼ ì—´ì–´ ê°œë°œìê°€ ëŒ€ì‹œë³´ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 --- - name: Pull cAdvisor image docker_image: name: google/cadvisor:latest source: pull - name: Run cAdvisor container docker_container: name: cadvisor image: google/cadvisor:latest state: started ports: - \u0026#34;8081:8080\u0026#34; volumes: - \u0026#34;/:/rootfs:ro\u0026#34; - \u0026#34;/var/run:/var/run:ro\u0026#34; - \u0026#34;/sys:/sys:ro\u0026#34; - \u0026#34;/var/lib/docker/:/var/lib/docker:ro\u0026#34; ì»¨í…Œì´ë„ˆ ì§€í‘œ ëª¨ë‹ˆí„°ë§ cAdvisor ì ‘ì† {floating_ip}:8081ì— ì ‘ì†í•©ë‹ˆë‹¤. container ì°½ì— ë“¤ì–´ê°€ springboot applicationì„ í™•ì¸í•©ë‹ˆë‹¤.\nspringboot applicationì— ëŒ€í•œ ê¸°ë³¸ì ì¸ ì§€í‘œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nTest ìì²´ì ìœ¼ë¡œ ë§Œë“  test ë„êµ¬ì¸ gonetworkerë¥¼ í™œìš©í•˜ê² ìŠµë‹ˆë‹¤.\nGoNetWorker\nìì²´ì ìœ¼ë¡œ ë§Œë“  ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸ ë„êµ¬ì…ë‹ˆë‹¤. ì„œë²„ì— requestë¥¼ ì—°ì†ì—ì„œ ìš”ì²­í•œë‹¤ëŠ” íŠ¹ì§•ì´ ìˆìŠµë‹ˆë‹¤.\në¸”ë¡œê·¸ ì‘ì„± ê¸°ì¤€ GoNetWorkerëŠ” ë™ì‹œë¡œ ì „ì†¡í•˜ëŠ” ê¸°ëŠ¥ì´ ì—†ì–´ ìˆœì°¨ì ìœ¼ë¡œ requestë¥¼ ìš”ì²­í•©ë‹ˆë‹¤. request ìš”ì²­ ì´í›„ ë¬´ì‘ìœ„ë¡œ sleepí•©ë‹ˆë‹¤. ì—°ì†ì ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²ƒì´ë¼ê³  ì˜ˆìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nNetwork ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬ìœ¨ì„ ë³´ë©´ ì²˜ë¦¬ê°€ ë˜ì—ˆë‹¤ê°€ 0byteë¡œ ë–¨ì–´ì¡Œë‹¤ê°€ ë‹¤ì‹œ ìƒìŠ¹í•©ë‹ˆë‹¤. ì´ëŠ” ì €í¬ê°€ ì‚¬ìš©í•œ ë„êµ¬ì¸ GoNetWorkerì˜ íŠ¹ì§• ë•Œë¬¸ì— ë°œìƒí•œ ê·¸ë˜í”„ì…ë‹ˆë‹¤.\nê·¸ ì´ì™¸ì—ë„ ì•„ë˜ì™€ ê°™ì€ íŠ¹ì§•ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní‰ê· ì ìœ¼ë¡œ 1200bytesë¥¼ ë„˜ì–´ê°€ì§€ ì•ŠëŠ”ë‹¤. Memory ê·¸ì— ë¹„í•´ memoryëŠ” ì ì§„ì ìœ¼ë¡œ ìƒìŠ¹í•˜ëŠ” ê·¸ë˜í”„ë¥¼ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë˜í”„ë¥¼ ë³´ë‹ˆ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¶ˆí•„ìš”í•œ ë©”ëª¨ë¦¬ ìì›ì„ ë‚­ë¹„í•œë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.\nì›ì¸ì„ êµ¬ì²´ì ìœ¼ë¡œ íŒŒì•…í•˜ê¸° ìœ„í•´ì„œëŠ” springbootì— ëŒ€í•œ ë©”íŠ¸ë¦­ì´ í•„ìš”í•©ë‹ˆë‹¤. cAdvisor ë§Œìœ¼ë¡œëŠ” ì •êµí•œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ì— í•œê³„ê°€ ìˆìœ¼ë¯€ë¡œ í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ í™œìš©í•´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.\në‹¤ìŒí¸ì—ëŠ” \u0026hellip; ë‹¤ìŒ í¸ì—ëŠ” í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ springboot ê´€ë ¨ ë©”íŠ¸ë¦­ìŠ¤ë¥¼ ìˆ˜ì§‘í•˜ê³  ë¬¸ì œë¥¼ í•´ê²°í•´ ë³´ê² ìŠµë‹ˆë‹¤.\n","date":"2024-09-19T00:00:00Z","permalink":"https://s0okju.github.io/p/opsathlan-1/","title":"OpsAthlan 1 - Simple echo server"},{"content":"ê°œì¸ì ìœ¼ë¡œ ìš´ì˜ ëª¨ë‹ˆí„°ë§ì„ ê³µë¶€í•˜ê³  ì‹¶ì—ˆë‹¤. ë¬¸ì œëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì—†ë‹¤ëŠ” ê²ƒì´ì—ˆë‹¤. ëŒ€ì•ˆìœ¼ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì„œ ê·¹í•œì˜ ìƒí™©ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë‚˜ëŠ” í˜„ì‹¤ì ì¸ ìƒí™©ì„ ì¬í˜„í•˜ê³  ì‹¶ì—ˆë‹¤. ê·¸ë˜ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ë‚´ ì„œë²„ë¥¼ ì‚¬ìš©í•œ ê²ƒì²˜ëŸ¼ íŒ¨í‚·ì„ ë³´ë‚´ëŠ” ë„êµ¬ë¥¼ ë§Œë“¤ê¸°ë¡œ ê²°ì‹¬í–ˆë‹¤.\nGoNetWorker GoNetWorkerëŠ” Goë¥¼ í™œìš©í•œ ê°€ìƒ ìš´ì˜ ì‹œë®¬ë ˆì´ì…˜ ë„êµ¬ì´ë‹¤.1 ë¯¸ë¦¬ ì„¤ì •í•œ endpoint ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„œë²„ì— ëœë¤ìœ¼ë¡œ requestë¥¼ ë³´ë‚´ëŠ” ë„êµ¬ì´ë‹¤.\nendpoint ì •ì˜ - works.json í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ” endpointì— ëŒ€í•œ ì •ë³´ë¥¼ ì •í™•í•˜ê²Œ ê¸°ì…í•´ì•¼ í•œë‹¤.\nsettings requestë¥¼ ë³´ë‚´ê¸° ìœ„í•œ ì„¤ì • ì •ë³´ works requestë¥¼ ë³´ë‚¼ ëŒ€ìƒì— ëŒ€í•œ ì •ë³´ tasks urlì˜ ê²½ë¡œ ì •ë³´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;settings\u0026#34;: { \u0026#34;sleep_range\u0026#34;: 5 // request ì „ì†¡ ì‹œ ëŒ€ê¸°ì‹œê°„ ë²”ìœ„ }, \u0026#34;works\u0026#34;: [ { \u0026#34;uri\u0026#34;: \u0026#34;http://localhost\u0026#34;, \u0026#34;port\u0026#34;: 8080, \u0026#34;tasks\u0026#34;: [ { \u0026#34;path\u0026#34;: \u0026#34;/users/1\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;GET\u0026#34; } ] } ] } êµ¬ì¡° GoNetWorkerëŠ” ì‚¬ìš©ìê°€ íŠ¹ë³„í•œ í–‰ë™ì„ ì·¨í•˜ê¸° ì „ê¹Œì§€ ì§€ì†ì ìœ¼ë¡œ requestë¥¼ ë³´ë‚¸ë‹¤. ì´ˆê¸°ì—ëŠ” ctrl + cë¥¼ í´ë¦­í–ˆì„ ê²½ìš° ì‹¤í–‰ì´ ì¤‘ë‹¨ë  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í–ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 go func() { for { select { case \u0026lt;-stopChan: fmt.Println(\u0026#34;Received interrupt signal. Shutting down...\u0026#34;) return default: work := config.Works[rand.Intn(len(config.Works))] task := work.Tasks[rand.Intn(len(work.Tasks))] wg.Add(1) client := \u0026amp;http.Client{} go makeRequest(work, task, client, \u0026amp;wg, config.Settings.SleepRange) randomSleep := time.Duration(rand.Intn(config.Settings.SleepRange)) * time.Second time.Sleep(randomSleep) } } }() ì„¸ë¶€ì ì¸ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.\nì˜ˆì‹œ 1 go run main.go GoNetWorkerë¡œ ì‹¤í–‰ë˜ë©´ ì•„ë˜ì™€ ê°™ì´ ëœë¤ìœ¼ë¡œ requestë¥¼ ë³´ë‚´ê²Œ ëœë‹¤.\nì„œë²„ì—ì„œ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì •ìƒì ìœ¼ë¡œ requestë¥¼ ë°›ì•˜ìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.\në³´ì™„í•  ì  ì´ˆê¸° ë²„ì „ì´ë¼ ì¶”ê°€í•´ì•¼í•  ì ì´ ë§ë‹¤. ë‹¤ìŒ ê¸€ì—ì„œëŠ” ì•„ë˜ì˜ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³  ì°¾ì•„ì˜¤ê² ë‹¤.\nGetìœ¼ë¡œ ì „ì†¡í•  ê²½ìš° ë³´ì™„ pathì— ì‹ë³„ìê°€ ìˆì„ ê²½ìš° parameterê°€ ìˆì„ ê²½ìš° Postë¡œ ì „ì†¡í•  ê²½ìš° goë¥¼ ë¹Œë“œí•˜ê¸° ìœ„í•œ makefile ì´ë ‡ê²Œ ì„¤ëª…í•˜ëŠ”ê²Œ ë§ëŠ”ì§€ ëª¨ë¥´ê² ë‹¤.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-09-15T00:00:00Z","permalink":"https://s0okju.github.io/p/gonetworker-1/","title":"GoNetWorker - 1. GoNetWorker ì†Œê°œì™€ ì´ˆê¸° ê¸°ëŠ¥"},{"content":"Kubernetes ì„¤ì¹˜ëŠ” ë³€ì¬í•œë‹˜ì˜ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤.\nAnsible Ping ë¬¸ì œ Ansible Ping ìˆ˜í–‰ ì‹œ ëª¨ë“  ë…¸ë“œì— ì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤. ì—ëŸ¬ ë©”ì„¸ì§€ë¥¼ í™•ì¸í•´ë³´ë‹ˆ ssh í‚¤ê°€ ì œëŒ€ë¡œ ì ìš©ë˜ì§€ ì•Šì€ ê²ƒì²˜ëŸ¼ ë³´ì˜€ë‹¤.\n1 2 3 4 5 Kubernetes-k8s-node-nf-2 | UNREACHABLE! =\u0026gt; { \u0026#34;changed\u0026#34;: false, \u0026#34;msg\u0026#34;: \u0026#34;Data could not be sent to remote host \\\u0026#34;10.0.2.176\\\u0026#34;. Make sure this host can be reached over ssh: kex_exchange_identification: Connection closed by remote host\\r\\nConnection closed by UNKNOWN port 65535\\r\\n\u0026#34;, \u0026#34;unreachable\u0026#34;: true } Ansibleì€ sshë¥¼ í™œìš©í•˜ì—¬ target ë…¸ë“œì™€ í†µì‹ í•œë‹¤.\ní•´ê²°ì±… 1. ê³µê°œí‚¤ ì•Œê³ ë¦¬ì¦˜ ë³€ê²½ openstack logë¥¼ í™•ì¸í•´ë³´ë‹ˆ debian imageì— ê³µê°œí‚¤ê°€ authorized_keysì— ì œëŒ€ë¡œ ë³µì‚¬ë˜ì§€ ì•Šì•„ ssh í†µì‹ ì„ ì œëŒ€ë¡œ ìˆ˜í–‰í•˜ì§€ ëª»í•œ ê²ƒì´ì—ˆë‹¤.\nssh í‚¤ë¥¼ ed25519 ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ìƒì„±í•˜ë©´ í‚¤ê°€ ì œëŒ€ë¡œ ë³µì‚¬ë˜ì§€ ì•Šì•˜ì§€ë§Œ rsaë¡œ ë³€ê²½í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ í‚¤ê°€ ë³µì‚¬ëœë‹¤.\në³´ì•ˆì„ ê³ ë ¤í•˜ë©´ rsaë³´ë‹¤ëŠ” ed25519 ì•Œê³ ë¦¬ì¦˜ì´ ê¶Œì¥ëœë‹¤.1\në‹¤ì‹œ pingì„ ìˆ˜í–‰í•˜ë©´ ì œëŒ€ë¡œ ìˆ˜í–‰ëœë‹¤.\ní•´ê²°ì±… 2. ssh-agent ì‹¤í–‰ ë§Œì•½ì— ì›ê²©ìœ¼ë¡œ openstack ì„œë²„ì— ì ‘ì†í•œë‹¤ê³  ê°€ì •í•´ë³´ì. ì‚¬ìš©ìë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ì„¸ì…˜ì„ í•œë²ˆ ëŠê²Œ ë˜ë©´ ë™ì¼í•œ ì´ìœ ë¡œ ë¬¸ì œê°€ ìƒê¸´ë‹¤.\nìš°ì„  ìš°ë¦¬ê°€ ì´ˆê¸°ì— ansibleë¥¼ ì„¸íŒ…í•  ë•Œ ssh-agentë¥¼ ì‹¤í–‰í•˜ê³  private keyë¥¼ ì¶”ê°€í•˜ëŠ” ì‘ì—…ì„ í•œë‹¤. ssh-agentëŠ” ssh-add ëª…ë ¹ì–´ë¥¼ í™œìš©í•˜ì—¬ í‚¤ë¥¼ ê¸°ì–µí•˜ê³  ì‚¬ìš©í•˜ê²Œ ëœë‹¤.\n1 2 3 4 # ë°±ê·¸ë¼ìš´ë“œì— agent ì‹¤í–‰ eval \u0026#34;$(ssh-agent -s)\u0026#34; # í‚¤ ì¶”ê°€ ssh-add ~/.ssh/id_rsa ssh-agentëŠ” í”„ë¡œì„¸ìŠ¤ë¡œì¨ ì‘ë™ë¼ ì¤‘ê°„ì— sshê°€ ì¤‘ë‹¨ë˜ë”ë¼ë„ í”„ë¡œì„¸ìŠ¤ê°€ ë‚¨ì•„ìˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ í˜„ì¬ ì‚¬ìš©ì(stack)ê°€ ì‹¤í–‰ì‹œí‚¨ í”„ë¡œì„¸ìŠ¤ë¥¼ ë¨¼ì € ì—†ì• ê³  ssh-agentë¥¼ ì‹¤í–‰ì‹œí‚¤ë„ë¡ êµ¬í˜„í•˜ë©´ ëœë‹¤.\nopenstackì€ stack ì‚¬ìš©ìê°€ ê´€ë¦¬í•œë‹¤. stack ì‚¬ìš©ìì˜ ~/.bashrc ì— ssh-agentë¥¼ ì¶”ê°€í•˜ì—¬ stack ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸ ì„±ê³µí• ë•Œë§ˆë‹¤ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.\n1 2 3 4 5 6 7 8 9 # Ansible ssh agent ## Delete used ssh-agent if [ -f ~/scripts/delete_ssh_agent.sh ]; then . ~/scripts/delete_ssh_agent.sh fi ## Create new ssh-agent eval $(ssh-agent -s) ssh-add ~/.ssh/id_rsa.kubespray delete_ssh_agent.sh ì€ openstackì„ ê´€ë¦¬í•˜ëŠ” ì‚¬ìš©ì(stack)ê°€ ê°€ì§€ê³  ìˆëŠ” ssh-agentë¥¼ ì‚­ì œí•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ì´ë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #!/bin/bash # Get all PIDs of ssh-agent processes owned by the user \u0026#39;stack\u0026#39; pids=$(pgrep -u stack ssh-agent) # Check if any PIDs were found if [ -z \u0026#34;$pids\u0026#34; ]; then echo \u0026#34;No ssh-agent processes found for user \u0026#39;stack\u0026#39;.\u0026#34; exit 1 else # Loop through each PID and attempt to kill the process for pid in $pids; do echo \u0026#34;Killing ssh-agent process with PID $pid...\u0026#34; kill \u0026#34;$pid\u0026#34; sleep 1 # Check if the process was successfully killed if pgrep -u stack -x ssh-agent \u0026gt; /dev/null; then echo \u0026#34;Failed to kill process with PID $pid. You may need to use sudo.\u0026#34; else echo \u0026#34;Successfully killed process with PID $pid.\u0026#34; fi done fi ìƒˆë¡­ê²Œ ì ‘ì†í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.\nì´ ë°©ì‹ì€ ë‹¨ì¼ ì‚¬ìš©ìë§Œ ê´€ë¦¬í•œë‹¤ëŠ” ê°€ì •í•˜ì—ì„œ ë§Œë“  í•´ê²°ì±…ì´ë‹¤.\nNameserver ë¬¸ì œ playbookë¥¼ ë°°í¬í•´ë³´ì.\n1 ansible-playbook --become -i inventory/test-cluster/hosts cluster.yml nameserverë¡œ ì¸í•´ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤. ë³´í†µ ì´ëŸ° ë¬¸ì œëŠ” nameserverì˜ ì„¤ì •ì´ ì˜ëª»ëœ ê²½ìš°ì— ë°œìƒë˜ë©° ì•ˆì „í•œ google dns(8.8.8.8, 8.8.4.4)ë¡œ ì„¤ì •í•˜ë©´ í•´ê²°ëœë‹¤.\n1 \u0026#34;msg\u0026#34;: \u0026#34;E: Failed to fetch http://security.debian.org/debian-security/pool/updates/main/p/python-apt/python-apt-common_1.8.4.3_all.deb Temporary failure resolving \u0026#39;deb.debian.org\u0026#39;\\nE: Failed to fetch http://security.debian.org/debian-security/pool/updates/main/p/python-apt/python3-apt_1.8.4.3_amd64.deb Temporary failure resolving \u0026#39;deb.debian.org\u0026#39;\\nE: Unable to fetch some archives, maybe run apt-get update or try with --fix-missing?\u0026#34;, í•´ê²°ì±… 1. resolv.conf ìˆ˜ì •(ì˜ëª»ëœ ì ‘ê·¼) DNSë¥¼ ì„¤ì •í•˜ëŠ” resolv.conf ë¥¼ í™•ì¸í•´ë³´ë©´ 127.0.0.53ë¡œ ì„¤ì •ë˜ì–´ ìˆë‹¤. ì•ˆì „í•˜ê²Œ google dns ì„œë²„ë¡œ ë³€ê²½í•´ë³´ì\n1 2 3 # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8) # DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN nameserver 127.0.0.53 ì‹¤ì œë¡œëŠ” ìš°ë¦¬ê°€ ì§ì ‘ ë³€ê²½í•˜ë©´ ì•ˆëœë‹¤.\nDO NOT EDIT THIS FILE BY HAND \u0026ndash; YOUR CHANGES WILL BE OVERWRITTEN\nresolv.confì€ /run í´ë” ë‚´ì— ì‹¬ë³¼ë§ ë§í¬ê°€ ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ë§ˆìŒëŒ€ë¡œ ìˆ˜ì •í•˜ëŠ” ê²ƒì€ ê¶Œì¥í•˜ì§€ ì•ŠëŠ”ë‹¤.2\nì‹¤ì œë¡œ virt-customize ë¥¼ í™œìš©í•´ì„œ resolv.confë¥¼ ìˆ˜ì •í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ë³„ë„ë¡œ ë§Œë“¤ì—ˆì§€ë§Œ ì˜ë¯¸ê°€ ì—†ì—ˆë‹¤.\ní•´ê²°ì±… 2. Terraform ìˆ˜ì • ê°€ì¥ ì•ˆì „í•œ ì ‘ê·¼ë²•ì´ë‹¤. ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ë¥¼ ë³´ë©´ ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œë“¤ì´ kubernetes-network subnetë¥¼ í™œìš©í•œë‹¤.\nOpenstackì˜ subnetì— DNS nameserverë¥¼ ëª…ì‹œí•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ Openstack ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°°í¬í•˜ëŠ” terraform íŒŒì¼ì„ ìˆ˜ì •í•œë‹¤. ~/kubespray/contrib/terraform/openstack/modules/network/main.tf ë‚´ì— dns_nameservers ë¥¼ google dnsë¡œ ë³€ê²½ì‹œí‚¨ë‹¤.\n1 2 3 4 5 6 7 8 resource \u0026#34;openstack_networking_subnet_v2\u0026#34; \u0026#34;k8s\u0026#34; { name = \u0026#34;${var.cluster_name}-internal-network\u0026#34; count = var.use_neutron network_id = openstack_networking_network_v2.k8s[count.index].id cidr = var.subnet_cidr ip_version = 4 dns_nameservers = [\u0026#34;8.8.8.8\u0026#34;,\u0026#34;8.8.4.4\u0026#34;] } ì›ë˜ë¼ë©´ variables.tfë¥¼ ìˆ˜ì •í•´ì•¼ í–ˆì§€ë§Œ ì œëŒ€ë¡œ ì ìš©ì´ ë˜ì§€ ì•Šì•˜ê³ , google dns serverëŠ” ê±°ì˜ ë¶ˆë³€ì— ê°€ê¹ê¸° ë•Œë¬¸ì— main.tfì— ì§ì ‘ ì‘ì„±í•´ë„ ëœë‹¤ê³  íŒë‹¨í–ˆë‹¤.\nì•„ë˜ì™€ ê°™ì´ ì œëŒ€ë¡œ ì ìš©ëœë‹¤.\nê·¸ ì´ì™¸ì˜ debian ë¬¸ì œë“¤ ê·¸ ì´í›„ë¶€í„° debianì—ëŠ” ì¡ë‹¤í•œ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.\ní•´ê²°ì±… 1. í´ë¼ìš°ë“œ ì´ë¯¸ì§€ë¥¼ ubuntuë¡œ ë³€ê²½ í´ë¼ìš°ë“œ ì´ë¯¸ì§€ë¥¼ debianì—ì„œ ubuntuë¡œ ë³€ê²½í–ˆë‹¤. ssh í‚¤ë¥¼ ed25519 ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì ìš©í•´ë„ ì •ìƒì ìœ¼ë¡œ ì‘ë™ëœë‹¤. Ansible playbookë¥¼ ì‘ë™ì‹œí‚¤ë©´ ì •ìƒì ìœ¼ë¡œ kubernetesê°€ ë°°í¬ëœë‹¤.\nhttps://dev.to/ccoveille/how-to-generate-a-secure-and-robust-ssh-key-in-2024-3f4f\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://askubuntu.com/questions/351168/diffrence-between-the-dns-setting-in-etc-resolv-conf-and-etc-network-interfaces\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-08-17T00:00:00Z","permalink":"https://s0okju.github.io/p/openstack-kubernetes-installation-2/","title":"Openstack - Kubesprayë¥¼ í™œìš©í•œ Kubernetes ì„¤ì¹˜ ì‹œ Ansible ì˜¤ë¥˜"},{"content":"Openstack ì„¤ì¹˜ im2sh.log velogì„ ì°¸ê³ í•´ì„œ Devstackì„ í™œìš©í•´ Openstackì„ ì„¤ì¹˜í•˜ë©´ ëœë‹¤. ë‹¤ë§Œ ë¡œì»¬ í™˜ê²½ì—ì„œë§Œ ìˆ˜í–‰í•  ì˜ˆì •ì´ë¯€ë¡œ ê°€ìƒ public ip ëŒ€ì—­ ìƒì„±ì€ ì œì™¸í–ˆë‹¤.\nì´ë¯¸ì§€ ìƒì„± Novaì— ì˜¬ë¦° ì´ë¯¸ì§€ë¥¼ ìƒì„±í•œë‹¤. Ubuntuë³´ë‹¤ Debianì´ ê°€ë³ê³  ì»¤ìŠ¤í…€í•˜ê¸° ìš©ì´í•´ì„œ ì„ íƒ1í•˜ê²Œ ë˜ì—ˆë‹¤. ì•„ë˜ì˜ ëª…ë ¹ì–´ëŠ” debian ê³µì‹ í™ˆí˜ì´ì§€ë¥¼ ì°¸ê³ í–ˆë‹¤.\n1 2 3 4 5 6 7 wget https://cloud.debian.org/cdimage/cloud/OpenStack/current-10/debian-10-openstack-amd64.qcow2 openstack image create \\ --container-format bare \\ --disk-format qcow2 \\ --file debian-10-openstack-amd64.qcow2 \\ debian-10-openstack-amd64 dashboardë¥¼ ë³´ë©´ ì •ìƒì ìœ¼ë¡œ ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œëœ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.\nKubesprayë¥¼ í™œìš©í•œ Kubernetes êµ¬ì¶• OS - Ubuntu 24.04 Openstack - 2024.1 Kubespray - v2.21.0 Terraform - v1.9.3 ì „ë°˜ì ì¸ ì„¤ì¹˜ ê³¼ì •ì€ ë³€ì¬í•œë‹˜ì˜ velogë¥¼ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤.\nopenstack v2, v3 APIëŠ” ë‹¤ë¥¸ì ì´ ë§ìŠµë‹ˆë‹¤. ë§Œì•½ì— v2 ë²„ì „ìœ¼ë¡œ í•˜ê³  ì‹¶ë‹¤ë©´ ìš´ì˜ì²´ì œì™€ kubespray, terraform ë²„ì „ì„ ë§ì¶”ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.\nssh í†µì‹ ì„ ìœ„í•œ ê³µê°œí‚¤ ìƒì„± ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ ì„¤ì •ì„ ìœ„í•´ Ansibleë¥¼ ì‚¬ìš©í•œë‹¤. Ansibleì€ sshë¥¼ í™œìš©í•˜ì—¬ ëŒ€ìƒì— ì ‘ì†í•  ìˆ˜ ìˆë‹¤. ì´ í‚¤ëŠ” ì¶”í›„ Kubernetesì—ì„œ ë…¸ë“œë¼ë¦¬ í†µì‹ í•  ìˆ˜ ìˆëŠ” openstackì˜ keypairë¡œì¨ í™œìš©ëœë‹¤.\n1 2 3 4 5 ssh-keygen -t ed25519 -N \u0026#39;\u0026#39; -f ~/.ssh/id_rsa.kubespray eval $(ssh-agent -s) ssh-add ~/.ssh/id_rsa.kubespray ì˜¤ë¥˜ - One of auth_url or cloud must be specified ê²°ë¡ ë¶€í„° ë§í•˜ìë©´ í´ë¼ì´ì–¸íŠ¸ì™€ ê´€ë ¨ëœ í™˜ê²½ ë³€ìˆ˜ê°€ ì €ì¥ë˜ì§€ ì•Šì•„ì„œ ìƒê¸´ ì¼ì´ë‹¤.\ní•´ê²° ê³¼ì • ì•„ë˜ì˜ ì˜¤ë¥˜ë¥¼ ì½ì–´ë³´ë©´ openstackì˜ providerë¥¼ ì •ì˜í•˜ëŠ” tfíŒŒì¼ì— ì†ì„±ì´ ì •ì˜ë˜ì–´ ìˆì§€ ì•Šë‹¤ê³  í•œë‹¤.\n~/kubespray/contrib/terraform/openstack/version.tf ë¥¼ ë³´ë©´ providerê°€ ì •ì˜ë˜ì–´ ìˆë‹¤.\nê³µì‹ í™ˆí˜ì´ì§€ë¥¼ ë³´ë©´ ì„¤ì •ê°’ì„ ì¶”ê°€í•  ìˆ˜ ìˆëŠ”ë° ì „ë¶€ë‹¤ ì„ íƒì‚¬í•­ì´ì§€ë§Œ Openstack ì„¤ì •ê³¼ ê´€ë ¨ í™˜ê²½ë³€ìˆ˜ê°€ ë°˜ë“œì‹œ ì €ì¥ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ terraformì— ë³„ë„ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.\n1 2 3 4 5 6 7 8 # Configure the OpenStack Provider provider \u0026#34;openstack\u0026#34; { user_name = \u0026#34;admin\u0026#34; tenant_name = \u0026#34;admin\u0026#34; password = \u0026#34;pwd\u0026#34; auth_url = \u0026#34;http://myauthurl:5000/v3\u0026#34; region = \u0026#34;RegionOne\u0026#34; } ì¦‰ ìœ„ì™€ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•œ ê²ƒì€ í´ë¼ì´ì–¸íŠ¸ì™€ identity ì„œë¹„ìŠ¤ê°€ ìƒí˜¸ ì‘ìš©ì„ ìœ„í•œ í™˜ê²½ ë³€ìˆ˜ê°€ ì—†ì–´ì„œ ìƒê¸´ ì¼ì¸ ê²ƒì´ë‹¤.\në‹¤ë§Œ ìˆ˜ë™ìœ¼ë¡œ terraform íŒŒì¼ì— ì‘ì„±í•˜ê±°ë‚˜ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ê²Œ ë˜ë©´ Domain ì •ë³´ê°€ ë¶€ì •í™•í•˜ë‹¤ëŠ” ì—ëŸ¬ ë©”ì„¸ì§€ë¥¼ ë§ˆì£¼í•  ìˆ˜ ìˆë‹¤. openstack ë²„ì „ì— ë”°ë¼ì„œ ì§€ì›í•˜ëŠ” í™˜ê²½ ë³€ìˆ˜ë„ ë‹¤ë¥´ê±°ë‚˜, ê°™ì€ ì¡°ê±´ì— ì‚¬ëŒë§ˆë‹¤ ì‹¤í–‰ ê°€ëŠ¥ ì—¬ë¶€ê°€ ë‹¤ë¥¸ ë“± ë³µí•©ì ì¸ ì´ìœ ê°€ ì¡´ì¬í•œ ê²ƒ ê°™ì•˜ë‹¤.2\ní•´ê²°ì±… Openstackì—ì„œ ì œê³µí•´ì£¼ëŠ” í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ ìŠ¤í¬ë¦½íŠ¸(openrc)ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.\nhorizonì— ì‚¬ìš©ìë¥¼ í´ë¦­í•˜ë©´ openstack rc íŒŒì¼ì´ ìˆëŠ”ë°, ì´ë¥¼ ë‹¤ìš´ë¡œë“œí•´ì„œ ì‹¤í–‰ì‹œí‚¤ë©´ ëœë‹¤.\nLinuxì—ì„œ í™˜ê²½ ë³€ìˆ˜ëŠ” bashë¥¼ exití•˜ëŠ” ìˆœê°„ ì‚¬ë¼ì§„ë‹¤.3 ì»´í“¨í„°ê°€ í•œë²ˆ êº¼ì§€ê²Œ ë˜ë©´ openrc ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê³„ì† ì‹¤í–‰ì‹œì¼œì¤˜ì•¼ í•œë‹¤. í™˜ê²½ë³€ìˆ˜ë¥¼ ì˜ì†ì ìœ¼ë¡œ ì €ì¥í•˜ëŠ” ë°©ë²•ì€ ~/.bashrcë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì´ë‹¤. ë‹¤ìš´ë¡œë“œí•œ rc íŒŒì¼ì„ ì‹¤í–‰ì‹œí‚¤ë„ë¡ íŒŒì¼ì„ ì„¤ì •í•œë‹¤.\n1 2 3 if [ -f ~/rc/k8s-openrc.sh ]; then . ~/rc/k8s-openrc.sh fi ì¤‘ê°„ì— ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥ ë°›ì•„ì•¼ í•˜ë¯€ë¡œ openrc ìŠ¤í¬ë¦½íŠ¸ì— ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„£ëŠ”ë‹¤. ê°œì¸ì ìœ¼ë¡œ ì´ëŸ° ë°©ë²•ì€ ë³´ì•ˆ ì¸¡ë©´ì—ì„œëŠ” ì¢‹ì§€ ì•Šì•„ ë³´ì¸ë‹¤.\n1 2 3 4 5 export OS_USERNAME=\u0026#34;k8s\u0026#34; # With Keystone you pass the keystone password. # echo \u0026#34;Please enter your OpenStack Password for project $OS_PROJECT_NAME as user $OS_USERNAME: \u0026#34; # read -sr OS_PASSWORD_INPUT export OS_PASSWORD=\u0026#34;yourpassword\u0026#34; source ~/.bashrcë¥¼ ìˆ˜í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ í™˜ê²½ ë³€ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì •ëœë‹¤.\në‹¤ì‹œ terraformìœ¼ë¡œ kubernetesë¥¼ ì„¤ì¹˜í•˜ë©´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.\nhttps://www.quora.com/Which-Linux-distribution-is-best-suited-for-a-cloud-server-environment-and-why\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://github.com/terraform-provider-openstack/terraform-provider-openstack/issues/267\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://askubuntu.com/questions/395212/why-environment-variable-disappears-after-terminal-reopen\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-08-01T00:00:00Z","permalink":"https://s0okju.github.io/p/openstack-kubernetes-installation-1/","title":"Openstack - Kubesprayë¥¼ í™œìš©í•œ Kubernetes ì„¤ì¹˜ ì‹œ Terraform ì˜¤ë¥˜"},{"content":"ì„œë²„ ìƒíƒœ ì§€ê¸ˆê¹Œì§€ Multipass ë¥¼ í™œìš©í•˜ì—¬ ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì„ ë§Œë“¤ê³ , ì‹¤ì œë¡œ ì ìš©í•˜ëŠ” ê³¼ì •ì„ ê±°ì³¤ë‹¤. í˜„ì¬ 3ê°œì˜ ë…¸ë“œë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, nfs, mysql, mongoì™€ ê°™ì´ ë°ì´í„°ë² ì´ìŠ¤ê°€ ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ëŠ” nfs, ì  í‚¨ìŠ¤ ì„œë²„ëŠ” ops ì¸ìŠ¤í„´ìŠ¤ì— ì €ì¥í–ˆë‹¤.\nì™œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ statefulsetìœ¼ë¡œ ì •ì˜í•˜ì§€ ì•Šê³  ë³„ë„ë¡œ ì„¤ì¹˜í–ˆëŠ”ì§€ ê¶ê¸ˆí•  ê²ƒì´ë‹¤. ì´ìœ ëŠ” ìµœëŒ€í•œ í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ì²˜ëŸ¼ êµ¬í˜„í•˜ê³  ì‹¶ì–´ì„œì˜€ë‹¤.\nëŒ€ì‹œë³´ë“œ í™•ì¸í•˜ê¸° ì¼ë‹¨ ì¿ ë²„ë„¤í‹°ìŠ¤ ë‚´ì—ì„œëŠ” ì™¸ë¶€ì™€ í†µì‹ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì€ í¬ê²Œ ë‘ ê°€ì§€ì´ë‹¤.\nIngress Nodeport ì¼ë‹¨ ì‚¬ì„¤ ë„¤íŠ¸ì›Œí¬ ë‚´ì—ì„œë§Œ ì‚¬ìš©í•  ì˜ˆì •ì´ë¯€ë¡œ Nodeport ë°©ì‹ì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ê² ë‹¤.\nì˜ˆì œ - Grafana ui í™•ì¸í•˜ê¸° ì˜ˆë¡œ í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í•´ë³´ì. grafana ëŒ€ì‹œë³´ë“œì— ì ‘ê·¼í•  í•„ìš”ì„±ì´ ìˆì„ ê²ƒì´ë‹¤.\ngrafana uiì™€ ê´€ë ¨ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ service typeë¥¼ nodeportë¡œ ë³€ê²½í•´ì¤€ í›„ì— Host server(192.168.50.27)ì— ë°©í™”ë²½ì„ ì„¤ì •í•˜ë©´ 192.168.50.27 ì£¼ì†Œë¡œ Grafana uiì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ ë¬¸ì œë„ ì¡´ì¬í•œë‹¤. ì„œë²„ì— ë¬¸ì œê°€ ìƒê¸°ë©´ ì¬ë°°í¬í•˜ê²Œ ë˜ëŠ”ë°, ì¿ ë²„ë„¤í‹°ìŠ¤ ìŠ¤ì¼€ì¤„ëŸ¬ì— ë”°ë¼ì„œ ë‹¤ë¥¸ ë…¸ë“œì— ë°°ì¹˜ë  ìˆ˜ ìˆë‹¤. ì´ëŸ´ ê²½ìš° ë°°ì¹˜ëœ ë…¸ë“œë¥¼ í™•ì¸í•´ê°€ë©° ê¸°ì¡´ì˜ ë°©í™”ë²½ì„ ë‹«ê³ , ìƒˆë¡œìš´ ë°©í™”ë²½ì„ ì—´ì–´ì¤˜ì•¼ í•œë‹¤.\nì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œëŠ” ì—¬ëŸ¬ ìŠ¤ì¼€ì¤„ë§ ë°©ì‹ì´ ìˆëŠ”ë°1, ê·¸ ì¤‘ ê°„ë‹¨í•œ nodeSelector ë¡œ node1ì— ê°•ì œ ë°°ì¹˜í•˜ì—¬ ì •ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆë‹¤.\nnodeSelector ì„¤ì • node1ì— labelë¥¼ type=uië¡œ ì„¤ì •í•œë‹¤.\n1 kubectl label nodes node1 type=ui grafana ui service type ë³€ê²½ Prometheus, Grafanaì˜ ì›í™œí•œ ì„¤ì¹˜ë¥¼ ìœ„í•´ kube-prometheus helmì„ ì‚¬ìš©í–ˆë‹¤. helm ì°¨íŠ¸ì˜ íŠ¹ì„±ìƒ values.yamlë¥¼ ì„¤ì •í•˜ì—¬ ê°’ì„ ì£¼ì…í•˜ë¯€ë¡œ values.yaml ë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤. kube-prometheus helm ì°¨íŠ¸ëŠ” ì—¬ëŸ¬ helm ì°¨íŠ¸ë¡œ êµ¬ì„±ë˜ì–´ ìˆì–´, ì„¤ì •í•˜ê³  ì‹¶ì€ ì„œë¹„ìŠ¤ì˜ values.yamlë¥¼ ì„¤ì •í•˜ë©´ ëœë‹¤.\nkube-prometheus-stack/charts/grafana/values.yaml íŒŒì¼ì— ëŒ€ëµ 216ë²ˆì§¸ ì¤„ì— ì•„ë˜ì™€ ê°™ì€ ì„œë¹„ìŠ¤ íƒ€ì…ì„ Nodeportë¡œ ë³€ê²½í•œë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ## Expose the grafana service to be accessed from outside the cluster (LoadBalancer service). ## or access it from within the cluster (ClusterIP service). Set the service type and the port to serve it. ## ref: http://kubernetes.io/docs/user-guide/services/ ## service: enabled: true # type: ClusterIP type: NodePort # Custom loadBalancerIP: \u0026#34;\u0026#34; loadBalancerClass: \u0026#34;\u0026#34; loadBalancerSourceRanges: [] port: 80 targetPort: 3000 nodePort: 30060 # Custom helm nodeSelector ì„¤ì • kube-prometheus-stack/charts/grafana/values.yaml ì˜ 314ë²ˆì§¸ ì¤„ì— node1ì— ë°°ì¹˜ë˜ë„ë¡ ì„¤ì •í–ˆë‹¤.\n1 2 3 4 5 ## Node labels for pod assignment ## ref: https://kubernetes.io/docs/user-guide/node-selection/ # nodeSelector: type: ui helmìœ¼ë¡œ ë°°í¬í•œ í›„ pod ë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ë©´ {helmìœ¼ë¡œ ë°°í¬í•œ ì´ë¦„}-grafana-{ë¬¸ìì—´} ë³´ì´ëŠ”ë°, íŒŒë“œ ë‚´ë¶€ì—ëŠ” grafanaì™€ ê´€ë ¨ëœ ì»¨í…Œì´ë„ˆê°€ í¬í•¨ë˜ì–´ ìˆë‹¤. ì¦‰, ìš°ë¦¬ê°€ ì°¾ë˜ uië„ grafana pod ë‚´ë¶€ì— ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.\ngrafana íŒŒë“œì˜ ì •ë³´ë¥¼ ë³´ë©´ nodeSelectorê°€ ì •ìƒì ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.\në°©í™”ë²½ ì„¤ì • node1 ì¸ìŠ¤í„´ìŠ¤ì˜ nodeport(30060)ì— íŠ¸ë˜í”½ì´ ë“¤ì–´ì˜¬ ìˆ˜ ìˆë„ë¡ í—ˆìš©í•œë‹¤.\n1 2 sudo iptables -t nat -I PREROUTING -i enp3s0 -p tcp --dport 30060 -j DNAT --to-destination 10.120.52.23:30060 sudo iptables -I FORWARD 1 -p tcp -d 10.120.52.23 --dport 30060 -j ACCEPT 30060 í¬íŠ¸ë¡œ enp3s0 ì¸í„°í˜ì´ìŠ¤ì— ë“¤ì–´ì˜¤ëŠ” íŠ¸ë˜í”½ì„ 10.120.52.23:30060ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜í•œë‹¤. 10.120.52.23:30060ì— ì ‘ì†í•˜ëŠ” íŠ¸ë˜í”½ì„ í—ˆìš©í•œë‹¤. ì„œë²„ì˜ IPë¡œ ì ‘ì†í•˜ë©´ ê·¸ë¼íŒŒë‚˜ ëŒ€ì‹œë³´ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.\në¬¸ì œì  Multipassë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ê³ , ì™¸ë¶€ì™€ì˜ ì ‘ì†ì„ ìœ„í•´ íŠ¸ë˜í”½ì„ ì œì–´í•˜ëŠ” ê²ƒì€ ë¬¸ì œì ì´ ìˆë‹¤.\nì™¸ë¶€ì™€ì˜ ì ‘ì†ì„ í• ë•Œë§ˆë‹¤ iptableë¥¼ ì„¤ì •í•´ì•¼ í•œë‹¤.\nì„œë²„ê°€ shutdownì´ ë  ê²½ìš° ì´ì „ì— ì„¤ì •í–ˆë˜ iptables ruleì´ ì‚¬ë¼ì§„ë‹¤. ì´ëŸ´ ê²½ìš° ê·œì¹™ì„ ë‹¤ì‹œ ì„¤ì •í•˜ê±°ë‚˜, ì´ë¥¼ ëŒ€ë¹„í•´ì„œ ë³„ë„ì˜ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì„œ iptablesì´ ì˜ì†ì„±ì´ ìˆë„ë¡ ì„¤ì •2í•´ì•¼ í•œë‹¤. ì¸ìŠ¤í„´ìŠ¤ê°€ ë§ìœ¼ë©´ ë§ì„ìˆ˜ë¡ ê´€ë¦¬í•˜ê¸° ì–´ë µë‹¤.\nì¿ ë²„ë„¤í‹°ìŠ¤ ì´ì™¸ì—ë„ ë‹¤ì–‘í•œ ì¸ìŠ¤í„´ìŠ¤ê°€ ìˆì§€ë§Œ ì¼ë¦¬ë¦¬ ëª…ë ¹ì–´ë¡œ ìƒíƒœë¥¼ í™•ì¸í•˜ê³ , ì„¤ì •í•˜ëŠ” ê²ƒì€ ë²ˆê±°ë¡­ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë„êµ¬ê°€ í•„ìš”í–ˆë‹¤. ìœ„ì˜ í•´ê²°ì±…ìœ¼ë¡œ OpenStack ì„œë²„ë¥¼ êµ¬ì¶•í•˜ê³ ì í•œë‹¤. ì¸ìŠ¤í„´ìŠ¤ë¥¼ public cloud ì²˜ëŸ¼ ììœ ìì¬ë¡œ ìƒì„± ë° ì‚­ì œí•  ìˆ˜ ìˆìœ¼ë©°, ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì´ ìš©ì´í–ˆë‹¤. ë˜í•œ í´ë¼ìš°ë“œì— ì‚¬ìš©ë˜ëŠ” ê¸°ìˆ ì„ ëŒ€ë¶€ë¶„ í™œìš©í•  ìˆ˜ ìˆì–´ í´ë¼ìš°ë“œë¥¼ ì•Œì•„ê°€ëŠ”ë° ì¢‹ì€ ë„êµ¬ë¼ê³  ìƒê°í–ˆë‹¤.\në‹¤ìŒ í¬ìŠ¤íŒ…ì€ ê¸°ì¡´ì˜ ì„œë²„ë¥¼ í¬ë§·ì‹œí‚¤ê³ , openstack ì„œë²„ êµ¬ì¶•ê¸°ë¡œ ì°¾ì•„ì˜¤ê² ë‹¤.\nhttps://kubernetes.io/ko/docs/tasks/configure-pod-container/assign-pods-nodes/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://unix.stackexchange.com/questions/52376/why-do-iptables-rules-disappear-when-restarting-my-debian-system\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-07-16T00:00:00Z","permalink":"https://s0okju.github.io/p/server-access-dashboard-and-management-problems/","title":"ì„œë²„ êµ¬ì¶•ê¸° - 3. ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ëŒ€ì‹œë³´ë“œ ì ‘ì†í•˜ê¸° ê·¸ë¦¬ê³  ìš´ì˜ì˜ ë¬¸ì œì "},{"content":"ë“¤ì–´ê°€ë©° ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ìœ ìƒíƒœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í• ë•Œ ì£¼ë¡œ PV, PVCë¥¼ í™œìš©í•´ì„œ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤. ìœ„ì¹˜ì— ë”°ë¼ ë‚´ë¶€, ì™¸ë¶€ ì €ì¥ ìœ ë¬´ë¥¼ ê²°ì •í•˜ëŠ”ë°, ë‚´ë¶€ì ìœ¼ë¡œ ì €ì¥í•˜ëŠ” ê²ƒì€ ì ‘ê·¼ì„±ë„ ë–¨ì–´ì§ˆ ë¿ë§Œ ì•„ë‹ˆë¼ ë…¸ë“œë¥¼ ìš´ìš©í•˜ëŠ”ë° ë¹„íš¨ìœ¨ì ì´ë¼ê³  íŒë‹¨í–ˆë‹¤. ì™¸ë¶€ì ì¸ ë°©ì•ˆì€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•œ ë°ì´í„° ì €ì¥ì´ë‹¤.\nê·¸ë ‡ë‹¤ë©´ ì˜¨í”„ë¡œë¯¸ìŠ¤ í™˜ê²½ì—ì„œ ë„¤íŠ¸ì›Œí¬ë¡œ í†µì‹ í•˜ì—¬ ì €ì¥í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆì„ê¹Œ? ì§ì ‘ ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì— êµ¬ì¶•í•˜ì—¬ ì ìš©í•˜ê³ ì í•œë‹¤.\nNFS(Network File System) ë„¤íŠ¸ì›Œí¬ì— íŒŒì¼ì„ ì €ì¥í•˜ëŠ” ë°©ì‹ì´ë‹¤. ì¦‰, ì›ê²© ì»´í“¨í„°ì— ìˆëŠ” íŒŒì¼ ë° ë””ë ‰í† ë¦¬ì— ì—‘ì„¸ìŠ¤í•˜ê³ , í•´ë‹¹ íŒŒì¼ ë””ë ‰í† ë¦¬ê°€ ë¡œì»¬ì— ìˆëŠ” ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ë¶„ì‚° íŒŒì¼ ì‹œìŠ¤í…œì´ë‹¤.\níŒŒì¼ ì‹œìŠ¤í…œ ì¤‘ì— ZFSê°€ ìˆë‹¤. ì¤‘ê°„ì— ë‘ ê°œì˜ ê°œë…ì´ í˜¼ìš©ë¼ì„œ NFSì— ZFS íŒŒì¼ ì‹œìŠ¤í…œì„ ì„¤ì¹˜í–ˆë‹¤. ê·¸ë¦¬ê³  ë‹¤ì‹œ í¬ë§·íŒ…í–ˆë‹¤.. ìì„¸íˆ ì•Œê³  ì‹¶ìœ¼ë©´ í† ìŠ¤ ë¸”ë¡œê·¸, OpenZFSë¡œ ì„±ëŠ¥ê³¼ ë¹„ìš©, ë‘ ë§ˆë¦¬ í† ë¼ ì¡ê¸° ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.\nìš©ëŸ‰ ë¶€ì¡± ë¬¸ì œ ìœ ìƒíƒœ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë¬´ì—‡ì´ ìˆì„ê¹Œ? ëŒ€ë¶€ë¶„ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê¼½ì„ ê²ƒì´ë‹¤. ë°ì´í„°ë² ì´ìŠ¤ëŠ” ìƒê°ë³´ë‹¤ í° ìš©ëŸ‰ì„ ì°¨ì§€í•œë‹¤. ìì²´ ì„œë²„ëŠ” SSD 1TBìš©ëŸ‰ì„ ê°€ì§€ê³  ìˆë‹¤. ê·¸ëŸ¬ë‚˜ 4ê°œì˜ ë…¸ë“œ ì¸ìŠ¤í„´ìŠ¤ì™€ ì‹œìŠ¤í…œ ë°ì´í„°, ë¯¸ë˜ì— ì¶”ê°€í•  ì¸ìŠ¤í„´ìŠ¤ê¹Œì§€ ë”í•˜ë©´ ë§ì€ ìš©ëŸ‰ì´ ìš”êµ¬ëœë‹¤. ê°œì¸ì ìœ¼ë¡œ SSDë¼ëŠ” ë¹„ì‹¼ ì €ì¥ì†Œë¥¼ ë‹¨ìˆœ ë°ì´í„° ë³´ê´€ìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°ì—ëŠ” ë§ì´ ì•„ê¹ë‹¤ê³  ìƒê°í–ˆë‹¤.\në‹¤í–‰íˆ DASì™€ 4TB HDDê°€ ìˆì—ˆë‹¤. SSDì—ëŠ” ì‹œìŠ¤í…œì— í™œìš©ë  ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³ , ê·¸ ì™¸ì˜ ë°ì´í„°ëŠ” DASì— ì €ì¥í•˜ë„ë¡ êµ¬ì„±í•˜ë ¤ê³  í•œë‹¤.\nêµ¬ì„± ê°€ìƒ í™˜ê²½ì„ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ NFS ê´€ë ¨ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ê³ , ê°ê°ì˜ ë…¸ë“œê°€ ë„¤íŠ¸ì›Œí‚¹ì„ í†µí•´ ì ‘ì†í•  ìˆ˜ ìˆê²Œ êµ¬ì„±í•  ì˜ˆì •ì´ë‹¤.\nêµ¬ì„±ë„ êµ¬ì„±ì„ ê°„ëµí•˜ê²Œ ì„¤ëª…í•˜ìë©´ ì•„ë˜ì™€ ê°™ë‹¤.\nNFS ì„œë²„ ì „ìš© ê°€ìƒ ë¨¸ì‹ ì„ ë§Œë“ ë‹¤. Host ì„œë²„ì— DASë¥¼ ë§ˆìš´íŒ…í•˜ê³ , NFS Server ì¸ìŠ¤í„´ìŠ¤ì— hostì— ë§ˆìš´íŒ…ëœ ê²½ë¡œë¥¼ ë‹¤ì‹œ ë§ˆìš´íŠ¸í•œë‹¤. í™˜ê²½ ì„¤ì •í•˜ê¸° Disk Format DASì— ìˆëŠ” HDDëŠ” 4TBë¡œ 1TB, 1TB, 1.8TBë¡œ íŒŒí‹°ì…”ë‹í–ˆë‹¤.\në””ìŠ¤í¬ í¬ë§· ë° íŒŒí‹°ì…”ë‹ì€ ë¬´ì¤‘ë ¥ ì¸ê°„ë‹˜ì˜ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í•˜ì.\në¶€íŒ…ë ë•Œë§ˆë‹¤ ìë™ ë§ˆìš´íŒ…ì´ ë  ìˆ˜ ìˆë„ë¡ fstab íŒŒì¼ì„ ìˆ˜ì •í–ˆë‹¤.\në¬¸ì œ1. UUIDê°€ ì—†ëŠ” ê²½ìš° ext4ë¡œ í¬ë§·ì´ ì•ˆëœê²½ìš° PARTITION UUIDë§Œ ìˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ mkfs.ext4 ë¥¼ í™œìš©í•˜ì—¬ ext4ë¥¼ í¬ë§·ì‹œí‚¤ì.\në¬¸ì œ 2. Emergency Mode fsatabë¥¼ ì˜ëª» ì„¤ì •í•˜ë©´ LinuxëŠ” ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ì œê³µí•˜ëŠ” emergency modeë¡œ ë„ì…í•˜ê²Œ ëœë‹¤. fstab íŒŒì¼ì„ ì ì ˆí•˜ê²Œ ê¸°ì…í•˜ì.\nNFS ì„¤ì¹˜í•˜ê¸° NFS Multipass mounting 1 multipass mount /mnt/das/vol1 nfs:/nfs/vol1 NFS Server ì„¤ì¹˜ NFS multipass Instance ë‚´ì— NFS ì„œë²„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•˜ì. ì„¤ì •ì€ Jung-taek Limë‹˜ì˜ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í–ˆë‹¤.\n1 2 3 sudo apt-get install nfs-common nfs-kernel-server rpcbind portmap systemctl enable nfs-kernel-server systemctl start nfs-kernel-server ë„¤íŠ¸ì›Œí¬ ë²”ìœ„ë¥¼ 10.120.52.0/24ë¡œ ì§€ì •í–ˆëŠ”ë°, ì´ëŠ” multipass instanceê°€ 10.120.52.0/24 ë²”ìœ„ ë‚´ì— ìˆê¸° ë•Œë¬¸ì´ë‹¤.\nmulitpassì—ì„œ ì‚¬ìš©ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë¸Œë¥¼ ë³´ë©´ qemuë¥¼ ì‚¬ìš©í•œë‹¤.\në„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë³´ë©´ ì‚¬ìš©ê°€ëŠ¥í•œ IP ë²”ìœ„ëŠ” 10.120.52.0/24 ì„ì„ ì•Œ ìˆ˜ ìˆë‹¤.\n1 2 3 4 5 6 7 sudo mkdir -p /nfs/vol1 sudo chown nobody:nogroup /nfs/vol1 # nfsê°€ ê³µìœ í•  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ ì„¤ì • sudo vim /etc/exports/nfs/vol1 10.120.52.0/24(rw,sync,no_subtree_check,no_root_squash) # ìœ„ì˜ ì„¤ì • ë°˜ì˜ sudo exportfs -r ë§ˆìŠ¤í„° ë…¸ë“œì— showmountí•˜ì—¬ NFSê°€ ì œëŒ€ë¡œ ì‘ë™ë˜ì—ˆëŠ”ì§€ í™•ì¸í–ˆì„ë•Œ ì•„ë˜ì™€ ê°™ì´ export listê°€ ì˜ ë³´ì—¬ì§€ë©´ ëœë‹¤.\nDynamic Provisioner ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì„ ìƒê°í•´ë³´ì. ì „ì—­ì ì¸ ë°ì´í„° ìŠ¤í† ë¦¬ì§€ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” [[D K8S- Pod|Pod]]ë¥¼ ìƒì„±í• ë•Œ PVCë¥¼ ìƒì„±í•˜ì—¬, ê´€ë¦¬ìê°€ ìƒì„±í•œ PVì™€ ì—°ê²°í•˜ê²Œ ëœë‹¤. ê·¸ëŸ¬ë‚˜ íŒŒë“œë¥¼ ìƒì„±í• ë•Œë§ˆë‹¤ PV, PVCë¥¼ ë§Œë“¤ì–´ì„œ ìŠ¤í† ë¦¬ì§€ì— ì ‘ê·¼í•´ì•¼ í•œë‹¤. ì´ì™€ ê°™ì´ ë²ˆê±°ë¡œì›€ì„ í•´ê²°í•˜ê³ ì ìë™ìœ¼ë¡œ ë³¼ë¥¨ì„ ìƒì„±í•´ì£¼ëŠ” Dynamic Provisionerë¥¼ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.\nProvisionerëŠ” kubernetes-sigs Githubì— ìˆëŠ” nfs-subdir-external-provisionerë¥¼ ì‚¬ìš©í–ˆë‹¤.\nìœ„ì˜ íŒŒì¼ì„ ì ì ˆí•˜ê²Œ ì„¤ì •í•˜ê²Œ testë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´, ì•„ë˜ì™€ ê°™ì´ pvcê°€ ë§Œë“¤ì–´ì§€ê²Œ ëœë‹¤. ë˜í•œ íŒŒë“œë¥¼ ì‚­ì œí•˜ê²Œ ë˜ë©´ ìë™ìœ¼ë¡œ pvcê°€ ì‚­ì œë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.\nì°¸ê³  https://gruuuuu.github.io/cloud/k8s-volume/ https://do-hansung.tistory.com/57 https://1week.tistory.com/114 ","date":"2024-07-14T00:00:00Z","permalink":"https://s0okju.github.io/p/server-setup-nfs-in-multipass-instance/","title":"ì„œë²„ êµ¬ì¶•ê¸° - 2. Multipassë¥¼ í™œìš©í•œ NFS êµ¬ì„±"},{"content":"ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ë¥¼ ì§ì ‘ ìš´ì˜í•˜ê¸° ìœ„í•´ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ê¸°ë¡œ ê²°ì‹¬í–ˆë‹¤. ê·¸ë˜ì„œ ê¸°ì¡´ì— ìˆëŠ” Windows ë°ìŠ¤í¬í†±ì„ ubuntu 20.04 ì„œë²„ í™˜ê²½ìœ¼ë¡œ ì„¸íŒ…í–ˆë‹¤.\nRTL8125 ì˜¤ë¥˜ ì—¬ê¸°ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤. LAN ì¹´ë“œ ì •ë³´ í™•ì¸ ê²°ê³¼, ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ê°€ ì œëŒ€ë¡œ ì¸ì‹ë˜ì§€ ì•Šì•˜ë˜ ê²ƒì´ì—ˆë‹¤. ëœì¹´ë“œê°€ RTL8125ì˜ ê²½ìš°ì—ëŠ” ë³„ë„ì˜ ë“œë¼ì´ë²„ ì„¤ì¹˜ê°€ í•„ìš”í–ˆë‹¤. í•˜ë‚˜ì˜ ëª¨ìˆœì´ ìƒê²¼ë‹¤. ìš°ë¦¬ê°€ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í• ë•ŒëŠ” ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ í•„ìˆ˜ì§€ë§Œ, ë„¤íŠ¸ì›Œí¬ì— ë¬¸ì œê°€ ìƒê²¨ ì™¸ë¶€ íŒ¨í‚¤ì§€ë¥¼ ë‹¤ìš´ë°›ì„ ìˆ˜ ì—†ë˜ ê²ƒì´ì—ˆë‹¤. ë¬¼ë¡  í•´ê²°ì±…ì´ ì—†ë˜ ê²ƒì´ ì•„ë‹ˆì˜€ë‹¤.\nì•ˆë“œë¡œì´ë“œ í°ì„ ì´ìš©í•´ tetheringí•´ì„œ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ ì‹œí‚¤ê³  í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜1 20.04 ì€ ì»¤ë„ ë²„ì „ì„ 5.4ë¥¼ ì“°ëŠ”ë° ì´ ë²„ì „ì—ì„œ LANì´ ì¸ì‹ì´ ì•ˆë¼ 5.8 ì´ìƒ ë²„ì „ì„ ì„¤ì¹˜ 2 ìŠ¬í”„ê²Œë„ ë‚˜ëŠ” ë‘ ë°©ë²•ì— ì‹¤íŒ¨í•˜ê²Œ ë˜ì—ˆê³  22.04LTSë¥¼ ì„¤ì¹˜í•˜ê²Œ ë˜ì—ˆë‹¤. ê·¸ë¦¬ê³  ê¹”ë”í•˜ê²Œ ì„±ê³µí–ˆë‹¤.\nêµ¬ì¶• ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ êµ¬ì¶• ìì²´ëŠ” ìƒê°ë³´ë‹¤ ê°„ë‹¨í•˜ì§€ë§Œ ìƒì—… í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê³  ê°€ìš©ì„± ìˆê²Œ ì§€ì†ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì€ ì–´ë µë‹¤. ê·¸ë˜ì„œ ìì²´ í˜¸ìŠ¤íŒ…í•˜ëŠ” ê²ƒì€ ê¶Œì¥í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•œë‹¤. 3\nê·¸ëŸ¬ë‚˜ êµìœ¡ì˜ ê´€ì ì—ì„œëŠ” ìì²´ í˜¸ìŠ¤íŒ…í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì¢‹ì€ ì„ íƒì´ë¼ê³  ìƒê°í•œë‹¤. í¼ë¸”ë¦­ í´ë¼ìš°ë“œë¥¼ ì‚¬ìš©í•˜ë‹¤ê°€ ìš”ê¸ˆì„ í­íƒ„ë§ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.\nMultipass ì„ íƒí•œ ì´ìœ  ë¦¬ëˆ…ìŠ¤ ê¸°ë°˜ ê°€ìƒ ë¨¸ì‹ ì€ ì„ íƒì§€ê°€ ìƒê°ë³´ë‹¤ ë‹¤ì–‘í•˜ê²Œ ìˆë‹¤. ë‚˜ëŠ” vagrant, multipass ì¤‘ì—ì„œ ê³ ë¯¼í–ˆë‹¤. Multipassë¥¼ ì„ íƒí•œ ì´ìœ ëŠ” ì‚¬ìš©í•˜ê¸° ì‰¬ì›Œì„œì´ë‹¤.\nvagrantì˜ ì¥ì ì€ ë‹¤ì–‘í•œ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ê³¼ Vagrantfileë¥¼ í†µí•´ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ì ì´ì—ˆë‹¤. í•˜ì§€ë§Œ ë‹¨ì ì´ ì¡´ì¬í–ˆëŠ”ë°, ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§œëŠ” ë²•ì„ ì•Œì•„ì•¼í•œë‹¤ëŠ” ì ê³¼ ë‚´ê°€ ì¿ ë²„ë„¤í‹°ìŠ¤ êµ¬ì¶•í•˜ëŠ” ì „ë°˜ì ì¸ ë°©ì‹ì„ ì´í•´í•˜ì§€ ëª»í•´ ë””ë²„ê¹… í•˜ì§€ ëª»í•œë‹¤ëŠ” ê²ƒì´ì—ˆë‹¤. ì‹¤ì œë¡œ ê¹ƒí—ˆë¸Œì˜ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ cloneí•´ì„œ êµ¬ì„±í•´ë´¤ëŠ”ë°, ë„¤íŠ¸ì›Œí¬ í• ë‹¹ì´ ì œëŒ€ë¡œ ë˜ì§€ ì•Šì•„ ë§ì€ ì‹œê°„ì„ ì“°ê¸°ë„ í–ˆë‹¤.\nmultipassëŠ” Canonicalì—ì„œ ë§Œë“¤ì—ˆìœ¼ë©° Ubuntuì˜ ê°€ìƒí™”í™˜ê²½(VM)ì„ ì‰½ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ë„êµ¬4ì´ë‹¤. ì¦‰ ìš°ë¶„íˆ¬ ë³´ê¸‰ì‚¬ê°€ ë§Œë“  ê°€ìƒí™˜ê²½ì´ë¼ê³  ë³´ë©´ ëœë‹¤. ìš°ë¶„íˆ¬ ì™¸ì˜ ë¦¬ëˆ…ìŠ¤ë¥¼ ì¨ì•¼í•œë‹¤ë©´ multipassëŠ” ì¢‹ì€ ì„ íƒì§€ëŠ” ì•„ë‹ˆì§€ë§Œ centOS Linuxê°€ ë”ì´ìƒ ì§€ì›ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì 5ì—ì„œ ì“¸ ìˆ˜ ìˆëŠ” ê±´ ìš°ë¶„íˆ¬ ë°–ì— ì—†ëŠ” ê²ƒ ê°™ë‹¤.\nì¿ ë² ë„¤í‹°ìŠ¤ êµ¬ì„± ìì„¸í•œ ì„¤ì¹˜ëŠ” enumclass tistoryë¥¼ ì°¸ê³ í–ˆë‹¤.\nCalico ì„ íƒí•œ ì´ìœ  CNI í”ŒëŸ¬ê·¸ì¸ì—ì„œ ê°€ì¥ ëŒ€ì¤‘ì ìœ¼ë¡œ ì“°ì´ëŠ” ê²ƒì€ Calicoì´ë‹¤. CNI í”ŒëŸ¬ê·¸ì¸ ë²¤ì¹˜ë§ˆí¬ë¥¼ ë³´ë©´ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥ ì´ë‚˜, ì†ë„ ì¸¡ë©´ì—ì„œ Calicoê°€ ìš°ìˆ˜í•œ í¸ì´ë‹¤.\nCNIì˜ íŠ¹ì§•ì€ Podì— IPë¥¼ í• ë‹¹í•œë‹¤. ì´ëŸ¬í•œ íŠ¹ì§•ì´ ëŒ€ê·œëª¨ í™˜ê²½ì—ì„œëŠ” IP ë¶€ì¡±ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆë‹¤. 6 ê·¸ëŸ¬ë‚˜ ì†Œê·œëª¨ í”„ë¡œì íŠ¸ëŠ” ë§ì€ podë¥¼ ìƒì„±í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ IPëŠ” ë¶€ì¡±í•˜ì§€ ì•Šì„ ê²ƒì´ë‹¤.\nê²°ê³¼ 10.120.52.x IPëŠ” multipass instanceì˜ IPì´ê³ , 192.168.x.xëŠ” calicoì˜ IPì´ë‹¤.\nì‹¤ì œë¡œ íŒŒë“œë¥¼ ìƒì„±í•´ ì‹¤í–‰ì‹œì¼œ ë³´ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.\nhttps://physical-world.tistory.com/56\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://romillion.tistory.com/96\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ í™œìš©í•œ í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ë°ë¸Œì˜µìŠ¤, ì¡´ ì–´ë Œë“¤, ì €ìŠ¤í‹´ ë„ë°ê±°ìŠ¤ ì§€ìŒ, í•œë¹› ë¯¸ë””ì–´\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://kim-dragon.tistory.com/176\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://arstechnica.com/gadgets/2020/12/centos-shifts-from-red-hat-unbranded-to-red-hat-beta/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://dobby-isfree.tistory.com/201\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-07-12T00:00:00Z","permalink":"https://s0okju.github.io/p/server-setup-multinode-kubernetes/","title":"ì„œë²„ êµ¬ì¶•ê¸° - 1. ì¿ ë²„ë„¤í‹°ìŠ¤ ë©€í‹° ë…¸ë“œ í™˜ê²½ êµ¬ì„±í•˜ê¸°"},{"content":"Multipassë¥¼ êµ¬ë™í•˜ë ¤ê³  í•˜ëŠ” ì¤‘ ë””ìŠ¤í¬ ìš©ëŸ‰ì´ ê½‰ì°¼ë‹¤ëŠ” ë©”ì„¸ì§€ë¥¼ ì–»ê²Œ ë˜ì—ˆë‹¤.\n1 cannot create temporary directory for the root file system: No space left on device ì„œë²„ì—ì„œ ì‚¬ìš©ì¤‘ì¸ SSDëŠ” 1TBì¸ë° 5ê°œì˜ Multipass ì¸ìŠ¤í„´ìŠ¤ë¡œ ë‹¤ ì°¬ë‹¤ëŠ” ê²ƒì€ ë§ì´ ë˜ì§€ ì•Šì•˜ë‹¤.\nì‹¤ì œ í•˜ë“œì›¨ì–´ ìƒì—ì„œ ë¶€ì°©ëœ ìš©ëŸ‰ê³¼ ubuntu lvmì—ì„œ ì‚¬ìš©ë˜ëŠ” ìµœëŒ€ ìš©ëŸ‰ì´ ë‹¬ëë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì´ ìš©ëŸ‰ì„ ì ì ˆí•˜ê²Œ ì¡°ì ˆí•´ì•¼ í•œë‹¤.\ní•´ê²° LVì˜ ìš©ëŸ‰ì„ VGì˜ í¬ê¸°ë§Œí¼ ì¡°ì ˆí•œë‹¤. Stack Exchangeì—ì„œ ìš”êµ¬í•œëŒ€ë¡œ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ê²°ëœë‹¤.\n1 2 3 4 5 lvm lvm\u0026gt; lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv lvm\u0026gt; exit resize2fs /dev/ubuntu-vg/ubuntu-lv ìì„¸í•˜ê²Œ ë´ë³´ì. ubuntu-vgëŠ” SSDì˜ ìš©ëŸ‰ë§Œí¼ ì ì ˆí•˜ê²Œ í• ë‹¹ ë°›ì•˜ë‹¤. ê·¸ëŸ¬ë‚˜ Alloc PEë¥¼ ë³´ë©´ 100 GB ë°–ì— ë‚¨ì§€ ì•Šì•˜ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.\nlvdisplayë¡œ lvë¥¼ í™•ì¸í•´ë³´ë©´ ubuntu-lvê°€ 100GBë¡œ í• ë‹¹ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.\nì—¬ê¸°ì„œ LVM(Logical Volume Manager)ì˜ ê°œë…ì„ ì•Œì•„ì•¼ í•˜ëŠ”ë°, íŒŒì¼ ì‹œìŠ¤í…œì— ì¶”ìƒí™” ê³„ì¸µì„ ì¶”ê°€í•˜ì—¬ ë…¼ë¦¬ì  ìŠ¤í† ë¦¬ì§€ë¥¼ ìƒì„±í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.1\nì €ìì˜ í™˜ê²½ì—ì„œëŠ” Root LVê°€ 100GBë¡œë§Œ í• ë‹¹ë˜ì–´ ìˆì–´, í•˜ë“œ ë””ìŠ¤í¬ì˜ ìš©ëŸ‰ ë§Œí¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆë˜ ê²ƒì´ì—ˆë‹¤.\ní˜„ì¬ í™˜ê²½ì—ì„œëŠ” í•˜ë‚˜ì˜ ë¬¼ë¦¬ ë””ìŠ¤í¬ë§Œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì„¤ì •í•˜ëŠ”ë° ë³µì¡í•œ ê²ƒì€ ì—†ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì¶”ê°€ì ìœ¼ë¡œ ubuntu-vgì— lvë¥¼ ì¶”ê°€í•˜ì§€ ì•ŠëŠ” í•œ Root lvë¥¼ vg í¬ê¸°ë§Œí¼ ì‚¬ì´ì¦ˆë¥¼ í‚¤ìš°ë©´ ëœë‹¤.\nhttps://tech.cloud.nongshim.co.kr/2018/11/23/lvmlogical-volume-manager-1-%EA%B0%9C%EB%85%90/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-05-28T00:00:00Z","permalink":"https://s0okju.github.io/p/server-management-disk-1/","title":"ê·¸ ë§ì€ ì„œë²„ ë””ìŠ¤í¬ ìš©ëŸ‰ì„ ëˆ„ê°€ ì¡ì•„ ë¨¹ì—ˆëŠ”ê°€?"},{"content":"ORM ì„ íƒ Goì˜ ê²½ìš°ì—ëŠ” JAVAì™€ ë‹¬ë¦¬ ëŒ€í‘œì ì¸ ORM í”„ë ˆì„ì›Œí¬ê°€ ì—†ì–´, ê°œë°œìê°€ ì§ì ‘ ì„ íƒí•´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.\në‹¤ì–‘í•œ Go ORM í”„ë ˆì„ì›Œí¬ ìˆœìœ„ë¥¼ ì•Œê³  ì‹¶ë‹¤ë©´ OSS Insight ë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.\nê¸°ë³¸ì ìœ¼ë¡œ mysql driver ì‚¬ìš©ì„ ìƒê°í–ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì •êµí•œ ì €ìˆ˜ì¤€ì˜ ì¿¼ë¦¬ë¥¼ ë‹¤ë£¨ëŠ” ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ORMë¥¼ ì ê·¹ì ìœ¼ë¡œ í™œìš©í•˜ê³  ì‹¶ì—ˆë‹¤.\nì¡°ê±´ ê¹”ë”í•œ ë„ë©”ì¸ ì •ì˜ ì—¬ëŸ¬ ì¢…ë¥˜ì˜ DB ì§€ì› ì»´íŒŒì¼ ë ˆë²¨ì—ì„œ ë””ë²„ê¹… ê°€ëŠ¥ Ent Entë€ Facebookì—ì„œ ê°œë°œí•œ Go ORMì´ë‹¤. ê³µì‹ ì„¤ëª…ì— ì˜í•˜ë©´ ê·¸ë˜í”„ êµ¬ì¡°ì˜ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, ì½”ë“œ ìƒì„±ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” ì •ì  íƒ€ì´í•‘ì„ ì§€ì›í•œë‹¤.1 ì´ëŠ” ìœ„ì—ì„œ ë§í•œ ì¡°ê±´ì— ì–´ëŠ ì •ë„ ì¶©ì¡±ì´ ëœë‹¤.\në‹¤ë§Œ entëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì— ì í•©í•˜ë©° NoSQL ê¸°ë°˜ ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” ì í•©í•˜ì§€ ì•Šì•˜ë‹¤.2 ORM ì„ íƒ ì¡°ê±´ì—ëŠ” ë¶€í•©í•˜ì§€ ì•Šì•˜ìœ¼ë‚˜ ëŒ€ë¶€ë¶„ì˜ ORMì´ RDB ìœ„ì£¼ë¡œ ì§€ì›í•œë‹¤ëŠ” ê²ƒ3ì„ ê°ì•ˆí–ˆì„ë•Œ entì€ RDB ì‚¬ìš© ì‹œ ê´œì°®ì€ ì„ íƒì´ë¼ê³  ìƒê°í•œë‹¤.\nì´ˆë°˜ì— Gorm ì‚¬ìš©ë„ ê³ ë ¤í–ˆë‹¤. ê·¸ëŸ¬ë‚˜ ëª¨ë¸ì„ ì •ì˜í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” struct tag ëŠ” ê°œì¸ì ìœ¼ë¡œ ê°€ë…ì„±ì´ ì¢‹ì§€ ì•Šë‹¤ëŠ” ì¸ìƒì´ ë“¤ì—ˆë‹¤.\n1 2 3 4 5 6 type Model struct { ID uint `gorm:\u0026#34;primaryKey\u0026#34;` CreatedAt time.Time UpdatedAt time.Time DeletedAt gorm.DeletedAt `gorm:\u0026#34;index\u0026#34;` } ì²«ì¸ìƒ ORM ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ schemaë¥¼ ë³¸ ìˆœê°„ ê·¸ë˜í”„ ë°ì´í„°ë² ì´ìŠ¤ì¸ ì¤„ ì•Œì•˜ë‹¤. ê³¼ê±°ì— Neo4j4ë¼ëŠ” ê·¸ë˜í”„ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ë³¸ ì ì´ ìˆëŠ”ë°, ì´ ë…¸ë“œ, ê·¸ë˜í”„ë¥¼ ë³„ë„ë¡œ ì •ì˜í•´ì„œ êµ¬í˜„í•œ ì ì´ ìƒë‹¹íˆ ìœ ì‚¬í–ˆê¸° ë•Œë¬¸ì´ë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 type Task struct { ent.Schema } // Fields of the Task. func (Task) Fields() []ent.Field { return []ent.Field{ field.Int(\u0026#34;id\u0026#34;), field.String(\u0026#34;title\u0026#34;), field.Int(\u0026#34;total_status\u0026#34;), field.Time(\u0026#34;created_at\u0026#34;).Default(time.Now()), field.Time(\u0026#34;modified_at\u0026#34;).Default(time.Now()), } } // Edges of the Task. func (Task) Edges() []ent.Edge { return []ent.Edge{ edge.To(\u0026#34;subtask\u0026#34;, SubTask.Type), } } ê³µì‹ í™ˆí˜ì´ì§€ë¥¼ ì°¸ê³ í•´ë³´ë©´ Ent ORMì— ëŒ€í•´ ì´ë ‡ê²Œ ì„¤ëª…í–ˆë‹¤.\nEasily model database schema as a graph structure.\nschema êµ¬ì¡°ë¥¼ ê·¸ë˜í”„ êµ¬ì¡°ë¡œ êµ¬í˜„ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. ì•„ë§ˆ entê°€ ê·¸ë˜í”„ íƒìƒ‰ì— ëŒ€í•œ ìì‹ ê°ì„ í‘œí˜„í•œ ê²ƒë„ êµ¬ì¡°ì ì¸ ì´ìœ ë•Œë¬¸ì´ì§€ ì•Šì„ê¹Œ ì‹¶ë‹¤.\nì ìš©í•˜ê¸° Schema entì˜ ì°¸ì¡° ë°©ì‹ì€ ë…íŠ¹í•˜ë‹¤. ê¸°ì¡´ì˜ ì°¸ì¡° ë°©ì‹ê³¼ ë°˜ëŒ€ì´ê¸° ë•Œë¬¸ì´ë‹¤.5 ent ê³µì‹ ë¬¸ì„œì— ì˜í•˜ë©´ edge.Toë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©´ ì„¤ì •í•œ Edgeë¥¼ ì†Œìœ í•œë‹¤ê³  ì •ì˜í•œë‹¤.6\nA schema that defines an edge using theÂ edge.ToÂ builder owns the relation, unlike using theÂ edge.FromÂ builder that gives only a back-reference for the relation (with a different name).\nğŸ¤” í•„ìì˜ ê²½ìš° ìœ„ì˜ ì •ì˜ë¥¼ ê³ ë ¤í•˜ê³  êµ¬í˜„í•˜ë‹ˆ ë” í—·ê°ˆë¦¬ê¸° ì‹œì‘í–ˆë‹¤. ê·¸ë˜ì„œ ê´€ê³„ ì†Œìœ ìì¸ schemaë§Œ ì •ì˜í•˜ê³ , ê·¸ ì™¸ì—ëŠ” ì„œë¡œì˜ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ì •í•´ì¤€ë‹¤ëŠ” ë§ˆìŒìœ¼ë¡œ êµ¬í˜„í–ˆë‹¤.\nMember : Task Entityê°€ 1:N ì—°ê´€ ê´€ê³„ë¥¼ ê°€ì§„ë‹¤ê³  ê°€ì •í•´ë³´ì.\nMemberëŠ” tasksë¼ëŠ” ê´€ê³„ì˜ ì†Œìœ ìì´ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ edge.Toë¡œ ê´€ê³„ë¥¼ ì„¤ì •í•œë‹¤. í•˜ì§€ë§Œ TaskëŠ” manyì— í•´ë‹¹ë˜ê¸° ë•Œë¬¸ì— ì•„ë¬´ê²ƒë„ ì„¤ì •í•˜ì§€ ì•ŠëŠ”ë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // Fields of the Member. func (Member) Fields() []ent.Field { return []ent.Field{ field.Int(\u0026#34;id\u0026#34;), field.String(\u0026#34;email\u0026#34;), field.String(\u0026#34;username\u0026#34;), field.String(\u0026#34;password\u0026#34;), field.Time(\u0026#34;created_at\u0026#34;).Default(time.Now()), } } // Edges of the Member. func (Member) Edges() []ent.Edge { return []ent.Edge{ edge.To(\u0026#34;tasks\u0026#34;, Task.Type), } } Taskì—ì„œëŠ” Memberì—ì„œ ì†Œìœ í•œ ê´€ê³„(user)ë¥¼ ì—­ì°¸ì¡°í•´ì„œ ê´€ê³„ë¥¼ ì •ì˜í•˜ê²Œ ëœë‹¤. ì´ë•Œ MemberëŠ” ê´€ê³„ì—ì„œ Oneì— í•´ë‹¹ë˜ë‹ˆ Unique() í•¨ìˆ˜ë¥¼ ë¶™ì´ê²Œ ëœë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // Fields of the Task. func (Task) Fields() []ent.Field { return []ent.Field{ field.Int(\u0026#34;id\u0026#34;), field.String(\u0026#34;title\u0026#34;), field.Int(\u0026#34;total_status\u0026#34;), field.Time(\u0026#34;created_at\u0026#34;).Default(time.Now()), field.Time(\u0026#34;modified_at\u0026#34;).Default(time.Now()), } } // Edges of the Task. func (Task) Edges() []ent.Edge { return []ent.Edge{ edge.From(\u0026#34;member\u0026#34;, Member.Type).Ref(\u0026#34;tasks\u0026#34;).Unique(), } } ì°¸ì¡°í•˜ëŠ” ì´ìœ ëŠ” ì–´ë–¤ schemaì™€ ì°¸ì¡°í•˜ëŠ”ì§€ë¥¼ ëª…ì‹œí•˜ê¸° ìœ„í•´ì„œë¼ê³  ë³´ë©´ ëœë‹¤.\n\u0026hellip; because there can be multiple references from one schema to other.\nì˜ˆì œ - ë°ì´í„° ìƒì„± ì½”ë“œ ê·¸ëŸ¼ ë°ì´í„°ë¥¼ ìƒì„±í• ë•Œ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ? ì°¸ì¡°í•˜ëŠ” Schema(Task)ì—ì„œ Member ì •ë³´ë¥¼ ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤.\nê³µì‹ ë¬¸ì„œì—ì„œëŠ” ì§ì ‘ Queryí•´ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ì§€ë§Œ7 , ê·¸ ì™¸ì—ë„ Schema ë°ì´í„°( ì˜ˆì œì—ì„œëŠ” ent.Member) í˜¹ì€ ì•„ì´ë””ë§Œìœ¼ë¡œë„ ì¶”ê°€ê°€ ê°€ëŠ¥í•˜ë‹ˆ ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.\n1 2 3 4 5 6 7 8 9 func (s *Store) Create(ctx *gin.Context, b request.CreateTask) error { // create Task _, err := s.client.Task.Create().SetTitle(b.Title).SetTotalStatus(0) .SetMemberID(b.UserId).Save(ctx) if err != nil { return err } return nil } ì‹¤ì œë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë³´ë©´ {ì°¸ì¡°í•˜ëŠ” ê´€ê³„ëª…} _ {ì°¸ì¡°í•˜ëŠ” ê´€ê³„ëª…}ìœ¼ë¡œ ì´ë¤„ì ¸ ìˆë‹¤.\nìœ„ì˜ ì˜ˆì œì—ì„œëŠ” 1:N(One-to-Many)ì¸ ê²½ìš°ì—ë©´ ì„¤ëª…í–ˆì§€ë§Œ (M:N)ì˜ ê²½ìš°ì—ëŠ” {ì°¸ì¡°í•˜ëŠ” ê´€ê³„ëª…} _ {ì°¸ì¡°í•˜ëŠ” ê´€ê³„ëª…}ì˜ ì´ë¦„ì„ ê°€ì§„ í…Œì´ë¸”ì´ ìƒì„±ëœë‹¤.\nhttps://entgo.io/docs/getting-started/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\ní•„ìëŠ” MongoDBì— ì ìš©ì‹œí‚¤ê³ ì ê²€ìƒ‰ì„ ì—¬ëŸ¬ë²ˆ í–ˆì§€ë§Œ ëë‚´ ì°¾ì§€ ëª»í–ˆë‹¤.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://blog.billo.io/devposts/go_orm_recommandation/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://neo4j.com/docs/getting-started/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://umi0410.github.io/blog/golang/how-to-backend-in-go-db/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://entgo.io/docs/schema-edges#quick-summary\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://entgo.io/docs/schema-edges#o2o-two-types\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-05-22T00:00:00Z","permalink":"https://s0okju.github.io/p/entgo-1/","title":"Entgo - Ent ORM"},{"content":"Goë¥¼ í™œìš©í•˜ì—¬ ì§ì ‘ 2~3ê°œì˜ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ê³  ë‚˜ë‹ˆ, êµ¬í˜„í• ë•Œ ì§€ë‚˜ì³¤ë˜ ì—ëŸ¬ë“¤ì´ í° ëˆˆë©ì´ë¡œ ë³€í•´ì„œ ë®ì³ì™”ë‹¤. ë¬¸ì œê°€ ìƒê¸´ ì§€ì ì€ ëª…í™•í–ˆì§€ë§Œ, ê·¸ê²ƒë³´ë‹¤ëŠ” ë¬¸ì œ ë°œìƒì˜ ê·¼ë³¸ì ì¸ ì›ì¸ì„ ì°¾ê³ ì í–ˆì—ˆë‹¤. ë‚´ê°€ ìƒê°í•œ ê°€ì¥ í° ì›ì¸ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ ë¶€ì¬ì˜€ë‹¤. í…ŒìŠ¤íŠ¸ì˜ ì¥ì ì€ ëˆ„êµ¬ë‚˜ ì•Œê³  ìˆì„ ê²ƒì´ë‹¤. ì½”ë“œì˜ ì•ˆì „ì„±ì„ í™•ë³´í•  ìˆ˜ ìˆìœ¼ë©° ë¬¸ì œ ë°œìƒ ì‹œ ë¹ ë¥´ê²Œ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. í˜„ì¬ ì½”ë“œì—ëŠ” ìˆ¨ê²¨ì§„ êµ¬ë©ë“¤ì´ ì¡´ì¬í•˜ëŠ”ë°, ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, í†µí•© í…ŒìŠ¤íŠ¸ê°€ í•„ìš”í–ˆë‹¤. ê¸°ì¡´ì— ìˆë˜ ì½”ë“œë¥¼ í™œìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ì‘ì„±í•˜ë ¤ê³  ì‹œë„í–ˆìœ¼ë‚˜, ì§€ê¸ˆê¹Œì§€ ì ì€ Go ì½”ë“œëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìš©ì´í•˜ë„ë¡ ì‘ì„±ë˜ì§€ ì•Šì•˜ë‹¤. íŠ¹íˆ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì ì ˆí•˜ê²Œ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì„œ Mockë¥¼ ì‚¬ìš©í•˜ëŠ”ë° ì–´ë ¤ì›€ì´ ìƒê¸°ê¸°ë„ í–ˆë‹¤. ê·¸ë˜ì„œ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì œì‘í•˜ê³ ì í•œë‹¤.\në‚˜ëŠ” ë™ì¼í•œ ì½”ë“œì— ëŒ€í•´ ì´ë²ˆê¹Œì§€ í¬í•¨í•´ì„œ 2ë²ˆ ë³€ê²½í–ˆë‹¤. ì–´ë–»ê²Œ ë³€ê²½í–ˆëŠ”ì§€ ì•Œì•„ë³´ì\nì´ˆê¸° - Go í•œë‹¬ì°¨ì˜ ì ì‘ê¸° ì—ëŸ¬ íƒ€ì…ê³¼ ìƒíƒœ íƒ€ì… 1ì°¨ì—ì„œëŠ” ErrorTypeìœ¼ë¡œ íŠ¹ì • ì—ëŸ¬ íƒ€ì…ì„ ì •ì˜í•˜ëŠ”ë° ì‚¬ìš©í•  íƒ€ì…ì„ ì§€ì •í•´ì¤¬ë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 type ErrorType int type Error struct { // Code is a custom error code ErrorType ErrorType // Err is a error string Err error // Description is a human-friendly message. Description string } type ErrorRes struct { // Code is http status code Code int `json:\u0026#34;code\u0026#34;` } ëª¨ë“  ì„œë¹„ìŠ¤ë“¤ì´ ì‚¬ìš©í•  ê²½ìš°, ê° ì„œë¹„ìŠ¤ê°€ ì‚¬ìš©í•  ì—ëŸ¬ ì½”ë“œë¥¼ ì¼ë¦¬ë¦¬ ì§€ì •í–ˆë‹¤. mapë¥¼ í™œìš©í•˜ì—¬ ì—ëŸ¬ íƒ€ì…ì— í•´ë‹¹ë˜ëŠ” ìƒíƒœ ì½”ë“œë¥¼ ë§¤í•‘í–ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 const ( // Common SUCCESS ErrorType = 0 INVALID_JSON_FORMAT ErrorType = 1001 INVALID_URI_FORMAT ErrorType = 1002 // Member INVALID_MEMBER ErrorType = 2001 ERROR_MEMBER_DB ErrorType = 2101 // Task ERROR_TASK_DB ErrorType = 3101 ) var codeMap = map[ErrorType]int{ // Common INVALID_JSON_FORMAT: http.StatusBadRequest, INVALID_URI_FORMAT: http.StatusBadRequest, // Member INVALID_MEMBER: http.StatusUnauthorized, ERROR_MEMBER_DB: http.StatusInternalServerError, // Task ERROR_TASK_DB: http.StatusInternalServerError, } ì—ëŸ¬ ë°˜í™˜ ì§ì ‘ ì»¤ìŠ¤í…€í•œ ì—ëŸ¬ê°’ì„ ì…ë ¥ê°’ìœ¼ë¡œ í•´ì„œ contextë¥¼ í™œìš©í•´ Json í˜•íƒœë¡œ ë°˜í™˜í•´ì¤¬ë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 // getCode is get Status code from codeMap. func getCode(flag ErrorType) *ErrorRes { return \u0026amp;ErrorRes{Code: codeMap[flag]} } func ErrorFunc(ctx *gin.Context, err *Error) { res := getCode(err.ErrorType) log.Println(err) ctx.AbortWithStatusJSON(res.Code, res) return } \u0026ldquo;ì €ë ‡ê²Œ í•˜ë©´ ì˜¤ë¥˜ê°€ ì œëŒ€ë¡œ ë°˜í™˜ë˜ì§€ ì•Šì„í…ë°?\u0026ldquo;ë¼ê³  ìƒê°í•˜ëŠ” ì‚¬ëŒì´ ìˆì„ ê²ƒì´ë‹¤. ì €ë•Œ ë‹¹ì‹œ ginì´ ì—ëŸ¬ë¥¼ ì‘ë‹µí•˜ëŠ” ë§¤ì»¤ë‹ˆì¦˜ì„ ì˜ ëª°ë¼ ë‹¨ìˆœí•˜ê²Œ AbortWithStatusJsonìœ¼ë¡œ ì‘ë‹µí•˜ë„ë¡ í–ˆë‹¤. ë¹„ë¡ ê²°ê³¼ëŠ” ì—ëŸ¬ json + ì„±ê³µ json ë‘˜ë‹¤ ë‚˜ì™”ì§€ë§Œ ë§ì´ë‹¤.\n1ì°¨ - Middlewareê°€ ìˆì—ˆë‹¤ê³ ìš”? ginì˜ ì˜¤ë¥˜ ì²˜ë¦¬ ë§¤ì»¤ë‹ˆì¦˜ì„ ì œëŒ€ë¡œ ì´í•´í•˜ì§€ ëª»í•´ ë‹¨ìˆœí•˜ê²Œ ì‘ë‹µì„ ì²˜ë¦¬í–ˆë‹¤. ì´ì œëŠ” Middlewareë¥¼ ì œì‘í•¨ìœ¼ë¡œì¨ ì—ëŸ¬ ì‘ë‹µ ë°˜í™˜ì´ ìˆ˜ì›”í•˜ë„ë¡ êµ¬í˜„í–ˆë‹¤.\nì—ëŸ¬ ìƒíƒœ íƒ€ì… ErrorType -\u0026gt; WebCodeë¡œ ì´ë¦„ì„ ë³€ê²½í–ˆìœ¼ë©°, ì—ëŸ¬ë¿ë§Œ ì•„ë‹ˆë¼ ìƒíƒœ ì „ì²´ë¥¼ í‘œì‹œí–ˆë‹¤. ì—¬ê¸°ì„œ ëˆˆì¹˜ ë¹ ë¥´ì‹  ë¶„ì€ ì•Œê² ì§€ë§Œ ì—ëŸ¬ íƒ€ì…ì—ëŠ” ìƒíƒœê°’ì„ ì§ì ‘ í¬í•¨í•˜ë„ë¡ êµ¬í˜„í–ˆë‹¤. ì™œëƒí•˜ë©´ ìƒíƒœ ì½”ë“œë¥¼ ì¶”ê°€í•  ì¼ì´ ë§ì€ë° ì‘ì—…ì„ ë‘ë²ˆí•´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.\n1 2 TaskCreationSuccess WebCode = 220101 SubtaskCreationSuccess WebCode = 220151 ì˜ˆë¡œ 220101 ì´ë¼ë©´ 2(Task Service)/201(Status code)/01(Unique number)ë¡œ êµ¬ì„±í•˜ë„ë¡ í–ˆë‹¤.\nì—ëŸ¬ íƒ€ì…ê³¼ ë°˜í™˜ ì´ì „ì—ëŠ” ì—ëŸ¬ íƒ€ì…ì„ Errorë¼ê³  ì •í–ˆì§€ë§Œ gin ë‚´ë¶€ì˜ ì—ëŸ¬ë¥¼ ì“°ë©´ì„œ í—·ê°ˆë¦¬ê¸° ì‹œì‘í–ˆë‹¤. ê·¸ë˜ì„œ NetErrorë¡œ ì´ë¦„ì„ ë³€ê²½í–ˆìœ¼ë©°, Description fieldëŠ” ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ì•„ ì‚­ì œí–ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 type NetError struct { Code codes.WebCode Err error } func NewNetError(code codes.WebCode, err error) *NetError { logrus.Errorf(\u0026#34;Code : %d, Error : %v\u0026#34;, code, err) if err != nil { return \u0026amp;NetError{Code: code, Err: err} } return \u0026amp;NetError{Code: code, Err: nil} } ì—ëŸ¬ëŠ” ë™ì¼í•˜ê²Œ codeë§Œ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í–ˆë‹¤.\n1 2 3 4 5 6 7 8 // Response type ErrorResponse struct { Code codes.WebCode `json:\u0026#34;codes\u0026#34;` } func NewErrorResponse(code codes.WebCode) *ErrorResponse { return \u0026amp;ErrorResponse{Code: code} } ì„±ê³µ ì‘ë‹µê°’ì„ ìƒê°í•´ë³´ë©´ í¬ê²Œ ë‘ ê°€ì§€ê°€ ì¡´ì¬í•œë‹¤.\në°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš° ì´ ë‘ê°€ì§€ë¥¼ ë‚˜ëˆ ì„œ ë³„ë„ì˜ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì—ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 func SuccessWith(ctx *gin.Context, code codes.WebCode, data any) { status := codes.GetStatus(code) res := NewSuccessResponseWith(code, data) ctx.Header(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) ctx.AbortWithStatusJSON(status, res) } func Success(ctx *gin.Context, code codes.WebCode) { status := codes.GetStatus(code) ctx.Header(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) res := NewSuccessResponse(code) ctx.JSON(status, res) } ì—ëŸ¬ ë°˜í™˜ ë¡œì§ì€ gin Middlewareë¥¼ ì‚¬ìš©í–ˆë‹¤. ìì„¸í•œ ì‚¬í•­ì€ [[Gin - ì˜ˆì™¸ì²˜ë¦¬ 2. ì»¤ìŠ¤í…€ ì˜ˆì™¸ì²˜ë¦¬ êµ¬í˜„í•˜ê¸°]] ë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.\n2ì°¨ - í”„ë¡ íŠ¸ì—”ë“œë¥¼ í•˜ê³ ë‚˜ë‹ˆ\u0026hellip; ì™œ ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œê°€ ì§ê¿ì´ ë§ì•„ì•¼ í•˜ëŠ”ì§€ ì•Œ ê²ƒ ê°™ì•˜ë‹¤. í”ŒëŸ¬í„°ì˜ ê²½ìš°ì—ëŠ” ì‘ë‹µê°’ê³¼ ë˜‘ê°™ì€ í•„ë“œë¥¼ ê°€ì§„ ëª¨ë¸ë¡œ ë°˜í™˜í•´ì•¼ í•œë‹¤. ë§Œì•½ì— ì •í™•í•˜ê²Œ ë°›ì§€ ëª»í•˜ë©´, ì•„ë¬´ëŸ° ê°’ë„ ë°›ì„ ìˆ˜ ì—†ë‹¤.(ì‹¬ì§€ì–´ ìƒíƒœê°’ë„ ë§ì´ë‹¤.) í”ŒëŸ¬í„°ë¡œì¨ëŠ” í•´ê²° ë°©ì•ˆì„ ì°¾ì§€ ëª»í•´ì„œ ì„œë²„ì¸¡ì—ì„œ ì„±ê³µì´ë“  ì˜¤ë¥˜ë“  ëª¨ë‘ ë™ì¼í•œ í˜•íƒœë¡œ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í•´ì•¼ í–ˆì—ˆë‹¤.\nResponse Format ìœ„ì—ì„œ 1ì°¨, 2ì°¨ë¥¼ ë³´ë©´ êµ¬ì²´ì ì¸ ë©”ì„¸ì§€ê°€ ì—†ì—ˆë‹¤. ë©”ì„¸ì§€ë¥¼ ë„£ì§€ ì•Šì€ ì´ìœ ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì €ëŸ°ê²ƒê¹Œì§€ ë³´ì—¬ì¤„ í•„ìš”ê°€ ì—†ë‹¤ê³  ìƒê°í•´ì„œì˜€ë‹¤. ê·¸ëŸ¬ë‚˜ ì•±ê°œë°œí•˜ë©´ì„œ ì •ë³´ê°€ ì—†ì–´ì„œ ì •ë§ í˜ë“¤ì—ˆë‹¤. ğŸ˜¥\nError Responseì˜ Best Practiceë¥¼ ì°¾ì•„ë³´ë‹ˆ ëŒ€ë¶€ë¶„ ìì²´ì ì¸ codeì™€ ì´ë¥¼ ì„¤ëª…í•˜ëŠ” ë©”ì„¸ì§€ê°€ í¬í•¨ë˜ì–´ ìˆì—ˆë‹¤.1 ì´ë²ˆì— ìˆ˜ì •í•œ ì‘ë‹µì—ì„œëŠ” ë©”ì„¸ì§€ë¥¼ ì¶”ê°€í•˜ê¸°ë¡œ í–ˆë‹¤.\nì—ëŸ¬ ìƒíƒœ íƒ€ì… ì¼ë‹¨ ì§€ê¸ˆê¹Œì§€ ì‚¬ìš©í–ˆë˜ ì—ëŸ¬ ì½”ë“œë³´ë‹¤ ê¸¸ì´ë¥¼ ë” ì¶•ì†Œì‹œì¼°ë‹¤. ê·¸ë˜ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ìƒíƒœ ì½”ë“œë¥¼ ë°±ì˜ ìë¦¬ë¡œ ë‘ê³ , 1ì”© ì¹´ìš´íŠ¸ë¥¼ ì¶”ê°€í•˜ë©´ì„œ ì—ëŸ¬ ì½”ë“œë¥¼ ì •ì˜í–ˆë‹¤. ë˜í•œ ì—ëŸ¬ì½”ë“œì— ë§¤í•‘ë˜ëŠ” ì—ëŸ¬ ë©”ì„¸ì§€ë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œì¨, ë™ì¼í•œ ì—ëŸ¬ ë©”ì„¸ì§€ë¥¼ ë°˜í™˜í•˜ë„ë¡ í–ˆë‹¤. ë©”ì„¸ì§€ëŠ” ì •í™•í•˜ê²Œ ì ì§€ ì•Šê³ , ë¬¸ì œë¥¼ ì „ë°˜ì ìœ¼ë¡œ ë³´ì—¬ì¤„ ìˆ˜ ìˆë„ë¡ ì‘ì„±í–ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 const ( // 1xx is Bad Request error code InvalidHeader ErrorCode = 101 InvalidBody ErrorCode = 102 InvalidQuery ErrorCode = 103 // 2xx is Unauthorized error code BadAuthenticationData ErrorCode = 201 TokenExpired ErrorCode = 202 ... ) var errorMessage = map[ErrorCode]string{ InvalidHeader: \u0026#34;The provided header values are invalid.\u0026#34;, InvalidBody: \u0026#34;The body of the request is invalid.\u0026#34;, InvalidQuery: \u0026#34;The query parameters are invalid.\u0026#34;, ... } ì—ëŸ¬ íƒ€ì… netErrorOptions ë¼ëŠ” ì˜µì…˜ì„ ì¶”ê°€ì‹œì¼°ëŠ”ë°, ì—¬ê¸°ì—ëŠ” ì„œë¹„ìŠ¤ì˜ ë©”íƒ€ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 // NetError have options and ErrorCode that contains status code. type NetError struct { // options is metadata about service options netErrorOptions // Type is a unique data that contains http status code. Code ErrorCode // Description is an error details. Description string // Err is an error message. Err error } ë©”íƒ€ ì •ë³´ë¡œì¨ íƒœê·¸ê°€ ìˆëŠ”ë°, ì„œë¹„ìŠ¤ ì´ë¦„ì„ ë¬¸ìì—´ë¡œ í‘œì‹œí•˜ëŠ” ê²ƒì´ë‹¤. íƒœê·¸ëŠ” ì„œë²„ì—ì„œ ë””ë²„ê¹…ì„ ì¡°ê¸ˆë” ìˆ˜ì›”í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œ ë„ì…í–ˆë‹¤. ì˜¤ë¥˜ì½”ë“œê°€ ëª¨ë‘ ë™ì¼í•´ì„œ ì–´ë–¤ ì„œë¹„ìŠ¤ì˜ ì˜¤ë¥˜ì¸ì§€ ëª…ì‹œí•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©ëœë‹¤.\n1 2 3 4 5 // netErrorOptions is meta data about service type netErrorOptions struct { // tag is the service name tag string } ì´ íƒœê·¸ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í• ë•Œ í•œë²ˆë§Œ ì„¤ì •í•˜ë„ë¡ í•¨ìœ¼ë¡œì¨, ëª¨ë“  NetErrorê°€ í•´ë‹¹ tagë¥¼ ê°€ì§€ë„ë¡ êµ¬í˜„í–ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 var ( opts netErrorOptions ) // netErrorOptions is meta data about service type netErrorOptions struct { // tag is the service name tag string } // SetTag sets the service name func SetTag(tag string) { mu := sync.Mutex{} mu.Lock() defer mu.Unlock() opts.tag = tag } ì—ëŸ¬ ë°˜í™˜ ì—ëŸ¬ëŠ” í¬ê²Œ ë‘ ê°€ì§€ë¡œ ë‚˜ëˆ ì ¸ ìˆë‹¤.\nStatus: ì‘ë‹µì˜ íƒ€ì… (\u0026ldquo;Success\u0026rdquo; or \u0026ldquo;Error\u0026rdquo;) Data : ì—ëŸ¬ ë°ì´í„° í˜¹ì€ ì„±ê³µ ì‹œ ë°˜í™˜í•  ë°ì´í„° 1 2 3 4 5 // BaseResponse is common response that use in success and failed type BaseResponse struct { Status string `json:\u0026#34;status\u0026#34;` Data interface{} `json:\u0026#34;data\u0026#34;` } ë‹¤ë§Œ ìƒì„±ìë¥¼ ë§Œë“¤ë•Œ ì„±ê³µ, ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ ë”°ë¡œ ë§Œë“¤ì—ˆë‹¤. ê·¸ ì´ìœ ëŠ” ì…ë ¥í•˜ëŠ” ê°’ì´ ë‹¤ ë‹¬ëê¸° ë•Œë¬¸ì´ë‹¤.\nì„±ê³µí•œ ê²½ìš° ë°˜í™˜í•˜ê³ ì í•˜ëŠ” ë°ì´í„°ë¥¼ Data í•„ë“œì— ë„£ê¸°ë§Œ í•˜ë©´ ëœë‹¤.\n1 2 3 4 5 6 func NewSuccessBaseResponse(data interface{}) *BaseResponse { return \u0026amp;BaseResponse{ Status: \u0026#34;Success\u0026#34;, Data: data, } } ê·¸ëŸ¬ë‚˜ ì˜¤ë¥˜ì¸ ê²½ìš°ëŠ” ë‹¤ë¥´ë‹¤. ë°˜í™˜í•  ì˜¤ë¥˜ íƒ€ì…ì€ í˜•ì‹í™”ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ErrorResponse êµ¬ì¡°ì²´ë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ì„œ Data í•„ë“œì— ì €ì¥í–ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 // ErrorResponse is the error response format type ErrorResponse struct { Code ErrorCode `json:\u0026#34;code\u0026#34;` Message string `json:\u0026#34;message\u0026#34;` } func NewErrorBaseResponse(data NetError) *BaseResponse { res := ErrorResponse{Code: data.Code, Message: GetErrorMsg(data.Code)} return \u0026amp;BaseResponse{ Status: \u0026#34;Error\u0026#34;, Data: res, } } BaseResponseê°€ ë°˜í™˜ë˜ë©´, ë©”ì†Œë“œë¡œ ì‘ë‹µê°’ì„ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í–ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // Failed response failed formatted response. // It converts NetError to ErrorResponse to extract necessary things. func (b BaseResponse) Failed(ctx *gin.Context) { res := b.GetErrorData() status := parseStatusCode(res.Code) ctx.AbortWithStatusJSON(status, b) return } // OKSuccess uses when status code is 200 func (b BaseResponse) OKSuccess(ctx *gin.Context) { ctx.Header(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) ctx.AbortWithStatusJSON(200, b) } í…ŒìŠ¤íŠ¸ gin í…ŒìŠ¤íŠ¸ ì‚¬ë¡€2ë¥¼ ì°¸ê³ í•´ì„œ ì„±ê³µí–ˆì„ ê²½ìš°ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì•˜ë‹¤. í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” í…Œì´ë¸” ì¤‘ì‹¬ í…ŒìŠ¤íŠ¸(Table-Driven Test) ë°©ì‹3ì„ ì±„íƒí–ˆë‹¤. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ê°€ ë¹„ìŠ·í•œ êµ¬ì¡°ë¡œ ì´ë¤„ì ¸ ìˆëŠ” ê²½ìš°, í…Œì´ë¸” ì¤‘ì‹¬ í…ŒìŠ¤íŠ¸ë¡œ ìˆ˜í–‰í•˜ë©´ ì½”ë“œ ì¤‘ë³µì„ í”¼í•  ìˆ˜ ìˆì–´ ë¡œì§ì„ ë³€ê²½í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ì¼€ì´ìŠ¤ë¥¼ ì¶”ê°€í•˜ê¸° ì‰½ë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤. ì‘ì„±í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ëŠ” í…ŒìŠ¤íŠ¸ êµ¬ì¡°ê°€ ë¹„ìŠ·í•˜ê³ , ë¼ìš°íŒ… ì„¤ì • ë“± ê³µí†µëœ ë¶€ë¶„ì´ ë§ì•„ì„œ í…Œì´ë¸” ì¤‘ì‹¬ í…ŒìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ê²Œ ë˜ì—ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 func setupRouter() *gin.Engine { r := gin.Default() r.Use(errorutils.ErrorMiddleware()) return r } func TestSuccessResponse(t *testing.T) { r := setupRouter() res := errorutils.NewSuccessBaseResponse(nil) // Set table tests := []struct { description string fn func(*gin.Context) expectedCode int path string }{ { // Ok Success description: \u0026#34;OKSuccess\u0026#34;, fn: func(c *gin.Context) { res.OKSuccess(c) }, expectedCode: 200, path: \u0026#34;/test/ok\u0026#34;, }, { // Created Success description: \u0026#34;CreatedSuccess\u0026#34;, fn: func(c *gin.Context) { res.CreatedSuccess(c) }, expectedCode: 201, path: \u0026#34;/test/created\u0026#34;, }, } for _, tc := range tests { t.Run(tc.description, func(t *testing.T) { w := httptest.NewRecorder() req, _ := http.NewRequest(\u0026#34;GET\u0026#34;, tc.path, nil) // Specific handler function and serve r.GET(tc.path, tc.fn) r.ServeHTTP(w, req) if w.Code != tc.expectedCode { t.Errorf(\u0026#34;Expected %d, got %d\u0026#34;, tc.expectedCode, w.Code) } }) } } í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.\në§ˆì¹˜ë©° í•˜ë‚˜ì˜ ê°„ë‹¨í•œ CRUDê°€ ìˆëŠ” ì„œë¹„ìŠ¤ 2ê°œë¥¼ ê°€ì§€ê³  ì½”ë“œë¥¼ ì—¬ëŸ¬ë²ˆ ìˆ˜ì •í–ˆë‹¤. ê·¸ ê³¼ì •ì—ì„œ ë‹¤ì–‘í•œ ì˜¤ë¥˜ë¥¼ ë§Œë‚¬ê³ , í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ ì¤‘ìš”ì„±ë„ í™•ì‹¤íˆ ì•Œì•˜ë‹¤. íŠ¹íˆ ì´ë²ˆì— í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ì„œ ì˜¤ë¥˜ë¥¼ ë§ì´ ë§ˆì£¼ í–ˆëŠ”ë°, ì´ë¥¼ ì¬ë¹ ë¥´ê²Œ ìˆ˜ì •í•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ì˜ ì¤‘ìš”ì„±ì„ ëŠë¼ê²Œ ë˜ì—ˆë‹¤.\nhttps://pjh3749.tistory.com/273\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://gin-gonic.com/docs/testing/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://bugoverdose.github.io/development/go-table-driven-tests/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-05-11T00:00:00Z","permalink":"https://s0okju.github.io/p/go-code-refactor-error-1/","title":"Todopoint ì„œë²„ì½”ë“œ ê°œì„ ê¸° -  1. ê³µë™ ì—ëŸ¬ ì²˜ë¦¬í•˜ê¸°"},{"content":"EKS Amazon Web Services(AWS)ì—Â KubernetesÂ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì„ ì„¤ì¹˜, ìš´ì˜ ë° ìœ ì§€ ê´€ë¦¬í•  í•„ìš”ê°€ ì—†ëŠ” ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ì´ë‹¤1.\nECS vs EKS ë‘˜ ë‹¤ ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ì´ë¼ëŠ” ì ì—ì„œ ê³µí†µì ì„ ê°€ì§ ECSëŠ” AWSê°€ ë§Œë“  ìì²´ì ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ êµ¬ì¡°ë¡œ K8S êµ¬ì¡°ì™€ ì™„ì „ ë‹¤ë¦„ K8SëŠ” ì˜¤í”ˆì†ŒìŠ¤ê°€ í¬ê²Œ í™œì„±í™”ë˜ì–´ ìˆê³ , ë‹¤ì–‘í•œ í”ŒëŸ¬ê·¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ ECSëŠ” ì˜¤í”ˆì†ŒìŠ¤ê°€ í¬ê²Œ í™œì„±í™”ë˜ì–´ ìˆì§€ ì•ŠìŒ. Auto-scaling ì¸¡ë©´ì—ì„œ EKSëŠ” ìˆ˜ë™ ë° ìë™ ë°°í¬ê°€ ê°€ëŠ¥í•˜ì§€ë§Œ ECSëŠ” ìˆ˜ë™ìœ¼ë¡œë§Œ ê°€ëŠ¥í•˜ë‹¤. ì˜¤ë¥˜ ìˆ˜ì •í•˜ëŠ”ë° ECSëŠ” ì „ë¬¸ê°€ê°€ í•„ìš”í•¨ ğŸ“Œ ìì„¸í•œ ì‚¬í•­ì€ ë¬¼í†µê¿€ê¿€ì´ë‹˜ì˜ ë¸”ë¡œê·¸, [AWS] ECS vs Kubernetesë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ëŒ.\nğŸ¤” EKSê°€ ë¬´ì¡°ê±´ ì •ë‹µì€ ì•„ë‹ˆë‹¤. í”„ë¡œì íŠ¸ì— ë”°ë¼ì„œëŠ” ECSê°€ ë” ì í•©í•œ ì„ íƒì§€ì¼ ìˆ˜ ìˆë‹¤.\nECS ì ìš© ì‚¬ë¡€ - ë°ê¸€ ì™œ EKS ì„¤ì¹˜ëŠ” ì–´ë ¤ìš´ê°€? ìš°ë¦¬ê°€ ì•Œê³  ìˆëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ êµ¬ì¡°ì™€ ë‹¬ë¦¬ ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì¼ë¶€ ë„êµ¬ë§Œ ì œê³µí•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” ë³„ë„ì˜ ì„¤ì¹˜ê°€ í•„ìš”í•˜ë‹¤. ì´ëŸ° ì´ìœ ë¡œ ë²„ì „ ê´€ë¦¬ê°€ ì–´ë ¤ì›Œì§€ê¸°ë„ í•œë‹¤.\nì¿ ë²„ë„¤í‹°ìŠ¤ ì œê³µ : kube-proxy, kubelet CNCF Graduated Projectë¥¼ ë³´ë©´ etcd, coreDNS ë“±ì„ ë³¼ ìˆ˜ ìˆë‹¤.\nEKS êµ¬ì¡° ì•ì„œ ë§í–ˆë“¯ì´ ì§ì ‘ êµ¬ì¶•í•˜ê²Œ ë˜ë©´, ê´€ë¦¬í•´ì•¼ í•˜ëŠ” ìš”ì†Œë“¤ì´ ë§ë‹¤. ì´ëŸ¬í•œ ì–´ë ¤ì›€ì„ ëœì–´ë‚´ê³ ì EKSë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. EKSëŠ” ê´€ë¦¬í˜• \bì„œë¹„ìŠ¤ë¡œì„œ Control Planeë¥¼ ì§ì ‘ êµ¬ì„±í•˜ì§€ ì•Šê³  K8Së¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. EKS íŠ¹ì§• EKS CNIë¥¼ í™œìš©í•˜ì—¬ VPC ë„¤íŠ¸ì›Œí¬ ìƒì—ì„œ íŒŒë“œê°„ í†µì‹  ê°€ëŠ¥ IAMì„ í™œìš©í•˜ì—¬ ê¶Œí•œ ì„¤ì • ê°€ëŠ¥ AWSê°€ ê°€ìš© ì˜ì—­ë³„ API Server ,etcd ë°°í¬í•˜ì—¬ ê³ ê°€ìš©ì„± ë³´ì¥ eksctlë¥¼ í™œìš©í•˜ì—¬ ì›Œì»¤ë…¸ë“œë¥¼ customí•  ìˆ˜ ìˆìŒ. ğŸ“Œ ìì„¸í•œ ì‚¬í•­ì€ Jaden Parkë‹˜ì˜ ë¸”ë¡œê·¸, Amazon EKS ë€?ë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.\nAWS Side Workflow ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ api ì„œë²„ë¥¼ ê° ê°€ìš©ì˜ì—­ì— ë°°í¬ api ë°ì´í„°, ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ìƒíƒœ ë°ì´í„°ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ etcdë¥¼ ê°™ì´ ë°°í¬ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì˜¤ëŠ” call ì— ëŒ€í•œ IAM êµ¬ì„± ì¿ ë²„ë„¤í‹°ìŠ¤ ë§ˆìŠ¤í„° ë…¸ë“œì˜ ì˜¤í† ìŠ¤ì¼€ì¼ë§ ì„¤ì • í´ëŸ¬ìŠ¤í„°ê°€ ì•ˆì •ì ìœ¼ë¡œ êµ¬í˜„í•˜ë„ë¡ ì—¬ê¸°ì— ì—°ê²°í•  ìˆ˜ ìˆëŠ” ë¡œë“œë°¸ëŸ°ì„œë¥¼ êµ¬ì„± Reference ì´ˆë³´ìë¥¼ ìœ„í•œ EKS ë§› ë³´ê¸° ECS vs Kubernetes https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/what-is-eks.html\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-05-01T00:00:00Z","permalink":"https://s0okju.github.io/p/what-is-eks/","title":"AWS - EKSë€ ë¬´ì—‡ì¸ê°€"},{"content":"Introduction Terraform ì½”ë“œë¥¼ ë¶„ì„í•˜ê³  ìˆì—ˆë‹¤. ì–´ë””ì—ì„œëŠ” IAMì„ ì“°ê³ , ì–´ë””ì—ì„œëŠ” Profileì„ ì“´ë‹¤. ê³¼ì—° ê·¸ ë‘˜ì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì¼ê¹Œ? ì•Œì•„ë³´ë„ë¡ í•˜ì!\nProfile Amazon Ec2ëŠ” IAM roleì„ ê°€ì§„ profileì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.\nì§ˆë¬¸ 1. awsclië¥¼ í†µí•´ profileì„ ì§€ì •í•  ìˆ˜ ìˆëŠ”ë°, ì´ê²ƒë„ Instance Profileì¸ê°€? If you use the AWS CLI, API, or an AWS SDK to create a role, you create the role and instance profile as separate actions, with potentially different names. If you then use the AWS CLI, API, or an AWS SDK to launch an instance with an IAM role or to attach an IAM role to an instance, specify the instance profile name. ì¶œì²˜ - ê³µì‹ ë¬¸ì„œ\nì§ˆë¬¸ì´ ì˜ëª»ë˜ì—ˆë‹¤. EC2ëŠ” í•´ë‹¹ IAM Roleì„ ê°€ì§„ Profileì„ ì‚¬ìš©í•œë‹¤. ê·¸ë˜ì„œ awscliì˜ ê²½ìš° \u0026ndash;profileì„ í†µí•´ ì§ì ‘ profile ì´ë¦„ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤. ì™œ í•„ìš”í• ê¹Œ? aws clië¥¼ ì‚¬ìš©í•  ë•Œ profile ê¸°ëŠ¥ì„ ì´ìš©í•˜ë©´ ì—¬ëŸ¬ê°œì˜ ìê²© ì¦ëª…ì„ ë“±ë¡í•˜ê³  ìŠ¤ìœ„ì¹­í•´ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì¶œì²˜ - https://cloudest.oopy.io/posting/101\nì§ˆë¬¸ 2. IAM Roleê³¼ì˜ ì°¨ì´ì ì€? Profileì´ í•„ìš”í•œ ì´ìœ ëŠ” ì—¬ëŸ¬ê°œì˜ ìê²© ì¦ëª…ì„ ë“±ë¡í•˜ê³  ìŠ¤ìœ„ì¹­í•´ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•¨ì´ë¼ê³  í–ˆë‹¤. íŠ¹ì§•ì„ ë´¤ì„ë•Œ IAMì˜ Roleê³¼ ë¹„ìŠ·í•´ ë³´ì˜€ë‹¤.\nRoles are designed to be â€œassumedâ€ by other principals which do define â€œwho am I?â€, such as users, Amazon services, and EC2 instances An instance profile, on the other hand, defines â€œwho am I?â€ Just like an IAM user represents a person, an instance profile represents EC2 instances. The only permissions an EC2 instance profile has is the power to assume a role.\nì¶œì²˜ - https://www.quora.com/In-AWS-what-is-the-difference-between-a-role-and-an-instance-profile\nIAM Roleì€ ë¬´ì—‡ì„ í•  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ í–‰ìœ„ë¥¼ ì •ì˜í•˜ëŠ” ê²ƒì´ë¼ë©´ Profile InstanceëŠ” \u0026ldquo;ëˆ„ê°€ ë§Œë“¤ì—ˆëŠ”ì§€ë¥¼ ì •ì˜í•˜ê¸°\u0026rdquo; ìœ„í•¨ì´ë¼ë©´ ë³´ë©´ ëœë‹¤.\nConclusion ë‚´ê°€ ì´ëŸ¬í•œ ê¶ê¸ˆì¦ì„ ê°€ì§€ê²Œ ëœ ê²ƒì€ IAMì„ í•œì‚¬ëŒì—ê²Œë§Œ ë¶€ì—¬ëœë‹¤ê³  ìƒê°í–ˆê¸° ë•Œë¬¸ì´ì—ˆë‹¤. ê·¸ëŸ° ë§¥ë½ì—ì„œëŠ” profileì´ í•„ìš” ì—†ê¸° ë•Œë¬¸ì´ë‹¤. Reference https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html ","date":"2024-04-16T00:00:00Z","permalink":"https://s0okju.github.io/p/iam-and-profile/","title":"AWS - IAM ê·¸ë¦¬ê³  Profile"},{"content":"ì´ì „ì—ëŠ” Ginì´ ì–´ë–»ê²Œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•˜ëŠ”ì§€ ì–¸ê¸‰í–ˆë‹¤. ì´ì œë¶€í„° ì§ì ‘ êµ¬í˜„í•˜ê³ ì í•œë‹¤.\nError Wrapping ì§ì ‘ ì œì‘í•œ ì—ëŸ¬ ì½”ë“œì¸ WebCodeì™€ ì—ëŸ¬ë¥¼ ê°ì‹¼ NetErrorë¥¼ ë§Œë“¤ì—ˆë‹¤.\n1 2 3 4 type NetError struct { Code codes.WebCode Err error } í”„ë¡œì íŠ¸ êµ¬í˜„í• ë•Œ ì£¼ë¡œ gin í˜¹ì€ ent ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì“´ë‹¤. ë³„ë„ì˜ Error êµ¬ì¡°ì²´(NetError)ë¥¼ ì •ì˜í•¨ìœ¼ë¡œì¨ Errì— gin í˜¹ì€ ent ì—ëŸ¬ë¥¼ ë‹´ê² ë‹¤ëŠ” ì˜ë¯¸ì¸ ê²ƒì´ë‹¤.\nGinì—ì„œì˜ ì˜ˆì™¸ ì²˜ë¦¬ Gin Error() í•¨ìˆ˜ì— ì˜í•˜ë©´ Ginì˜ Contextì— Errorë¥¼ ë‹´ì€ í›„ì— Middlewareì—ì„œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•˜ê³  ìˆë‹¤.\nError attaches an error to the current context. The error is pushed to a list of errors. It\u0026rsquo;s a good idea to call Error for each error that occurred during the resolution of a request. A middleware can be used to collect all the errors and push them to a database together, print a log, or append it in the HTTP response. Error will panic if err is nil.\në¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œë¥¼ ë³´ë©´ Errors í•„ë“œê°€ ì •ì˜ë˜ì–´ ìˆëŠ”ë°, errorMsgëŠ” []*Error ì—ëŸ¬ ë¦¬ìŠ¤íŠ¸ë¡œ íƒ€ì…ì„ ê°€ì§€ê³  ìˆë‹¤. ìœ„ì˜ ì„¤ëª…ëŒ€ë¡œ errorì˜ ë¦¬ìŠ¤íŠ¸ê°€ Context ë‚´ë¶€ì— êµ¬í˜„ë˜ì–´ ìˆëŠ” ê²ƒì´ë‹¤.\n1 2 3 4 5 6 7 8 9 // gin/context.go type Context struct { // ... Errors errorMsgs // .. } // gin/errors.go type errorMsgs []*Error ì¦‰, ctx.Errorë¥¼ í™œìš©í•˜ì—¬ ì…ë ¥ë°›ì€ ì—ëŸ¬ë¥¼ Ginì˜ ì—ëŸ¬ë¡œ ê°ì‹¼ í›„ì— Contextì˜ Errors ë¦¬ìŠ¤íŠ¸ì— ë„£ê²Œ ëœë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // gin/context.go // Error attaches an error to the current context. The error is pushed to a list of errors.// It\u0026#39;s a good idea to call Error for each error that occurred during the resolution of a request.// A middleware can be used to collect all the errors and push them to a database together, // print a log, or append it in the HTTP response. // Error will panic if err is nil. func (c *Context) Error(err error) *Error { if err == nil { panic(\u0026#34;err is nil\u0026#34;) } var parsedError *Error ok := errors.As(err, \u0026amp;parsedError) if !ok { parsedError = \u0026amp;Error{ Err: err, Type: ErrorTypePrivate, } } c.Errors = append(c.Errors, parsedError) return parsedError } Context ë‚´ë¶€ì— ìˆëŠ” Error ë¦¬ìŠ¤íŠ¸ëŠ” Middlewareì—ì„œ ì²˜ë¦¬í•˜ê²Œ ëœë‹¤.\nGinì—ì„œëŠ” HandlerFuncë¥¼ sliceë¡œ êµ¬í˜„ëœ HandlerChainì´ ìˆëŠ”ë°, ì´ëŠ” Ginì´ ê°ê°€ì§€ì˜ Handlerë¥¼ Chainë‚´ì— ë„£ê³  ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ë‹¤.\n1 type HandlersChain []HandlerFunc ê·¸ëŸ¼ ì˜¤ë¥˜ë¥¼ ì–´ë–»ê²Œ ë°œìƒì‹œí‚¤ë©´ ë ê¹Œ? HandlerChain ë‚´ì— ìˆëŠ” ëŒ€ê¸° ì¤‘ì¸(Pending) Handlerë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šë„ë¡ í•˜ë©´ëœë‹¤. ì¦‰, Contextë¥¼ Abortí•˜ë©´ ë˜ëŠ” ê²ƒì´ë‹¤. ê·¸ ì´í›„ì— ì²˜ë¦¬í•  Handlerê°€ ì—†ì–´ì§€ë©´ì„œ ì¢…ë£Œê°€ ëœë‹¤.\nAbort prevents pending handlers from being called. Note that this will not stop the current handler. Let\u0026rsquo;s say you have an authorization middleware that validates that the current request is authorized. If the authorization fails (ex: the password does not match), call Abort to ensure the remaining handlers for this request are not called.\ní”„ë¡œì íŠ¸ì— ì ìš©í•˜ê¸° ì ˆì°¨ ìœ„ì˜ ë‚´ìš©ì„ ê°€ì§€ê³  ì‹¤ì œë¡œ ì ìš©í•´ë³´ì. í”„ë¡œì íŠ¸ êµ¬ì„±ì€ 3ê³„ì¸µìœ¼ë¡œ ì»¤ìŠ¤í…€ ì—ëŸ¬ ê°ì‹¸ê¸°ëŠ” ì„œë¹„ìŠ¤ ë¡œì§ì— ìˆ˜í–‰í•˜ë„ë¡ í–ˆë‹¤.\nService ê³„ì¸µì— Error Wrappingì„ í•œë‹¤. Controllerì— context ë‚´ì— ìˆëŠ” ì—ëŸ¬ ë¦¬ìŠ¤íŠ¸ì— ì˜ˆì™¸ë¥¼ ë„£ëŠ”ë‹¤. Middlewareì— Error Wrappingí•œ ê²ƒì„ Unwrapping í•˜ë©´ì„œ ì˜ˆì™¸ íƒ€ì…ì„ í•™ì¸í•œë‹¤. ì»¤ìŠ¤í…€ ì—ëŸ¬ë¼ë©´ WebCodeì— ë”°ë¥¸ ì‘ë‹µê°’ì„ ë°˜í™˜í•œë‹¤. ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•˜ìë©´ ì•„ë˜ì™€ ê°™ë‹¤. ì½”ë“œ ì½”ë“œëŠ” ì•„ë˜ì˜ ë‘ ì‚¬ì´íŠ¸ë¥¼ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤.\nNaver D2, Golang, ê·¸ëŒ€ë“¤ì€ ì–´ë–»ê²Œ í•  ê²ƒì¸ê°€ - 3. error ë˜í•‘ Naver D2, Golang, ê·¸ëŒ€ë“¤ì€ ì–´ë–»ê²Œ í•  ê²ƒì¸ê°€ - 4. error í•¸ë“¤ë§ Service Layer Persistence Layerì—ì„œ ì–»ì€ ì—ëŸ¬ ê°’ì„ ì§ì ‘ ë°›ì€ í›„ì— Service ê³„ì¸µì—ì„œ ì ì ˆí•˜ê²Œ NetErrorë¡œ ê°ì‹¼ë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // service func (s *MemberService) CreateMember(ctx *gin.Context, req data.RegisterReq) (*ent.Member, *errorutils.NetError) { // Check member Exist existedMem, err := s.Store.GetMemberByEmail(ctx, req.Email) if err != nil { return nil, \u0026amp;errorutils.NetError{Code: codes.MemberInternalServerError, Err: err} } if ent.IsNotFound(err) { mem, err2 := s.Store.Create(ctx, req) if err2 != nil { return nil, \u0026amp;errorutils.NetError{Code: codes.MemberCreationError, Err: err2} } return mem, nil } return existedMem, nil } Controller Layer ControllerëŠ” Service ê³„ì¸µì—ì„œ ê°ì‹¼ ì»¤ìŠ¤í…€ ì—ëŸ¬ë¥¼ ë°›ì€ í›„ì— Contextì˜ ì—ëŸ¬ ë¦¬ìŠ¤íŠ¸ì— ë„£ëŠ”ë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 func (controller *MemberController) RegisterMember(ctx *gin.Context) { req := data.RegisterReq{} err := ctx.ShouldBindJSON(\u0026amp;req) if err != nil { _ = ctx.Error(errorutils.NewNetError(codes.MemberInvalidJson, err)) return } // Create member mem, err2 := controller.service.CreateMember(ctx, req) if err2 != nil { // Service ê³„ì¸µì—ì„œ ë°›ì€ ì—ëŸ¬ë¥¼ Context ë‚´ ì—ëŸ¬ ë¦¬ìŠ¤íŠ¸ì— ë„£ëŠ”ë‹¤. _ = ctx.Error(err2) return } mid := data.MemberId{MemberId: mem.ID} response.SuccessWith(ctx, codes.MemberCreationSuccess, mid) } Middleware ì—ëŸ¬ ì‘ë‹µê°’ì„ ë°˜í™˜í•  HandlerFuncë¥¼ êµ¬í˜„í•œë‹¤.\nNextë¥¼ í™œìš©í•˜ì—¬ ëŒ€ê¸° ì¤‘ì¸ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤. errors.Asë¥¼ í™œìš©í•˜ì—¬ Context ì—ëŸ¬ ë¦¬ìŠ¤íŠ¸ì— ìˆëŠ” ì—ëŸ¬ê°€ ì»¤ìŠ¤í…€ ì—ëŸ¬ì¸ì§€ í™•ì¸í•œë‹¤. ì •í™•íˆ ë§í•˜ìë©´ ì—ëŸ¬ë¥¼ unwrappingí•˜ë©´ì„œ ì»¤ìŠ¤í…€ ì—ëŸ¬ì¸ì§€ í™•ì¸í•œ í›„ì— ìˆë‹¤ë©´ netErrorì— ë„£ê²Œ ëœë‹¤. WebCodeë¥¼ í™œìš©í•˜ì—¬ ì‘ë‹µê°’ì„ ì–»ì€ í›„ AbortWithStatusJson ë¥¼ í™œìš©í•˜ì—¬ Response jsonì„ ì „ì†¡í•œë‹¤. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 func ErrorHandler() gin.HandlerFunc { return func(ctx *gin.Context) { // Pending ì¤‘ì¸ í•¸ë“¤ëŸ¬ ì‹¤í–‰ ctx.Next() // JSONì´ ë‘ë²ˆ ì“°ì´ëŠ” ê²ƒì„ ëŒ€ë¹„í•´ì„œ Body í™•ì¸ isBodyWritten := ctx.Writer.Written() err := ctx.Errors.Last() if err != nil { // ì»¤ìŠ¤í…€ ì—ëŸ¬ì¸ì§€ í™•ì¸ var netErr *errorutils.NetError if errors.As(err, \u0026amp;netErr) { code := netErr.GetCode() statusCode := codes.GetStatus(code) res := response.NewErrorResponse(code) if !isBodyWritten { ctx.AbortWithStatusJSON(int(statusCode), res) } } else { res := response.NewErrorResponse(codes.GlobalInternalServerError) if !isBodyWritten { ctx.AbortWithStatusJSON(http.StatusInternalServerError, res) } } } } } ë§ˆë¬´ë¦¬ Goì˜ ì˜ˆì™¸ ë§¤ì»¤ë‹ˆì¦˜ì€ ë‹¤ë¥¸ ì–¸ì–´ì™€ ë‹¬ë¼ì„œ í‹€ì„ ì¡ëŠ”ë° ë§ì€ ì‹œê°„ì„ ì‚¬ìš©í–ˆë‹¤. ê³µì‹ ë¬¸ì„œë‚˜ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ì˜ˆì œ ì½”ë“œë¥¼ ë¶„ì„í•˜ë©´ì„œ, Go ìŠ¤ëŸ¬ì›€ì´ ë¬´ì—‡ì¸ì§€ ìì¸° ë°°ì›Œê°„ë‹¤ëŠ” ëŠë‚Œì´ë‹¤. ê·¸ëŸ¬ë‚˜ ì½”ë“œì–‘ì´ ë§ì•„ì§€ë©´ì„œ ì˜¤íˆë ¤ ì½”ë“œê°€ ë³µì¡í•´ì§€ëŠ” ê²ƒ ê°™ê¸°ë„ í•˜ë‹¤.\n","date":"2024-04-10T00:00:00Z","permalink":"https://s0okju.github.io/p/gin-error-handling-2/","title":"Gin ì˜ˆì™¸ì²˜ë¦¬ - 2. ì»¤ìŠ¤í…€ ì˜ˆì™¸ì²˜ë¦¬"},{"content":"Goì™€ ì˜ˆì™¸ì²˜ë¦¬ Goì—ì„œì˜ ì˜ˆì™¸ì²˜ë¦¬ Goì—ì„œëŠ” í•¨ìˆ˜ì—ì„œ ë°˜í™˜ëœ ì—ëŸ¬ ê°ì²´(error)ë¡œ ì²˜ë¦¬í•œë‹¤. ë‹¤í–‰íˆë„ multi-returnì´ ê°€ëŠ¥í•˜ê¸°ì— ì—ëŸ¬ ë°˜í™˜ì„ ë”ìš± ìˆ˜ì›”í•˜ê²Œ í•´ì¤„ ìˆ˜ ìˆë‹¤.\n1 2 3 4 f, err := Sqrt(-1) if err != nil { fmt.Println(err) } try ~ catchê°€ ì—†ëŠ” ì´ìœ  ê³µì‹ ë¬¸ì„œì— ì˜í•˜ë©´ try ~ catchëŠ” ë‚œí•´í•œ ì½”ë“œë¥¼ ìƒì„±í•˜ë©°, ê°œë°œìì—ê²Œ ë„ˆë¬´ë§ì€ ì¼ë°˜ì ì¸ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ë„ë¡ ì¥ë ¤í•œë‹¤ê³  í•œë‹¤.\nWe believe that coupling exceptions to a control structure, as in theÂ try-catch-finallyÂ idiom, results in convoluted code. It also tends to encourage programmers to label too many ordinary errors, such as failing to open a file, as exceptional.\në‹¤ë¥¸ ì–¸ì–´ì²˜ëŸ¼ try ~ catch ë¥¼ ì–´ë ´í’‹ì´ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. ì¤‘ê°„ì— ì‹¤í–‰ì˜ íë¦„ì„ ëŠëŠ” panic í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ë°˜ëŒ€ë¡œ ìƒê°í•˜ìë©´ ëª¨ë“  ì—ëŸ¬ë“¤ì„ panicìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í• ê¹Œ? Goì—ì„œëŠ” ê·¸ê²ƒì´ ì•„ë‹ˆë¼ëŠ” ê²ƒì´ë‹¤. ì´ëŸ° ì´ìœ ë¡œ GoëŠ” ì‹œì˜ì ì ˆí•˜ê¸° ì˜ˆì™¸ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ errorë¥¼ ë°˜í™˜í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ê²Œ ëœë‹¤.\nError - Wrapping Goì—ì„œëŠ” ì—ëŸ¬ì²˜ë¦¬í•  ë•Œ Error ê°ì²´ë¥¼ ë„˜ê²¨ì¤€ë‹¤ê³  í•œë‹¤. ë¬¼ë¡  ì¼ë°˜ ì—ëŸ¬ ê°ì²´ë¥¼ ë„˜ê²¨ì¤„ ìˆ˜ ìˆì§€ë§Œ ê°œë°œìê°€ ì§ì ‘ ë§Œë“  ì—ëŸ¬ë¥¼ ë§Œë“¤ì–´ì„œ ë„˜ê²¨ì¤„ ìˆ˜ ìˆë‹¤. Error Wrappingì´ë€ ì‰½ê²Œ ë§í•˜ìë©´ error ê°ì²´ë¥¼ ê°ì‹¸ëŠ” ë˜ë‹¤ë¥¸ êµ¬ì¡°ì²´ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë¼ê³  ë³´ë©´ ëœë‹¤.\nginì—ì„œì˜ Errorë¥¼ ë´ë³´ì. ginì˜ Error ë‚´ì— í•„ë“œë¡œ errorê°€ ì¡´ì¬í•œë‹¤. ì´ëŸ¬í•œ ê³¼ì •ì„ Error Wrappingì´ë¼ê³  ë³´ë©´ ëœë‹¤.\n1 2 3 4 5 6 // Error represents a error\u0026#39;s specification. type Error struct { Err error Type ErrorType Meta any } ê·¸ëŸ¼ ì˜ˆë¥¼ ë“¤ì–´ë³´ì. ctx.Errorë¥¼ ì‹¤í–‰í–ˆëŠ”ë° ì˜ë„ì¹˜ ì•Šê²Œ errors.Asê°€ ì ì ˆí•˜ê²Œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  ê°€ì •í•´ë³´ì. error.AsëŠ” Error Typeì„ í™•ì¸í•˜ëŠ” í•¨ìˆ˜ì¸ë°, ë§Œì•½ì— íƒ€ì…ì´ ì ì ˆí•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ì…ë ¥í•œ errorì„ ê°ì‹¼ Errorë¥¼ ë°˜í™˜í•˜ê²Œ ëœë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 func (c *Context) Error(err error) *Error { if err == nil { panic(\u0026#34;err is nil\u0026#34;) } var parsedError *Error ok := errors.As(err, \u0026amp;parsedError) if !ok { parsedError = \u0026amp;Error{ Err: err, Type: ErrorTypePrivate, } } c.Errors = append(c.Errors, parsedError) return parsedError } ê·¸ëŸ¼ ì›ë³¸ ì—ëŸ¬(error)ì— ì ‘ê·¼í•  ìˆ˜ ìˆì„ê¹Œ? ë°”ë¡œ Unwrapë¥¼ í†µí•´ ì–»ì„ ìˆ˜ ìˆì€ ê²ƒì´ë‹¤.\n1 2 3 4 // Unwrap returns the wrapped error, to allow interoperability with errors.Is(), errors.As() and errors.Unwrap() func (msg *Error) Unwrap() error { return msg.Err } ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.\nê¸°ì¡´ì˜ ë¬¸ì œì  Gin Contextì˜ ì˜ëª»ëœ í™œìš©ë²• ê³µì‹ ë¬¸ì„œì—ì„œ ë§í•˜ëŠ” ContextëŠ” ë°ë“œë¼ì¸, ì·¨ì†Œ ì‹œê·¸ë„, APIì— ëŒ€í•œ ê²½ê³„ê°’ì„ ê°€ì§€ëŠ” ê°’ìœ¼ë¡œ ì •ì˜ëœë‹¤. ê·¸ë˜ì„œ ì¡°ê±´ì— ë”°ë¼ ì‹¤í–‰ì´ ì¤‘ë‹¨ë  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒìœ¼ë¡œ ì´í•´í–ˆë‹¤. ginì€ ìì²´ì ì¸ Contextë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, contextë¥¼ ì¤‘ë‹¨ì‹œí‚¬ ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ í•¨ìˆ˜ë“¤ì´ ì¡´ì¬í•œë‹¤.\nService Layerì—ì„œ ì»¤ìŠ¤í…€ ì—ëŸ¬ íƒ€ì…ìœ¼ë¡œ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í–ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 func (controller *MemberController) RegisterMember(ctx *gin.Context, req request.RegisterReq) { req = request.RegisterReq{} err := ctx.ShouldBindJSON(req) // ... // Create member err2 := controller.service.CreateMember(ctx, req) if err2 != nil { errorutils.ErrorFunc(ctx, err2) return } webutils.Success(ctx) } ì»¤ìŠ¤í…€ ì—ëŸ¬ íƒ€ì…ì„ ìì„¸íˆ ë³´ë©´, ìì²´ì ìœ¼ë¡œ ì œì‘í•œ ì—ëŸ¬ ì½”ë“œì™€ errorì„ ë‹´ì„ Err í•„ë“œê°€ ì¡´ì¬í•œë‹¤.\n1 2 3 4 5 6 7 8 type Error struct { // Code is a custom error codes ErrorType ErrorType // Err is a error string Err error // Description is a human-friendly message. Description string } ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì˜¤ë¥˜ ë°œìƒì‹œ í˜„ì¬ ì‹¤í–‰ì„ ë©ˆì¶”ê³ , ì‘ë‹µê°’ì„ ë³´ë‚´ëŠ” ErrorFuncë„ ë§Œë“¤ì—ˆë‹¤.\n1 2 3 4 5 6 func ErrorFunc(ctx *gin.Context, err *Error) { res := getCode(err.ErrorType) ctx.AbortWithStatusJSON(res.Code, res) return } ê³µì‹ ë¬¸ì„œ ì— ì˜í•˜ë©´AbortWithStatusJSONì—ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ Contextë¥¼ ì¤‘ë‹¨ì‹œí‚¬ ìˆ˜ ìˆëŠ”Abort í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤. êµ¬ì²´ì ìœ¼ë¡œ Abort í•¨ìˆ˜ëŠ” í˜„ì¬ì˜ handlerëŠ” ê·¸ëŒ€ë¡œ ë‚¨ì§€ë§Œ, ê·¸ ì´í›„ì˜ handlerë¥¼ ì²˜ë¦¬í•˜ì§€ ì•Šê² ë‹¤ëŠ” ê²ƒì´ë‹¤.\nAbort prevents pending handlers from being called. Note that this will not stop the current handler. Let\u0026rsquo;s say you have an authorization middleware that validates that the current request is authorized. If the authorization fails (ex: the password does not match), call Abort to ensure the remaining handlers for this request are not called.\në¬¸ì¥ì„ ë³´ë©´ì„œ ë‚´ê°€ Gin í”„ë ˆì„ì›Œí¬ì˜ ì—ëŸ¬ì²˜ë¦¬ë¥¼ ì™„ì „íˆ ì˜ëª»í–ˆìŒì„ ê¹¨ë‹«ê²Œ ë˜ì—ˆë‹¤.\nGin Error ë¯¸ì‚¬ìš© ê³µì‹ ë¬¸ì„œì— ì˜í•˜ë©´ Ginì€ ìì‹ ë“¤ì˜ Errorë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•˜ë©°, middlewareê°€ ì´ë¥¼ ì²˜ë¦¬í•˜ì—¬ ì˜¤ë¥˜ responseë¥¼ ì²˜ë¦¬í•˜ë¼ê³  ëª…ì‹œë˜ì–´ ìˆë‹¤.\nError attaches an error to the current context. The error is pushed to a list of errors. It\u0026rsquo;s a good idea to call Error for each error that occurred during the resolution of a request. A middleware can be used to collect all the errors and push them to a database together, print a log, or append it in the HTTP response. Error will panic if err is nil.\nì¦‰, ì˜¤ë¥˜ê°€ ë°œìƒí• ë•Œë§ˆë‹¤ ginì˜ Contextì—ì„œ ì œê³µí•´ì£¼ëŠ” Errorë¡œ ê°ì‹¸ë©°, Middlewareì— ìˆëŠ” Handlerê°€ ì´ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.\n2ë¶€ì—ì„œëŠ” ì§€ê¸ˆê¹Œì§€ëŠ” ë‚´ê°€ ë§Œë“¤ì—ˆë˜ ì˜ˆì™¸ì²˜ë¦¬ì—ëŠ” ì–´ë– í•œ ë¬¸ì œì ì´ ìˆëŠ”ì§€ í™•ì¸í•´ë´¤ë‹¤. 2ë¶€ì—ì„œëŠ” ìœ„ì—ì„œ ì„¤ëª…í•œ ì˜ëª»ëœ ì—ëŸ¬ì²˜ë¦¬ë¥¼ ê³µì‹ë¬¸ì„œì—ì„œ ì œì‹œí•œ ì˜¬ë°”ë¥¸ ì—ëŸ¬ì²˜ë¦¬ë¥¼ êµ¬í˜„í•˜ê³ ì í•œë‹¤.\nMiddlewareì— Handler êµ¬í˜„ gin.Errorë¥¼ í™œìš©í•˜ì—¬ Errorë¥¼ wrappingí•˜ê³ , Middlewareì—ì„œ ì²˜ë¦¬í•˜ê¸° ","date":"2024-04-03T00:00:00Z","permalink":"https://s0okju.github.io/p/gin-error-handling-1/","title":"Gin ì˜ˆì™¸ì²˜ë¦¬ - 1. Go Error"},{"content":"ë„ì»¤ì™€ ë°ì´í„°ë² ì´ìŠ¤ í•œì°¸ ì»¨í…Œì´ë„ˆë¥¼ ê³µë¶€ë¥¼ í–ˆì„ ë‹¹ì‹œ ë„ì»¤ì˜ ì£¼ ëª©ì ì´ ë¹ ë¥¸ ë°°í¬/ê°œë°œ í™˜ê²½ì„ êµ¬ì„±í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ì˜ì†ì„±ì„ ê°€ì§„ ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” ì í•©í•˜ì§€ ì•Šì•˜ë‹¤ê³  ì•Œê³  ìˆë‹¤. ì´ì— ëŒ€í•œ ë¬¸ì œì ìœ¼ë¡œ DB ë°ì´í„° ì†ì‹¤ì„ ì–¸ê¸‰í•œë‹¤. ê·¸ëŸ°ë° ë„ì»¤ë¥¼ ìƒê°í•´ë³´ë©´ volume ê¸°ëŠ¥ì´ ì¡´ì¬í•œë‹¤. ì¦‰, ë°ì´í„°ë¥¼ ì˜ì†ì ìœ¼ë¡œ ë³´ê´€í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. í˜„êµ¬ë§‰ ê¸°ìˆ  ë¸”ë¡œê·¸ì—ì„œ ë³´ë©´ ì´ë¡ ì ìœ¼ë¡œëŠ” ë„ì»¤ë¥¼ ì‚¬ìš©í•´ë„ ë˜ì—ˆìœ¼ë‚˜, ì„œë¹„ìŠ¤ ìš´ì˜ ì¸¡ë©´ì—ì„œëŠ” ë„ì»¤ë¼ëŠ” ê¸°ìˆ ì´ ë¶ˆì•ˆì •í•´ ì“°ì´ì§€ ì•ŠëŠ”ë‹¤ê³  ì–¸ê¸‰ë˜ì–´ ìˆë‹¤.\nì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œëŠ”ìš”? ê·¸ëŸ°ë° ì €ê±´ ë„ì»¤ì— í•œì •ëœ ì´ì•¼ê¸°ì¸ ê²ƒ ê°™ë‹¤. ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ íŠ¹ì§•ì„ ì˜ ì‚´í´ë³´ë©´ ìƒíƒœë¥¼ ì‚¬ì „ì— ì •ì˜í•˜ê³ , ì •ì˜ëœ ìƒíƒœë¡œ ìš´ì˜ëœë‹¤. ìš´ì˜ ì¸¡ë©´ì—ì„œ í¸ë¦¬í•´ ë³´ì´ê³ , ì•ˆì „ì„±ì´ ë¬¸ì œë¼ê³  í•œë‹¤ë©´ ë‹¤ì¤‘í™”ë¥¼ í•˜ë©´ ëœë‹¤. ì´ì •í›ˆë‹˜ì˜ medium - ì‹¤ì œë¡œ ë³¸ DB on Kubernetes íš¨ê³¼ì—ì„œ ì–¸ê¸‰í–ˆë‹¤ì‹¶ì´ ì¼ë¶€ ì„±ëŠ¥ í–¥ìƒë„ ë³´ì´ê¸°ë„ í–ˆë‹¤ê³  í•œë‹¤.\nTodoPointì—ì„œëŠ” ì–´ë–»ê²Œ êµ¬ì„±í•˜ì§€? StatefulSetì„ ì‚¬ìš©í•˜ìê°€ ê²°ë¡ ì´ë‹¤. StatefulSetì€ ìƒíƒœ ì •ë³´ë¥¼ êµ¬ì„±í• ë•Œ ì£¼ë¡œ ì‚¬ìš©ëœë‹¤. ì•„ë˜ì˜ ë¸”ë¡œê·¸ì²˜ëŸ¼ CronJobì„ í™œìš©í•´ì„œ ë°±ì—…ì„ êµ¬ì„±í•˜ë„ë¡ ì„¤ê³„í•´ì•¼ ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤. Reference https://nangman14.tistory.com/79 ","date":"2024-03-13T00:00:00Z","permalink":"https://s0okju.github.io/p/todopoint-db-design/","title":"TodoPoint - ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì—ì„œ DBëŠ” ì–´ë–»ê²Œ êµ¬ì„±í•˜ì§€?"},{"content":"Java ì§„ì˜ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” ORMì€ JPAì´ë‹¤. í•˜ì§€ë§Œ Goì—ì„œëŠ” ëŒ€í‘œì ì¸ ORMì€ ì—†ëŠ”ë“¯í•˜ë‹¤. ê·¸ëŸ°íƒ“ì— ì´ëŸ°ì €ëŸ° ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë§ì€ë°, ìƒí™©ì— ë§ê²Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì“°ì„¸ìš” ì‹ì˜ GoìŠ¤ëŸ¬ì›€ì„ ë§ì´ ë³¼ ìˆ˜ ìˆë‹¤.\nì–´ë–¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ê²ƒì¸ê°€? gorm ê³¼ê±°ì—ëŠ” gormì´ ë§ì´ ì“°ì¸ë‹¤ê³  í•˜ë˜ë°, ì—¬ëŸ¬ ë¬¸ì œì ì´ ì¡´ì¬í•œë‹¤ê³  í•œë‹¤.1ê°œì¸ì ìœ¼ë¡œ ìµœì•…ì˜ ê¸°ëŠ¥ì€ ì„¤ì •ë“¤ì„ struct tagë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ë¼ê³  ìƒê°í•œë‹¤.\nent ìš”ì¦˜ ëœ¨ê³  ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” FaceBookì—ì„œ ìì²´ì ìœ¼ë¡œ ê°œë°œí•œ entì´ë‹¤. GO ì½”ë“œë¡œ ìŠ¤í‚¤ë§ˆë¥¼ ì‘ì„±í•˜ë©´ DBì— ëª¨ë¸ë§ì„ í•´ì£¼ë©°, íŠ¹íˆ Graph íƒìƒ‰ì— íŠ¹í™”ë˜ì–´ ìˆë‹¤.\në‚˜ì˜ ì„ íƒì€ ë‚˜ì˜ ì„ íƒì€ entì´ë‹¤. ì¼ë‹¨ ëŒ€ê¸°ì—…ì´ ê°œë°œí–ˆë‹¤ëŠ” ì ì—ì„œ 1ì°¨ì ìœ¼ë¡œ ì‹ ë¢°ê°€ ê°„ë‹¤. sqlboilerê°€ í™”ë ¤í•œ ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤˜ì„œ ê¶ê¸ˆí•˜ê¸´ í•˜ì§€ë§Œ ë¬¸ì„œí™”ê°€ ì˜ëœ entë¥¼ ìš°ì„ ì ìœ¼ë¡œ í•´ë³´ê³ ì í•œë‹¤.\nORM ê¼­ í•„ìš”í•œ ê²ƒì¸ê°€? ì›¹ê°œë°œ ìì²´ë¥¼ ì–•ê²Œ í•´ì˜¤ë©´ì„œ ORMì— ìµìˆ™í•´ì¡Œë‹¤. ê·¸ëŸ¬ë©´ì„œ ORMì€ ì„ íƒì´ ì•„ë‹Œ í•„ìˆ˜ë¼ê³  ì—¬ê¸°ë©´ì„œ ì‚¬ìš©í–ˆë˜ ê²ƒ ê°™ë‹¤. í•˜ì§€ë§Œ ORM ì¶”ì²œê¸€ì„ ì½ìœ¼ë©´ì„œ ê¼­ í•„ìš”í•œê°€ì— ëŒ€í•´ ìƒê°í•˜ê²Œ ëœ ê³„ê¸°ê°€ ë˜ì—ˆë˜ ê²ƒ ê°™ë‹¤.2 ê°œë°œì ì…ì¥ì—ì„œëŠ” CRUDë¥¼ ì¶”ìƒí™”ëœ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° êµ¬í˜„ì´ ìš©ì´í•˜ê³ , ê°€ë…ì„±ì´ ìˆëŠ” ì½”ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ORMì— ëŒ€í•œ ë¶€ì •ì ì¸ ì…ì¥ì˜ ëŒ€ë¶€ë¶„ì˜ ê³¼ë‹¤í•˜ê²Œ ì‚¬ìš©í–ˆì„ ë•Œë¥¼ ê°€ì •í•œë‹¤. ê°œì¸ì ìœ¼ë¡œëŠ” ì–´ë– í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“  ê³¼ë‹¤í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì˜¤ë²„í—¤ë“œê°€ ë”°ë¥¸ë‹¤ê³  ìƒê°í•œë‹¤. ë˜í•œ DB ì„¤ê³„ ìì²´ê°€ ì˜ëª»ë˜ì–´ì„œ ì¼ ìˆ˜ ìˆë‹¤. ë‚˜ì™€ ê°™ì€ ì†Œê·œëª¨ í”„ë¡œì íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë¼ë©´ ê¸°ì¡´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ìˆëŠ” ëª¨ë“  ê¸°ëŠ¥ì„ ì“¸ ì¼ì´ ì—†ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ORMì„ ì“°ë ¤ê³  í•œë‹¤. ê·¸ë¦¬ê³  ê°œë°œìê°€ ì“°ê¸° í¸í•´ì•¼ ìœ ì§€ë³´ìˆ˜í•˜ê¸° í¸í•  ê²ƒ ê°™ë‹¤ëŠ” ìƒê°ì´ ë” ë§ì´ ë“ ë‹¤.\nhttps://umi0410.github.io/blog/golang/how-to-backend-in-go-db/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nhttps://www.reddit.com/r/golang/comments/t3bp79/a_good_orm_for_golang/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-03-09T00:00:00Z","permalink":"https://s0okju.github.io/p/go-db-migration/","title":"Go-DBì— ë§ˆê·¸ì´ì…˜í•˜ê¸°"},{"content":"ìŠ¤í”„ë§ ë¶€íŠ¸ ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ íŠ¹ì§•ì€ ì•„ë˜ì˜ ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬ ê°€ëŠ¥í•˜ë‹¤.\nìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ëŠ” IoC/DIë¥¼ í†µí•´ ê°ì²´ ê°„ì˜ ì˜ì¡´ ê´€ê³„ë¥¼ ì„¤ì •í•˜ê³ , AOPë¥¼ í†µí•´ í•µì‹¬ ê´€ì ê³¼ ë¶€ê°€ ê´€ì ì„ ë¶„ë¦¬í•´ ê°œë°œí•˜ë©°, PSAë¥¼ í†µí•´ ì¶”ìƒí™”ëœ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë“¤ì„ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤.\nIoC : ê°ì²´ì˜ ìƒì„±ê³¼ ê´€ë¦¬ë¥¼ ê°œë°œìê°€ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í”„ë ˆì„ì›Œí¬ê°€ ëŒ€ì‹ í•˜ëŠ” ê²ƒ DI : ì™¸ë¶€ì—ì„œ ê°ì²´ë¥¼ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•˜ëŠ” ê²ƒ AOP : í”„ë¡œê·¸ë˜ë°ì„ í•  ë•Œ í•µì‹¬ ê´€ì ê³¼ ë¶€ê°€ ê´€ì ì„ ë‚˜ëˆ„ì–´ì„œ ê°œë°œí•˜ëŠ” ê²ƒ PSA : ì–´ëŠ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ë˜ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒ IoC/DIë¥¼ í†µí•´ ê°ì²´ ê°„ì˜ ì˜ì¡´ ê´€ê³„ë¥¼ ì„¤ì •í•˜ê³ , AOPë¥¼ í†µí•´ í•µì‹¬ ê´€ì (service)ê³¼ ë¶€ê°€ ê´€ì (Repository)ë¥¼ ë¶„ë¦¬í•´ ê°œë°œí•˜ë©°, PSA(JpaRepository)ë¥¼ í†µí•´ ì¶”ìƒí™”ëœ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë“¤ì„ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // Service public interface UserService { void createUser(UserRegisterCommand command); User getUserById(Long userId); UserLoginResponse loginUserByEmail(String email); Boolean logoutById(String userId); } @Service public class UserServiceImp implements UserService{ @Autowired // IoC/DI private UserRepository userRepository; @Autowired private UserMapper userMapper; @Override public void createUser(UserRegisterCommand command) { try { userRepository.save(new UserEntity(command.getEmail(), command.getPassword(), command.getUsername())); }catch (DataAccessException e){ throw new DefaultException(ResponseMessage.DATA_ACCESS_ERROR,\u0026#34;user\u0026#34;); }catch (Exception e){ throw new DefaultException(ResponseMessage.DB_UNEXPECTED_ERROR,\u0026#34;user\u0026#34;); } } } // UserRepository // Crudì—ì„œ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ê°€ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤. // PSA public interface UserRepository extends JpaRepository\u0026lt;UserEntity,Long\u0026gt;,UserCustomRepository{ } ì˜ì¡´ì„± ì£¼ì… ì˜ì¡´ì„± ì£¼ì…ì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìƒì„±í•œ ê°ì²´(ë¹ˆ)ì„ ì£¼ì…ë°›ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ì´ë•Œ ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê°ì²´ë¥¼ ì˜ë¯¸í•œë‹¤.\nì£¼ì…ì„ ë°›ì„ë•ŒëŠ” @Autowiredë¥¼ ì‚¬ìš©í•˜ê³ , ë¹ˆì„ ë“±ë¡í•˜ê³  ì‹¶ìœ¼ë©´ @Componentë¥¼ ì„ ì–¸í•˜ë©´ ëœë‹¤. í”„ë ˆì„ì›Œí¬ì— ì‚¬ìš©ë˜ëŠ” ëŒ€ë¶€ë¶„ì˜ í•µì‹¬ ì–´ë…¸í…Œì´ì…˜ì€(@Repository, @Service ë“±) @Componentê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.\nì˜ì¡´ì„± ì£¼ì…ì— ëŒ€í•´ì„œëŠ” inung_92ë‹˜ì˜ velog, [Spring]ìŠ¤í”„ë§ ê¸°ì´ˆ - DIì„ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.\nìŠ¤í”„ë§ ì›¹ ê³„ì¸µ presentation ê³„ì¸µ HTTP ìš”ì²­ ë° ì‘ë‹µ ì²˜ë¦¬ ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì¸µ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„ í¼ì‹œìŠ¤í„´íŠ¸ ê³„ì¸µ ìŠ¤í† ë¦¬ì§€ ê´€ë ¨ ë¡œì§ ì¶”ê°€ ìœ„ì™€ ê°™ì€ êµ¬ì¡°ëŠ” Layered Architectureë¼ê³  í•œë‹¤. ì´ë•Œ ë ˆì´ì–´ ê°„ ì‘ì§‘ì„±ì„ ë†’ì´ê³  ì˜ì¡´ë„ë¥¼ ë‚®ì¶”ê¸° ìœ„í•´ì„œëŠ” ê³„ì¸µ ê°„ í˜¸ì¶œ ì‹œ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ í˜¸ì¶œí•´ì•¼ í•œë‹¤. ì¦‰, ìƒìœ„ ê³„ì¸µì€ ì§ì ‘ì ìœ¼ë¡œ í•˜ìœ„ ê³„ì¸µì„ í˜¸ì¶œí•˜ì§€ ì•Šê³  ì¶”ìƒì ì¸ ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•œë‹¤.\nQ. ì‘ì§‘ë„ë€?\nì‘ì§‘ë„ë€ í•œ ëª¨ë“ˆ ë‚´ë¶€ì˜ ì²˜ë¦¬ ìš”ì†Œë“¤ì´ ì„œë¡œ ê´€ë ¨ë˜ì–´ ìˆëŠ” ì •ë„ë¥¼ ë§í•œë‹¤. ì¦‰, ëª¨ë“ˆì´ ë…ë¦½ì ì¸ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ì§€ ë˜ëŠ” í•˜ë‚˜ì˜ ê¸°ëŠ¥ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì±…ì„ì´ ì˜ ë­‰ì³ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ë©° ëª¨ë“ˆì´ ë†’ì€ ì‘ì§‘ë„ë¥¼ ê°€ì§ˆìˆ˜ë¡ ì¢‹ë‹¤.\nì¶œì²˜ - https://madplay.github.io/post/coupling-and-cohesion-in-software-engineering\nQ. ì˜ì¡´ì„±ì„ ì™œ ë‚®ì¶°ì•¼ í•˜ëŠ” ê±¸ê¹Œ?\nA. ì˜ì¡´ì„±ì´ë€ ë‹¤ë¥¸ ê°ì²´ì˜ ì˜í–¥ì„ ë°›ê³ , ë‹¤ë¥¸ ê°ì²´ì— ë”°ë¼ ê²°ê³¼ê°€ ì¢Œìš°ë˜ëŠ” ê²ƒì´ë‹¤. ì˜ì¡´ì„±ì„ ë‚®ì¶° ê°ì²´ë“¤ ê°„ ì „íŒŒë˜ëŠ” ë³€ê²½ì— ëŒ€í•œ ì˜í–¥ì„ ìµœì†Œí™” ì‹œì¼œ, ìœ ì§€ë³´ìˆ˜ ì‹œ ì›í™œí•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œì´ë‹¤.\nì¶œì²˜ - https://velog.io/@ung6860/SpringìŠ¤í”„ë§-ê¸°ì´ˆ-DIDependency-Injection\nQ. ì˜ì¡´ì„±ì„ ë‚®ì¶”ëŠ” ë°©ë²•?\nA. ê¸°ë³¸ì ìœ¼ë¡œ ì˜ì¡´ì„±ì„ í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ new ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ì™¸ë¶€ë¡œë¶€í„° ê°ì²´ì˜ ì˜ì¡´ì„±ì„ ì£¼ì…ë°›ì•„ì•¼í•œë‹¤. ì™¸ë¶€ë¡œë¶€í„° ì˜ì¡´ì„±ì„ ì£¼ì…ë°›ëŠ” ê²ƒì˜ ì˜ë¯¸ëŠ” \u0026lsquo;ì˜ì¡´ì„± ì£¼ì…\u0026rsquo;ì— ì´ˆì ì„ ë§ì¶”ëŠ”ê²Œ ì•„ë‹ˆë¼ \u0026lsquo;ì˜ì¡´ì„± íƒˆí”¼ë¥¼ ìœ„í•˜ì—¬ ì™¸ë¶€ë¡œë¶€í„° ì£¼ì…\u0026rsquo;ì´ë¼ëŠ” ë¶€ê°€ì ì¸ ì„¤ëª…ì— ì´ˆì ì„ ë§ì¶”ì–´ì•¼í•œë‹¤.\nPresentation ì›¹ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ ë° ì‘ë‹µ ì²˜ë¦¬í•œë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @RestController @RequestMapping(\u0026#34;/membership/\u0026#34;); public class RegisterMembershipController { @Autowired private MembershipService membershipService; @PostMapping(path = \u0026#34;register\u0026#34;) public Membership createmembership(@RequestBody MembershipRequest request){ MembershipCommand command = MembershipCommand.builder() .name(\u0026#34;hello\u0026#34;).builder(); return membershipService.createMembership(command); } ë³´í†µì€ @Controllerë¥¼ í†µí•´ controllerë¥¼ ì§€ì •í•´ì¤„ ìˆ˜ ìˆë‹¤. rest apië¥¼ êµ¬í˜„í–ˆëŠ”ë°, ì´ì— ì í•©í•œ @RestControllerê°€ ìˆë‹¤. @RestControllerëŠ” @Controller + @ResponseBodyë¼ê³  ë³´ë©´ ëœë‹¤. ìì„¸í•œ ì‚¬í•­ì€ ë§ë‚˜ë‹ˆ ê°œë°œìë‹˜ì˜ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.\nService ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ê³„ì¸µì´ë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 public interface MembershipService{ Membership createMembership(MembershipCommand command); } @Service public class MembershipServiceImp implements MembershipService{ @Autowired MembershipRepository membershipRepository; @Override Membership createMembership(MembershipCommand command){ membershipRepository.save(command); } } í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì—°ì‚°ìœ¼ë¡œ êµ¬ì„±ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í•˜ê³  ê·¸ì— ëŒ€í•œ êµ¬í˜„ì„ ë”°ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. ê·¸ë˜ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•˜ê²Œ ë˜ëŠ”ë°, ë‚˜ì¤‘ì—ì„œ ì„œë¹„ìŠ¤ êµ¬í˜„ì´ ë³€ê²½ë˜ë”ë¼ë„ ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´ë¼ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë³€ê²½í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤.\nRepository ì €ì¥ì†Œì— ì ‘ê·¼í•˜ëŠ” ì˜ì—­ìœ¼ë¡œ DAO(Data Access Object) ì˜ì—­ì´ë¼ê³  ë¶€ë¥¸ë‹¤. @Repositoryë¥¼ ì‚¬ìš©í•˜ì—¬ Spring repositoryë¥¼ ì§€ì •í•´ì¤€ë‹¤. ì£¼ëª©í•  ì ì€ ì¸í„°í˜ì´ìŠ¤ ë‚´ìš©ì´ ë¹„ì–´ ìˆë”ë¼ë„ ìŠ¤í”„ë§ ë°ì´í„°ê°€ JPA ëŸ°íƒ€ì„ì— ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ë¥¼ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.\n1 2 3 4 @Repository public interface MembershipRepository extends CrudRepository\u0026lt;Membership,Long\u0026gt; { } DTO ê³„ì¸µ ê°„ì— ë°ì´í„° êµí™˜ì„ ìœ„í•œ ê°ì²´ë¥¼ ì˜ë¯¸í•œë‹¤.\nì²˜ìŒ ê³µë¶€ í–ˆì„ ë•Œ â€œDto ë‹¤ ë˜‘ê°™ì€ ê°ì²´ê² êµ°â€¦ ì˜¤ë¥˜ ë°œìƒí•˜ë©´ ë‚œë¦¬ë‚˜ê² ë„¤â€ë¼ê³  ìƒê°í–ˆë‹¤. ê° ê³„ì¸µë§ˆë‹¤ Dtoê°€ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤. ì•„ë˜ì˜ ì˜ˆì‹œë¥¼ ë³´ë©´ Controller â†’ Serviceì—ì„œëŠ” Dtoê°€ Membership ê°ì²´ë¥¼ ì‚¬ìš©í–ˆë‹¤. í•˜ì§€ë§Œ Membership ë„ë©”ì¸ê³¼ ì‹¤ì œ ì—”í‹°í‹°ì™€ ë‹¤ë¥¼ ê²½ìš°ë¼ë©´ ì–´ë–¨ê¹Œ? Service â†’ Repositoryì—ì„œëŠ” Dtoê°€ MembershipEntityê°€ ë˜ëŠ” ê²ƒì´ë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // Controller membershipService.createMembership(member); // MembershipService public interface MembershipService{ Membership createMembership(Membership member); } @Component public class MembershipMapper { MembershipEntity MapToEntity(Membership member){ return new MembershipEntity( // ... ìƒëµ ); } } @Service public class MembershipServiceImp implements MembershipService{ @Autowired MembershipRepository MembershipRepository; @Override Membership createMembership(Membership membership){ MembershipRepository.save(MembershipMapper.MapToEntity(membership)); } } í…ŒìŠ¤íŠ¸ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ì‹œ í…ŒìŠ¤íŠ¸ ë‹¨ê³„ëŠ” í•„ìˆ˜ë‹¤. ì´ ë‹¨ê³„ì—ì„œëŠ” ì‘ì„±í•œ ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê²€ì¦í•œë‹¤. í…ŒìŠ¤íŠ¸ëŠ” í¬ê²Œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ í†µí•© í…ŒìŠ¤íŠ¸ê°€ ì¡´ì¬í•œë°, ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì§‘ì¤‘ì ìœ¼ë¡œ ì„¤ëª…í•˜ê³ ì í•œë‹¤.\në‹¨ìœ„ í…ŒìŠ¤íŠ¸ë€ í•˜ë‚˜ì˜ ëª¨ë“ˆì„ ê¸°ì¤€ìœ¼ë¡œ ë…ë¦½ì ìœ¼ë¡œ ì§„í–‰ë˜ëŠ” ê°€ì¥ ì‘ì€ ë‹¨ìœ„ì˜ í…ŒìŠ¤íŠ¸ì´ë‹¤. íŠ¹ì • ë¶€ë¶„ë§Œ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ê¸° ë•Œë¬¸ì— ë¹ ë¥´ê²Œ ë¬¸ì œ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆê²Œ ëœë‹¤.\nìì„¸í•œ ì‚¬í•­ì€ ë§ë‚˜ë‹ˆ ê°œë°œìë‹˜ì˜ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.\në°ì´í„°ë² ì´ìŠ¤ JPA(Java Persistent API) ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì„ ì •ì˜í•œ ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. ì´ë¥¼ êµ¬í˜„í•œ ORM í”„ë ˆì„ì›Œí¬ë¡œëŠ” hibernateê°€ ìˆë‹¤.\nJPAëŠ” ë‹¤ì–‘í•œ ì¿¼ë¦¬ ë°©ë²•ì„ ì§€ì›í•œë‹¤.\nJPQL QueryDSL Native SQL JDBC API ì§ì ‘ ì‚¬ìš© ìš”ì¦˜ì€ QueryDSLë¥¼ ì‚¬ìš©í•˜ëŠ” ì¶”ì„¸ë¼ê³  í•œë‹¤.\nì•¤í‹°í‹° DBì˜ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” ê°ì²´ë¡œ DB í…Œì´ë¸”ê³¼ ì§ì ‘ ì—°ê²°ëœë‹¤.\nì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì—”í‹°í‹°ë¥¼ ê´€ë¦¬í•˜ëŠ” ê°€ìƒ ê³µê°„ì´ë‹¤.\n1ì°¨ ìºì‹œ ìºì‹œí‚¤ëŠ” ì—”í‹°í‹°ì˜ í‚¤ë¡œ ë‘¬ì„œ, ì¡°íšŒì‹œ 1ì°¨ì ìœ¼ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‚´ì— ìˆëŠ” ê°’ì„ ë°˜í™˜í•œë‹¤. ì“°ê¸° ì§€ì—° ë¹ˆë²ˆí•œ context swtichingì— ëŒ€í•œ overheadë¥¼ ì¤„ì—¬ì£¼ê¸° ìœ„í•´ í•œêº¼ë²ˆì— ëª¨ì•˜ë‹¤ê°€ ì²˜ë¦¬í•œë‹¤. ë³€ê²½ ê°ì§€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‚´ì— ìˆëŠ” ìºì‹œì™€ ë³€ê²½ëœ entityê°’ì„ ë¹„êµí•´ì„œ ì—”í‹°í‹° ë³€ê²½ ê°ì§€ í›„ DBì— ìë™ ë°˜ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, DB ìƒì— ìˆëŠ” ë¡œì§ì˜ ê¼¬ì´ëŠ” ê²ƒì„ ë°©ì§€ Q. ì™œ ì˜ì†ì„± í…ŒìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì¸ê°€?\nA. íŠ¸ëœì­ì…˜ì˜ íšŸìˆ˜ë‚˜ ë°©ì‹ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•´ ì„œë²„ì˜ ì†ë„ë¥¼ ëŠ˜ë¦¬ê³ , ì¤‘ë³µë˜ëŠ” ì¿¼ë¦¬ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.\nWASê°€ ì‹œì‘ë˜ë©´ EntityMangerFactoryê°€ ìƒì„±ë˜ê³ , íŠ¸ëœì­ì…˜ë§ˆë‹¤ ìƒì„±ë˜ëŠ” EntityManagerë¥¼ ê´€ë¦¬í•œë‹¤. ì´ë•Œ EntityManagerëŠ” Entityì˜ ìƒëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬í•œë‹¤.(ê´€ë¦¬ ìƒíƒœ, ë¹„ì˜ì† ìƒíƒœ, ì‚­ì œëœ ìƒíƒœ)\nìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” EntityManagerFactoryë¥¼ í•˜ë‚˜ë§Œ ìƒì„±í•´ì„œ ê´€ë¦¬í•˜ê³ , ì˜ì¡´ì„± ì£¼ì…í•´ì„œ ì‚¬ìš©í•¨. ë¹ˆì„ í•˜ë‚˜ë§Œ ìƒì„±í•´ì„œ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ì†Œí–ˆë‹¤.\nSpring data api ì¸í„°í˜ì´ìŠ¤ ë° ì£¼ì„ ì„¸íŠ¸ë¥¼ ì œê³µí•´ì„œ ë°ì´í„° ì•¡ì„¸ìŠ¤ ê³„ì¸µì„ ì‰½ê²Œ êµ¬ì¶•í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤. JPAë¥¼ í•œ ë‹¨ê³„ ì¶”ìƒí™”ì‹œí‚¨ Repositoryë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•¨ìœ¼ë¡œì¨ ì´ë¤„ì§„ë‹¤.\nìŠ¤í”„ë§ ë°ì´í„°ì˜ ê³µí†µì ì¸ ê¸°ëŠ¥ì—ì„œ JPAì˜ ìœ ìš©í•œ ê¸°ìˆ ì´ ì¶”ê°€ (ìŠ¤í”„ë§ ë°ì´í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ì•„ì„œ ê°„ë‹¨í•œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ê°€ëŠ¥)\nReference Spring - ORM, JPA, Hibernate, JDBC ì´ì •ë¦¬ [JPA] ê°ì²´ì§€í–¥ ì¿¼ë¦¬, JPQL [TDD] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸(Unit Test) ì‘ì„±ì˜ í•„ìš”ì„± (1/3) [Spring]ìŠ¤í”„ë§ ê¸°ì´ˆ - DI(Dependency Injection) ","date":"2024-02-03T00:00:00Z","permalink":"https://s0okju.github.io/p/basic-spring-1/","title":"Spring - Spring Boot ê°„ëµí•˜ê²Œ ì•Œì•„ë³´ê¸°"},{"content":"Terraform ì´ë€ HashiCorpì—ì„œ ì˜¤í”ˆì†ŒìŠ¤ë¡œ ê°œë°œì¤‘ì¸, í´ë¼ìš°ë“œ ë° ì˜¨í”„ë¡œë¯¸ìŠ¤ ì¸í”„ë¼ë¥¼ ì½”ë“œë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì½”ë“œì´ë‹¤. ì¸í”„ë¼ í™˜ê²½ êµ¬ì„± ì‹œ ì„ ì–¸ì  ì½”ë“œí˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±, ìˆ˜ì •, ì‚­ì œí•˜ì—¬ ê´€ë¦¬ê°€ ê°€ëŠ¥í•œ laC(Infrastructure as Code) í”„ë¡œë¹„ì €ë‹ ë„êµ¬ì´ë‹¤.\nTerraform ì‘ë™ ë°©ì‹ ì£¼ë¡œ Write, Plan, Apply ì ˆì°¨ë¡œ ì´ë¤„ì§„ë‹¤.\nWrite : Hashicorpì—ì„œ ìì²´ ê°œë°œí•œ HCL ì–¸ì–´ë¡œ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± Plan : ìƒíƒœë¥¼ ë¹„êµí•˜ë©° ë³€ê²½ì ì„ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤Œ Apply : ì‹¤í–‰í•˜ëŠ” ë‹¨ê³„, ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ ì˜ì¡´ ê´€ê³„ì— ë”°ë¼ ìˆœì„œë¥¼ ëª…ì‹œí•  ìˆ˜ ìˆë‹¤. ìƒíƒœ ë¹„êµë¥¼ í†µí•´ íœ´ë¨¼ ì—ëŸ¬ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ ì½”ë“œì˜ ë¬´ê²Œê°€ ë¬´ê±°ì›Œì§€ë©´, ì‹¤í–‰í•˜ëŠ”ë° ì˜¤ë˜ê±¸ë¦¬ëŠ” ì›ì¸ì´ ë  ìˆ˜ ìˆë‹¤. ê·¸ ì™¸ì—ë„ ë‹¤ì–‘í•œ ë‹¨ì ì´ ì¡´ì¬í•  ê²ƒì´ë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ìƒì‚°ì„± ì¸¡ë©´, ì¢…ì†ì„± ê·¸ë˜í”„ ë“± ì¥ì ë“¤ì´ ë” í¬ê¸° ë•Œë¬¸ì— ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.\ní´ë¼ìš°ë“œ ì»´í“¨íŒ… í™˜ê²½ì€ ì°¸ì¡°ëœ ë¦¬ì†ŒìŠ¤ê°€ ì²˜ìŒì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” ìˆœí™˜ë£¨í”„ ë¬¸ì œë¥¼ ì§€ë‹ˆê³  ìˆë‹¤. ë¬´í•œí•œ ë°˜ë³µìœ¼ë¡œ ì¸í•´ ì‹œìŠ¤í…œì´ ë¹ ë¥´ê²Œ ê³ ê°ˆë˜ê³ , ì„±ëŠ¥ì´ ì €í•˜ëœë‹¤. Terraformì—ì„œëŠ” ë¦¬ì†ŒìŠ¤ì˜ ì°¸ì¡° ë‚´ìš©ì„ ê·¸ë˜í”„ë¡œ ë³´ì—¬ì£¼ëŠ” Resource Graphë¥¼ ì œê³µí•´ì£¼ëŠ”ë°, ì´ë¥¼ í™œìš©í•´ ìˆœí™˜ë£¨í”„ ë¬¸ì œë¥¼ ì˜ˆë°©í•  ìˆ˜ ìˆë‹¤.\nì—°ìŠµ ìì„¸í•œ ë¬¸ë²•ì€ Terraform Language Documentationì„ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤.\nì‹œë‚˜ë¦¬ì˜¤ AWSë¥¼ í™œìš©í•œë‹¤. ê°œë°œ, ìš´ì˜ VPCë¥¼ êµ¬ì¶•í•œë‹¤. ê° VPCì—ì„œ private, public subnetì´ ì¡´ì¬í•œë‹¤. ì™¸ë¶€ì™€ í†µì‹ ì„ ìœ„í•´ internet gatewayì™€ ë‚´ë¶€ ë¦¬ì†ŒìŠ¤ë¼ë¦¬ë§Œ í†µì‹ í•  ìˆ˜ ìˆëŠ” NAT gatewayë¥¼ ì„¤ì¹˜í•œë‹¤. êµ¬í˜„ AWSë¥¼ í™œìš©í•œë‹¤. Terraform AWS Registryì—ì„œ ì œê³µí•´ì£¼ëŠ” ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•œë‹¤. ë‚˜ì˜ ê²½ìš° regionì„ ap-northeast-2 ë¡œ ì„¤ì •í–ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 terraform { required_providers { aws = { source = \u0026#34;hashicorp/aws\u0026#34; version = \u0026#34;~\u0026gt; 5.0\u0026#34; } } } # Configure the AWS Provider provider \u0026#34;aws\u0026#34; { region = \u0026#34;ap-northeast-2\u0026#34; } ê°œë°œ ìš´ì˜ vpcë¥¼ êµ¬ì¶•í•œë‹¤. vpc ëª¨ë“ˆì„ ë³„ë„ë¡œ ë§Œë“¤ì–´ ì½”ë“œë¥¼ ì¬ì‚¬ìš©í–ˆê³ , envë¥¼ ë³€ìˆ˜ë¡œ ì‚¼ì•„ ë¦¬ì†ŒìŠ¤ì˜ ì´ë¦„ì— ê°œë°œ í™˜ê²½ì„ ëª…ì‹œí•˜ë„ë¡ í–ˆë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 // For Dev module \u0026#34;dev_vpc\u0026#34; { source = \u0026#34;./vpc.d\u0026#34; env = \u0026#34;dev\u0026#34; } // For Production module \u0026#34;prd_vpc\u0026#34; { source = \u0026#34;./vpc.d\u0026#34; env = \u0026#34;prd\u0026#34; } ëª¨ë“ˆì˜ main.tfì—ëŠ” public, private Subnet ê·¸ë¦¬ê³  NAT gateway, Internet gatewayë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤.\nPrivate Subnetì„ êµ¬ì„±í•˜ê¸° ìœ„í•´ì„œëŠ” ë¼ìš°íŒ… í…Œì´ë¸”ì´ í•„ìš”í•˜ì§€ë§Œ, ì„ì‹œì´ë¯€ë¡œ Private NAT Gatewayë§Œ ì‘ì„±í–ˆë‹¤. ì—¬ê¸°ì„œ ì£¼ëª©í•´ì•¼ í•  ì ì€ NAT, Internet Gatewayì˜ ê²½ìš° Subnetì´ ìš°ì„ ì ìœ¼ë¡œ ë§Œë“¤ì–´ì ¸ì•¼ ì‹¤í–‰ëœë‹¤.(ë§Œì•½ì— ê·¸ëŸ¬ì§€ ì•ŠëŠ”ë‹¤ë©´ ì˜¤ë¥˜ê°€ ëœ¬ë‹¤.) ê·¸ëŸ¬ë¯€ë¡œ ì½”ë“œë¥¼ ì‘ì„±í• ë•Œ ê° ë¦¬ì†ŒìŠ¤ì˜ ì˜ì¡´ì„±ì„ ê³ ë ¤í•´ì„œ ì‘ì„±í•´ì•¼ í•œë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 terraform { required_providers { aws = { source = \u0026#34;hashicorp/aws\u0026#34; version = \u0026#34;~\u0026gt; 5.0\u0026#34; } } } // Configure the AWS Provider provider \u0026#34;aws\u0026#34; { region = \u0026#34;ap-northeast-2\u0026#34; } // Create a VPC resource \u0026#34;aws_vpc\u0026#34; \u0026#34;default\u0026#34; { cidr_block = \u0026#34;10.0.0.0/16\u0026#34; tags = { Name = \u0026#34;terraform_default_vpc_${var.env}\u0026#34; } } // public subnet resource \u0026#34;aws_subnet\u0026#34; \u0026#34;public_subnet_1\u0026#34; { vpc_id = aws_vpc.default.id cidr_block = \u0026#34;10.0.0.0/24\u0026#34; tags = { Name = \u0026#34;terraform_public_subnet_1_${var.env}\u0026#34; } } // private subnet resource \u0026#34;aws_subnet\u0026#34; \u0026#34;private_subnet_1\u0026#34; { vpc_id = aws_vpc.default.id cidr_block = \u0026#34;10.0.10.0/24\u0026#34; tags = { Name = \u0026#34;terraform_private_subnet_1_${var.env}\u0026#34; } } // private NAT resource \u0026#34;aws_nat_gateway\u0026#34; \u0026#34;private_nat\u0026#34; { connectivity_type = \u0026#34;private\u0026#34; subnet_id = aws_subnet.private_subnet_1.id tags = { Name = \u0026#34;terraform_nat_${var.env}\u0026#34; } } // Internet gateway resource \u0026#34;aws_internet_gateway\u0026#34; \u0026#34;igw\u0026#34; { vpc_id = aws_vpc.default.id tags = { Name = \u0026#34;terraform_igw_${var.env}\u0026#34; } } Terraform ë„ì…ê³¼ ê´€ë ¨ëœ ê¸°ìˆ  ë¸”ë¡œê·¸ ì¢Œì¶©ìš°ëŒ Terraform ì…ë¬¸ê¸°, ìš°ì•„í•œí˜•ì œë“¤ ê¸°ìˆ ë¸”ë¡œê·¸ DevOpsíŒ€ì˜ Terraform ëª¨í—˜ Terraform IaC ë„êµ¬ë¥¼ í™œìš©í•œ AWS ì›¹ì½˜ì†” í´ë¦­ ë…¸ê°€ë‹¤ í•´ë°©ê¸° â†’ ë‹¤ë“¤ ì›¹ì½˜ì†”ì—ì„œì˜ í•´ë°©ì„ ì™¸ì¹˜ê³  ìˆì—ˆë‹¤..\n","date":"2024-01-25T00:00:00Z","permalink":"https://s0okju.github.io/p/basic-terraform-1/","title":"Terraform ê¸°ì´ˆ ë§›ë³´ê¸° - 1. ê¸°ë³¸ ë¬¸ë²• ìµíˆê¸°"}]